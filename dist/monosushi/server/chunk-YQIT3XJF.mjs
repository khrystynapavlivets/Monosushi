import './polyfills.server.mjs';
import{A as Ry,a as uy,b as hy,c as dy,d as fy,e as py,f as ni,g as my,h as Cn,i as gy,j as yy,k as vy,l as Ty,m as Sy,n as Is,o as wy,p as Ey,q as _y,r as Cy,s as by,t as As,u as Iy,v as Ay}from"./chunk-IJCMACY3.mjs";import{l as ly}from"./chunk-AEL4QSO4.mjs";import{$ as ia,Db as Mt,Eb as En,Fb as Cs,Gb as Au,Hb as Ru,Ib as Du,Ic as Ou,Kb as ay,Lb as bs,Mb as pt,Tc as xu,Ub as _n,Wa as sy,Wb as wr,Xa as Iu,Yb as Nu,aa as sa,ab as Oe,bb as Sr,c as ny,ca as oa,ea as Zr,f as Un,fa as ei,fb as oy,ga as Ts,hd as cy,id as ku,jb as Ss,ka as _u,kd as ca,la as aa,ld as ua,md as Mu,na as iy,pc as la,sb as ws,t as ry,ta as Cu,tb as Es,ua as bu,ub as rt,vb as _s,yb as wn,za as ti}from"./chunk-2Q732AJT.mjs";import{a as St,b as Jr,c as re,f as y,h as ty,i as C}from"./chunk-3CVZQN5Z.mjs";var ee=y(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Et.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Et.Propagate=Et.LogVerbosity=Et.Status=void 0;var $v=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}($v||(Et.Status=$v={})),Kv=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(Kv||(Et.LogVerbosity=Kv={})),Hv=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(Hv||(Et.Propagate=Hv={}));Et.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Et.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Ch=y((sB,Bb)=>{Bb.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Te=y(st=>{"use strict";var bh,Ih,Ah,Rh;Object.defineProperty(st,"__esModule",{value:!0});st.isTracerEnabled=st.trace=st.log=st.setLoggerVerbosity=st.setLogger=st.getLogger=void 0;var Gn=ee(),qb=re("process"),Ub=Ch().version,Vb={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Ar=Vb,ci=Gn.LogVerbosity.ERROR,zb=(Ih=(bh=process.env.GRPC_NODE_VERBOSITY)!==null&&bh!==void 0?bh:process.env.GRPC_VERBOSITY)!==null&&Ih!==void 0?Ih:"";switch(zb.toUpperCase()){case"DEBUG":ci=Gn.LogVerbosity.DEBUG;break;case"INFO":ci=Gn.LogVerbosity.INFO;break;case"ERROR":ci=Gn.LogVerbosity.ERROR;break;case"NONE":ci=Gn.LogVerbosity.NONE;break;default:}var Gb=()=>Ar;st.getLogger=Gb;var jb=n=>{Ar=n};st.setLogger=jb;var $b=n=>{ci=n};st.setLoggerVerbosity=$b;var Kb=(n,...e)=>{let t;if(n>=ci){switch(n){case Gn.LogVerbosity.DEBUG:t=Ar.debug;break;case Gn.LogVerbosity.INFO:t=Ar.info;break;case Gn.LogVerbosity.ERROR:t=Ar.error;break}t||(t=Ar.error),t&&t.bind(Ar)(...e)}};st.log=Kb;var Hb=(Rh=(Ah=process.env.GRPC_NODE_TRACE)!==null&&Ah!==void 0?Ah:process.env.GRPC_TRACE)!==null&&Rh!==void 0?Rh:"",Dh=new Set,Wv=new Set;for(let n of Hb.split(","))n.startsWith("-")?Wv.add(n.substring(1)):Dh.add(n);var Wb=Dh.has("all");function Qb(n,e,t){Qv(e)&&(0,st.log)(n,new Date().toISOString()+" | v"+Ub+" "+qb.pid+" | "+e+" | "+t)}st.trace=Qb;function Qv(n){return!Wv.has(n)&&(Wb||Dh.has(n))}st.isTracerEnabled=Qv});var qa=y(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.getErrorCode=ui.getErrorMessage=void 0;function Yb(n){return n instanceof Error?n.message:String(n)}ui.getErrorMessage=Yb;function Xb(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}ui.getErrorCode=Xb});var ot=y(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.Metadata=void 0;var Jb=Te(),Zb=ee(),eI=qa(),tI=/^[0-9a-z_.-]+$/,nI=/^[ -~]*$/;function rI(n){return tI.test(n)}function iI(n){return nI.test(n)}function Xv(n){return n.endsWith("-bin")}function sI(n){return!n.startsWith("grpc-")}function Ua(n){return n.toLowerCase()}function Yv(n,e){if(!rI(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Xv(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!iI(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Nh=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Ua(e),Yv(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Ua(e),Yv(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Ua(e),this.internalRepr.delete(e)}get(e){return e=Ua(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(oI);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{Xv(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(sI(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,eI.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,Jb.log)(Zb.LogVerbosity.ERROR,o)}}return t}};Va.Metadata=Nh;var oI=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Ph=y(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.CallCredentials=void 0;var Mh=ot();function aI(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var hi=class n{static createFromMetadataGenerator(e){return new xh(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;aI(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Mh.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new kh}};za.CallCredentials=hi;var Oh=class n extends hi{constructor(e){super(),this.creds=e}generateMetadata(e){return C(this,null,function*(){let t=new Mh.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},xh=class n extends hi{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Oh([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},kh=class n extends hi{generateMetadata(e){return Promise.resolve(new Mh.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Fh=y(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.getDefaultRootsData=di.CIPHER_SUITES=void 0;var lI=re("fs");di.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Jv=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Lh=null;function cI(){return Jv?(Lh===null&&(Lh=lI.readFileSync(Jv)),Lh):null}di.getDefaultRootsData=cI});var $a=y(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.ChannelCredentials=void 0;var uI=re("tls"),hI=Ph(),Zv=Fh();function Bh(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var fi=class{constructor(e){this.callCredentials=e||hI.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Bh(e,"Root certificate"),Bh(t,"Private key"),Bh(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,uI.createSecureContext)({ca:(s=e??(0,Zv.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:Zv.CIPHER_SUITES});return new Ga(o,i??{})}static createFromSecureContext(e,t){return new Ga(e,t??{})}static createInsecure(){return new qh}};ja.ChannelCredentials=fi;var qh=class n extends fi{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Ga=class n extends fi{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Uh(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Uh=class n extends fi{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var $n=y(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.validateLoadBalancingConfig=Qe.getFirstUsableConfig=Qe.isLoadBalancerNameRegistered=Qe.createLoadBalancer=Qe.registerDefaultLoadBalancerType=Qe.registerLoadBalancerType=Qe.createChildChannelControlHelper=void 0;function dI(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}Qe.createChildChannelControlHelper=dI;var jn={},Vh=null;function fI(n,e,t){jn[n]={LoadBalancer:e,LoadBalancingConfig:t}}Qe.registerLoadBalancerType=fI;function pI(n){Vh=n}Qe.registerDefaultLoadBalancerType=pI;function mI(n,e){let t=n.getLoadBalancerName();return t in jn?new jn[t].LoadBalancer(e):null}Qe.createLoadBalancer=mI;function gI(n){return n in jn}Qe.isLoadBalancerNameRegistered=gI;function yI(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in jn)return t;return e&&Vh?new jn[Vh].LoadBalancingConfig:null}Qe.getFirstUsableConfig=yI;function vI(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in jn)return jn[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Qe.validateLoadBalancingConfig=vI});var zh=y(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.extractAndSelectServiceConfig=Kn.validateServiceConfig=Kn.validateRetryThrottling=void 0;var TI=re("os"),Ka=ee(),SI=$n(),Ha=/^\d+(\.\d{1,9})?s$/,wI="node";function EI(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function _I(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Ha.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Ha.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Ka.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Ka.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function CI(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Ha.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Ka.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Ka.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function bI(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(EI(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Ha.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=_I(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=CI(n.hedgingPolicy));return t}function eT(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Kn.validateRetryThrottling=eT;function tT(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,SI.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(bI(r));"retryThrottling"in n&&(e.retryThrottling=eT(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Kn.validateServiceConfig=tT;function II(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:tT(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function AI(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=II(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===TI.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===wI&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function RI(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return AI(i,e)}return null}Kn.extractAndSelectServiceConfig=RI});var _t=y(Wa=>{"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});Wa.ConnectivityState=void 0;var nT=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(nT||(Wa.ConnectivityState=nT={}))});var gt=y(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.uriToString=Hn.splitHostPort=Hn.parseUri=void 0;var DI=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function NI(n){let e=DI.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Hn.parseUri=NI;var rT=/^\d+$/;function OI(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return rT.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?rT.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Hn.splitHostPort=OI;function xI(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Hn.uriToString=xI});var Jt=y(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.mapUriDefaultScheme=Ct.getDefaultAuthority=Ct.createResolver=Ct.registerDefaultScheme=Ct.registerResolver=void 0;var jh=gt(),pi={},Gh=null;function kI(n,e){pi[n]=e}Ct.registerResolver=kI;function MI(n){Gh=n}Ct.registerDefaultScheme=MI;function PI(n,e,t){if(n.scheme!==void 0&&n.scheme in pi)return new pi[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,jh.uriToString)(n)}`)}Ct.createResolver=PI;function LI(n){if(n.scheme!==void 0&&n.scheme in pi)return pi[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,jh.uriToString)(n)}`)}Ct.getDefaultAuthority=LI;function FI(n){return n.scheme===void 0||!(n.scheme in pi)?Gh!==null?{scheme:Gh,authority:void 0,path:(0,jh.uriToString)(n)}:null:n}Ct.mapUriDefaultScheme=FI});var Qn=y(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});Wn.QueuePicker=Wn.UnavailablePicker=Wn.PickResultType=void 0;var BI=ot(),qI=ee(),Qa=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Qa||(Wn.PickResultType=Qa={})),$h=class{constructor(e){this.status=Object.assign({code:qI.Status.UNAVAILABLE,details:"No connection established",metadata:new BI.Metadata},e)}pick(e){return{pickResultType:Qa.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Wn.UnavailablePicker=$h;var Kh=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Qa.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Wn.QueuePicker=Kh});var Ys=y(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});Ya.BackoffTimeout=void 0;var UI=1e3,VI=1.6,zI=12e4,GI=.2;function jI(n,e){return Math.random()*(e-n)+n}var Hh=class{constructor(e,t){this.callback=e,this.initialDelay=UI,this.multiplier=VI,this.maxDelay=zI,this.jitter=GI,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+jI(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Ya.BackoffTimeout=Hh});var Ja=y(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});Xa.ChildLoadBalancerHandler=void 0;var $I=$n(),KI=_t(),HI="child_load_balancer_helper",Wh=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===KI.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,$I.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return HI}};Xa.ChildLoadBalancerHandler=Wh});var sT=y(Za=>{"use strict";Object.defineProperty(Za,"__esModule",{value:!0});Za.ResolvingLoadBalancer=void 0;var WI=$n(),QI=zh(),ut=_t(),YI=Jt(),mi=Qn(),XI=Ys(),Qh=ee(),JI=ot(),ZI=Te(),eA=ee(),tA=gt(),nA=Ja(),rA="resolving_load_balancer";function iT(n){ZI.trace(eA.LogVerbosity.DEBUG,rA,n)}var iA=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function sA(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function oA(n,e,t,r){for(let i of t)if(sA(n,e,i,r))return i;return null}function aA(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of iA){let u=oA(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Qh.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Qh.Status.OK,dynamicFilterFactories:[]}}}var Yh=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=ut.ConnectivityState.IDLE,this.latestChildPicker=new mi.QueuePicker(this),this.currentState=ut.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,QI.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(ut.ConnectivityState.IDLE,new mi.QueuePicker(this)),this.childLoadBalancer=new nA.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(iT("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,YI.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let m=(f=p?.loadBalancingConfig)!==null&&f!==void 0?f:[],g=(0,WI.getFirstUsableConfig)(m,!0);if(g===null){this.handleResolutionFailure({code:Qh.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new JI.Metadata});return}this.childLoadBalancer.updateAddressList(a,g,d);let v=p??this.defaultServiceConfig;this.onSuccessfulResolution(v,u??aA(v))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new XI.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===ut.ConnectivityState.IDLE&&this.updateState(ut.ConnectivityState.CONNECTING,new mi.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){iT((0,tA.uriToString)(this.target)+" "+ut.ConnectivityState[this.currentState]+" -> "+ut.ConnectivityState[e]),e===ut.ConnectivityState.IDLE&&(t=new mi.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===ut.ConnectivityState.IDLE&&(this.updateState(ut.ConnectivityState.TRANSIENT_FAILURE,new mi.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===ut.ConnectivityState.IDLE||this.currentState===ut.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=ut.ConnectivityState.IDLE,this.latestChildPicker=new mi.QueuePicker(this),this.currentState=ut.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Za.ResolvingLoadBalancer=Yh});var oT=y(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.channelOptionsEqual=gi.recognizedOptions=void 0;gi.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function lA(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}gi.channelOptionsEqual=lA});var en=y(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.stringToSubchannelAddress=Zt.subchannelAddressToString=Zt.subchannelAddressEqual=Zt.isTcpSubchannelAddress=void 0;var cA=re("net");function Xs(n){return"port"in n}Zt.isTcpSubchannelAddress=Xs;function uA(n,e){return!n&&!e?!0:!n||!e?!1:Xs(n)?Xs(e)&&n.host===e.host&&n.port===e.port:!Xs(e)&&n.path===e.path}Zt.subchannelAddressEqual=uA;function hA(n){return Xs(n)?n.host+":"+n.port:n.path}Zt.subchannelAddressToString=hA;var dA=443;function fA(n,e){return(0,cA.isIP)(n)?{host:n,port:e??dA}:{path:n}}Zt.stringToSubchannelAddress=fA});var el=y(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.addAdminServicesToServer=yi.registerAdminService=void 0;var aT=[];function pA(n,e){aT.push({getServiceDefinition:n,getHandlers:e})}yi.registerAdminService=pA;function mA(n){for(let{getServiceDefinition:e,getHandlers:t}of aT)n.addService(e(),t())}yi.addAdminServicesToServer=mA});var lT=y(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.ClientDuplexStreamImpl=bt.ClientWritableStreamImpl=bt.ClientReadableStreamImpl=bt.ClientUnaryCallImpl=bt.callErrorFromStatus=void 0;var gA=re("events"),td=re("stream"),Js=ee();function yA(n,e){let t=`${n.code} ${Js.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}bt.callErrorFromStatus=yA;var Xh=class extends gA.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Js.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};bt.ClientUnaryCallImpl=Xh;var Jh=class extends td.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Js.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};bt.ClientReadableStreamImpl=Jh;var Zh=class extends td.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Js.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};bt.ClientWritableStreamImpl=Zh;var ed=class extends td.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Js.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};bt.ClientDuplexStreamImpl=ed});var cT=y(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.InterceptingListenerImpl=vi.isInterceptingListener=void 0;function vA(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}vi.isInterceptingListener=vA;var nd=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};vi.InterceptingListenerImpl=nd});var cd=y(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.getInterceptingCall=It.InterceptingCall=It.RequesterBuilder=It.ListenerBuilder=It.InterceptorConfigurationError=void 0;var TA=ot(),uT=cT(),hT=ee(),dT=qa(),eo=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};It.InterceptorConfigurationError=eo;var id=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};It.ListenerBuilder=id;var sd=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};It.RequesterBuilder=sd;var rd={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Zs={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},od=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Zs.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Zs.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Zs.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Zs.cancel}:this.requester=Zs}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,p,m;this.processingMetadata=!1;let g;if((0,uT.isInterceptingListener)(d))g=d;else{let v={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:rd.onReceiveMetadata,onReceiveMessage:(p=d.onReceiveMessage)!==null&&p!==void 0?p:rd.onReceiveMessage,onReceiveStatus:(m=d.onReceiveStatus)!==null&&m!==void 0?m:rd.onReceiveStatus};g=new uT.InterceptingListenerImpl(v,c)}this.nextCall.start(u,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};It.InterceptingCall=od;function SA(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var tl=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(hT.Status.INTERNAL,`Request message serialization failure: ${(0,dT.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:hT.Status.INTERNAL,details:`Response message parsing error: ${(0,dT.getErrorMessage)(a)}`,metadata:new TA.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},ad=class extends tl{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},ld=class extends tl{};function wA(n,e,t){let r=SA(n,t.path,e);return t.responseStream?new ld(r,t):new ad(r,t)}function EA(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new eo("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new eo("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>wA(r,a,e))(s)}It.getInterceptingCall=EA});var dd=y(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0});rl.Client=void 0;var tn=lT(),_A=fd(),CA=_t(),Yn=ee(),Ti=ot(),nl=cd(),Ft=Symbol(),Si=Symbol(),wi=Symbol(),An=Symbol();function ud(n){return typeof n=="function"}function Ei(n){return n.stack.split(`
`).slice(1).join(`
`)}var hd=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Si]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[wi]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Si].length>0&&this[wi].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[An]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Ft]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Ft]=o(e,t,r)}else this[Ft]=new _A.ChannelImplementation(e,t,r)}close(){this[Ft].close()}getChannel(){return this[Ft]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Ft].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===CA.ConnectivityState.READY)t();else try{this[Ft].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(ud(e))return{metadata:new Ti.Metadata,options:{},callback:e};if(ud(t))return e instanceof Ti.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Ti.Metadata,options:e,callback:t};if(!(e instanceof Ti.Metadata&&t instanceof Object&&ud(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new tn.ClientUnaryCallImpl,channel:this[Ft],methodDefinition:d,callOptions:u.options,callback:u.callback};this[An]&&(f=this[An](f));let p=f.call,m={clientInterceptors:this[Si],clientInterceptorProviders:this[wi],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},g=(0,nl.getInterceptingCall)(m,f.methodDefinition,f.callOptions,f.channel);p.call=g;let v=null,A=!1,w=new Error;return g.start(f.metadata,{onReceiveMetadata:k=>{p.emit("metadata",k)},onReceiveMessage(k){v!==null&&g.cancelWithStatus(Yn.Status.INTERNAL,"Too many responses received"),v=k},onReceiveStatus(k){if(!A){if(A=!0,k.code===Yn.Status.OK)if(v===null){let N=Ei(w);f.callback((0,tn.callErrorFromStatus)({code:Yn.Status.INTERNAL,details:"No message received",metadata:k.metadata},N))}else f.callback(null,v);else{let N=Ei(w);f.callback((0,tn.callErrorFromStatus)(k,N))}w=null,p.emit("status",k)}}}),g.sendMessage(i),g.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new tn.ClientWritableStreamImpl(t),channel:this[Ft],methodDefinition:u,callOptions:c.options,callback:c.callback};this[An]&&(d=this[An](d));let f=d.call,p={clientInterceptors:this[Si],clientInterceptorProviders:this[wi],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},m=(0,nl.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);f.call=m;let g=null,v=!1,A=new Error;return m.start(d.metadata,{onReceiveMetadata:w=>{f.emit("metadata",w)},onReceiveMessage(w){g!==null&&m.cancelWithStatus(Yn.Status.INTERNAL,"Too many responses received"),g=w},onReceiveStatus(w){if(!v){if(v=!0,w.code===Yn.Status.OK)if(g===null){let k=Ei(A);d.callback((0,tn.callErrorFromStatus)({code:Yn.Status.INTERNAL,details:"No message received",metadata:w.metadata},k))}else d.callback(null,g);else{let k=Ei(A);d.callback((0,tn.callErrorFromStatus)(w,k))}A=null,f.emit("status",w)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof Ti.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Ti.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new tn.ClientReadableStreamImpl(r),channel:this[Ft],methodDefinition:u,callOptions:c.options};this[An]&&(d=this[An](d));let f=d.call,p={clientInterceptors:this[Si],clientInterceptorProviders:this[wi],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},m=(0,nl.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);f.call=m;let g=!1,v=new Error;return m.start(d.metadata,{onReceiveMetadata(A){f.emit("metadata",A)},onReceiveMessage(A){f.push(A)},onReceiveStatus(A){if(!g){if(g=!0,f.push(null),A.code!==Yn.Status.OK){let w=Ei(v);f.emit("error",(0,tn.callErrorFromStatus)(A,w))}v=null,f.emit("status",A)}}}),m.sendMessage(i),m.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new tn.ClientDuplexStreamImpl(t,r),channel:this[Ft],methodDefinition:c,callOptions:l.options};this[An]&&(u=this[An](u));let d=u.call,f={clientInterceptors:this[Si],clientInterceptorProviders:this[wi],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,nl.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=p;let m=!1,g=new Error;return p.start(u.metadata,{onReceiveMetadata(v){d.emit("metadata",v)},onReceiveMessage(v){d.push(v)},onReceiveStatus(v){if(!m){if(m=!0,d.push(null),v.code!==Yn.Status.OK){let A=Ei(g);d.emit("error",(0,tn.callErrorFromStatus)(v,A))}g=null,d.emit("status",v)}}}),d}};rl.Client=hd});var md=y(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.loadPackageDefinition=_i.makeClientConstructor=void 0;var to=dd(),bA={unary:to.Client.prototype.makeUnaryRequest,server_stream:to.Client.prototype.makeServerStreamRequest,client_stream:to.Client.prototype.makeClientStreamRequest,bidi:to.Client.prototype.makeBidiStreamRequest};function pd(n){return["__proto__","prototype","constructor"].includes(n)}function fT(n,e,t){t||(t={});class r extends to.Client{}return Object.keys(n).forEach(i=>{if(pd(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=IA(bA[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!pd(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}_i.makeClientConstructor=fT;function IA(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function AA(n){return"format"in n}function RA(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>pd(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];AA(r)?o[s]=r:o[s]=fT(r,s,{})}return e}_i.loadPackageDefinition=RA});var BT=y((OB,FT)=>{"use strict";var DA=1/0,NA="[object Symbol]",OA=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,xA=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,sl="\\ud800-\\udfff",wT="\\u0300-\\u036f\\ufe20-\\ufe23",ET="\\u20d0-\\u20f0",_T="\\u2700-\\u27bf",CT="a-z\\xdf-\\xf6\\xf8-\\xff",kA="\\xac\\xb1\\xd7\\xf7",MA="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",PA="\\u2000-\\u206f",LA=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bT="A-Z\\xc0-\\xd6\\xd8-\\xde",IT="\\ufe0e\\ufe0f",AT=kA+MA+PA+LA,yd="['\u2019]",FA="["+sl+"]",pT="["+AT+"]",il="["+wT+ET+"]",RT="\\d+",BA="["+_T+"]",DT="["+CT+"]",NT="[^"+sl+AT+RT+_T+CT+bT+"]",gd="\\ud83c[\\udffb-\\udfff]",qA="(?:"+il+"|"+gd+")",OT="[^"+sl+"]",vd="(?:\\ud83c[\\udde6-\\uddff]){2}",Td="[\\ud800-\\udbff][\\udc00-\\udfff]",Ci="["+bT+"]",xT="\\u200d",mT="(?:"+DT+"|"+NT+")",UA="(?:"+Ci+"|"+NT+")",gT="(?:"+yd+"(?:d|ll|m|re|s|t|ve))?",yT="(?:"+yd+"(?:D|LL|M|RE|S|T|VE))?",kT=qA+"?",MT="["+IT+"]?",VA="(?:"+xT+"(?:"+[OT,vd,Td].join("|")+")"+MT+kT+")*",PT=MT+kT+VA,zA="(?:"+[BA,vd,Td].join("|")+")"+PT,GA="(?:"+[OT+il+"?",il,vd,Td,FA].join("|")+")",jA=RegExp(yd,"g"),$A=RegExp(il,"g"),KA=RegExp(gd+"(?="+gd+")|"+GA+PT,"g"),HA=RegExp([Ci+"?"+DT+"+"+gT+"(?="+[pT,Ci,"$"].join("|")+")",UA+"+"+yT+"(?="+[pT,Ci+mT,"$"].join("|")+")",Ci+"?"+mT+"+"+gT,Ci+"+"+yT,RT,zA].join("|"),"g"),WA=RegExp("["+xT+sl+wT+ET+IT+"]"),QA=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,YA={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},XA=typeof global=="object"&&global&&global.Object===Object&&global,JA=typeof self=="object"&&self&&self.Object===Object&&self,ZA=XA||JA||Function("return this")();function eR(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function tR(n){return n.split("")}function nR(n){return n.match(OA)||[]}function rR(n){return function(e){return n?.[e]}}var iR=rR(YA);function LT(n){return WA.test(n)}function sR(n){return QA.test(n)}function oR(n){return LT(n)?aR(n):tR(n)}function aR(n){return n.match(KA)||[]}function lR(n){return n.match(HA)||[]}var cR=Object.prototype,uR=cR.toString,vT=ZA.Symbol,TT=vT?vT.prototype:void 0,ST=TT?TT.toString:void 0;function hR(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function dR(n){if(typeof n=="string")return n;if(yR(n))return ST?ST.call(n):"";var e=n+"";return e=="0"&&1/n==-DA?"-0":e}function fR(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:hR(n,e,t)}function pR(n){return function(e){e=ol(e);var t=LT(e)?oR(e):void 0,r=t?t[0]:e.charAt(0),i=t?fR(t,1).join(""):e.slice(1);return r[n]()+i}}function mR(n){return function(e){return eR(ER(SR(e).replace(jA,"")),n,"")}}function gR(n){return!!n&&typeof n=="object"}function yR(n){return typeof n=="symbol"||gR(n)&&uR.call(n)==NA}function ol(n){return n==null?"":dR(n)}var vR=mR(function(n,e,t){return e=e.toLowerCase(),n+(t?TR(e):e)});function TR(n){return wR(ol(n).toLowerCase())}function SR(n){return n=ol(n),n&&n.replace(xA,iR).replace($A,"")}var wR=pR("toUpperCase");function ER(n,e,t){return n=ol(n),e=t?void 0:e,e===void 0?sR(n)?lR(n):nR(n):n.match(e)||[]}FT.exports=vR});var Sd=y((xB,qT)=>{"use strict";qT.exports=_R;function _R(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var GT=y(zT=>{"use strict";var al=zT;al.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var bi=new Array(64),VT=new Array(123);for(Bt=0;Bt<64;)VT[bi[Bt]=Bt<26?Bt+65:Bt<52?Bt+71:Bt<62?Bt-4:Bt-59|43]=Bt++;var Bt;al.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=bi[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=bi[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=bi[l|c>>6],s[o++]=bi[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=bi[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var UT="invalid encoding";al.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=VT[l])===void 0)throw Error(UT);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(UT);return r-i};al.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var $T=y((MB,jT)=>{"use strict";jT.exports=ll;function ll(){this._listeners={}}ll.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};ll.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};ll.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var JT=y((PB,XT)=>{"use strict";XT.exports=KT(KT);function KT(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,HT),n.writeFloatBE=e.bind(null,WT);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,QT),n.readFloatBE=t.bind(null,YT)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,HT,0,4),n.writeDoubleBE=e.bind(null,WT,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,QT,0,4),n.readDoubleBE=t.bind(null,YT,4,0)}(),n}function HT(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function WT(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function QT(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function YT(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var wd=y((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var eS=y(ZT=>{"use strict";var Ed=ZT;Ed.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Ed.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Ed.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var nS=y((FB,tS)=>{"use strict";tS.exports=CR;function CR(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var iS=y((BB,rS)=>{"use strict";rS.exports=Pe;var no=nn();function Pe(n,e){this.lo=n>>>0,this.hi=e>>>0}var Rr=Pe.zero=new Pe(0,0);Rr.toNumber=function(){return 0};Rr.zzEncode=Rr.zzDecode=function(){return this};Rr.length=function(){return 1};var bR=Pe.zeroHash="\0\0\0\0\0\0\0\0";Pe.fromNumber=function(e){if(e===0)return Rr;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Pe(r,i)};Pe.from=function(e){if(typeof e=="number")return Pe.fromNumber(e);if(no.isString(e))if(no.Long)e=no.Long.fromString(e);else return Pe.fromNumber(parseInt(e,10));return e.low||e.high?new Pe(e.low>>>0,e.high>>>0):Rr};Pe.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Pe.prototype.toLong=function(e){return no.Long?new no.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Xn=String.prototype.charCodeAt;Pe.fromHash=function(e){return e===bR?Rr:new Pe((Xn.call(e,0)|Xn.call(e,1)<<8|Xn.call(e,2)<<16|Xn.call(e,3)<<24)>>>0,(Xn.call(e,4)|Xn.call(e,5)<<8|Xn.call(e,6)<<16|Xn.call(e,7)<<24)>>>0)};Pe.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Pe.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Pe.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Pe.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var nn=y(_d=>{"use strict";var M=_d;M.asPromise=Sd();M.base64=GT();M.EventEmitter=$T();M.float=JT();M.inquire=wd();M.utf8=eS();M.pool=nS();M.LongBits=iS();M.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);M.global=M.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||_d;M.emptyArray=Object.freeze?Object.freeze([]):[];M.emptyObject=Object.freeze?Object.freeze({}):{};M.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};M.isString=function(e){return typeof e=="string"||e instanceof String};M.isObject=function(e){return e&&typeof e=="object"};M.isset=M.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};M.Buffer=function(){try{var n=M.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();M._Buffer_from=null;M._Buffer_allocUnsafe=null;M.newBuffer=function(e){return typeof e=="number"?M.Buffer?M._Buffer_allocUnsafe(e):new M.Array(e):M.Buffer?M._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};M.Array=typeof Uint8Array<"u"?Uint8Array:Array;M.Long=M.global.dcodeIO&&M.global.dcodeIO.Long||M.global.Long||M.inquire("long");M.key2Re=/^true|false|0|1$/;M.key32Re=/^-?(?:0|[1-9][0-9]*)$/;M.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;M.longToHash=function(e){return e?M.LongBits.from(e).toHash():M.LongBits.zeroHash};M.longFromHash=function(e,t){var r=M.LongBits.fromHash(e);return M.Long?M.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function sS(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}M.merge=sS;M.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function oS(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&sS(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}M.newError=oS;M.ProtocolError=oS("ProtocolError");M.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};M.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};M.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};M._configure=function(){var n=M.Buffer;if(!n){M._Buffer_from=M._Buffer_allocUnsafe=null;return}M._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},M._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var ul=y((UB,uS)=>{"use strict";uS.exports=Z;var At=nn(),Cd,cl=At.LongBits,aS=At.base64,lS=At.utf8;function ro(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Id(){}function IR(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function Z(){this.len=0,this.head=new ro(Id,0,0),this.tail=this.head,this.states=null}var cS=function(){return At.Buffer?function(){return(Z.create=function(){return new Cd})()}:function(){return new Z}};Z.create=cS();Z.alloc=function(e){return new At.Array(e)};At.Array!==Array&&(Z.alloc=At.pool(Z.alloc,At.Array.prototype.subarray));Z.prototype._push=function(e,t,r){return this.tail=this.tail.next=new ro(e,t,r),this.len+=t,this};function Ad(n,e,t){e[t]=n&255}function AR(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Rd(n,e){this.len=n,this.next=void 0,this.val=e}Rd.prototype=Object.create(ro.prototype);Rd.prototype.fn=AR;Z.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Rd((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Z.prototype.int32=function(e){return e<0?this._push(Dd,10,cl.fromNumber(e)):this.uint32(e)};Z.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Dd(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}Z.prototype.uint64=function(e){var t=cl.from(e);return this._push(Dd,t.length(),t)};Z.prototype.int64=Z.prototype.uint64;Z.prototype.sint64=function(e){var t=cl.from(e).zzEncode();return this._push(Dd,t.length(),t)};Z.prototype.bool=function(e){return this._push(Ad,1,e?1:0)};function bd(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}Z.prototype.fixed32=function(e){return this._push(bd,4,e>>>0)};Z.prototype.sfixed32=Z.prototype.fixed32;Z.prototype.fixed64=function(e){var t=cl.from(e);return this._push(bd,4,t.lo)._push(bd,4,t.hi)};Z.prototype.sfixed64=Z.prototype.fixed64;Z.prototype.float=function(e){return this._push(At.float.writeFloatLE,4,e)};Z.prototype.double=function(e){return this._push(At.float.writeDoubleLE,8,e)};var RR=At.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};Z.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Ad,1,0);if(At.isString(e)){var r=Z.alloc(t=aS.length(e));aS.decode(e,r,0),e=r}return this.uint32(t)._push(RR,t,e)};Z.prototype.string=function(e){var t=lS.length(e);return t?this.uint32(t)._push(lS.write,t,e):this._push(Ad,1,0)};Z.prototype.fork=function(){return this.states=new IR(this),this.head=this.tail=new ro(Id,0,0),this.len=0,this};Z.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ro(Id,0,0),this.len=0),this};Z.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};Z.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};Z._configure=function(n){Cd=n,Z.create=cS(),Cd._configure()}});var fS=y((VB,dS)=>{"use strict";dS.exports=rn;var hS=ul();(rn.prototype=Object.create(hS.prototype)).constructor=rn;var Jn=nn();function rn(){hS.call(this)}rn._configure=function(){rn.alloc=Jn._Buffer_allocUnsafe,rn.writeBytesBuffer=Jn.Buffer&&Jn.Buffer.prototype instanceof Uint8Array&&Jn.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};rn.prototype.bytes=function(e){Jn.isString(e)&&(e=Jn._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(rn.writeBytesBuffer,t,e),this};function DR(n,e,t){n.length<40?Jn.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}rn.prototype.string=function(e){var t=Jn.Buffer.byteLength(e);return this.uint32(t),t&&this._push(DR,t,e),this};rn._configure()});var dl=y((zB,vS)=>{"use strict";vS.exports=_e;var qt=nn(),Od,gS=qt.LongBits,NR=qt.utf8;function Ut(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function _e(n){this.buf=n,this.pos=0,this.len=n.length}var pS=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new _e(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new _e(e);throw Error("illegal buffer")},yS=function(){return qt.Buffer?function(t){return(_e.create=function(i){return qt.Buffer.isBuffer(i)?new Od(i):pS(i)})(t)}:pS};_e.create=yS();_e.prototype._slice=qt.Array.prototype.subarray||qt.Array.prototype.slice;_e.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Ut(this,10);return e}}();_e.prototype.int32=function(){return this.uint32()|0};_e.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Nd(){var n=new gS(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Ut(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Ut(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}_e.prototype.bool=function(){return this.uint32()!==0};function hl(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}_e.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ut(this,4);return hl(this.buf,this.pos+=4)};_e.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ut(this,4);return hl(this.buf,this.pos+=4)|0};function mS(){if(this.pos+8>this.len)throw Ut(this,8);return new gS(hl(this.buf,this.pos+=4),hl(this.buf,this.pos+=4))}_e.prototype.float=function(){if(this.pos+4>this.len)throw Ut(this,4);var e=qt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};_e.prototype.double=function(){if(this.pos+8>this.len)throw Ut(this,4);var e=qt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};_e.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Ut(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=qt.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};_e.prototype.string=function(){var e=this.bytes();return NR.read(e,0,e.length)};_e.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Ut(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Ut(this);while(this.buf[this.pos++]&128);return this};_e.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};_e._configure=function(n){Od=n,_e.create=yS(),Od._configure();var e=qt.Long?"toLong":"toNumber";qt.merge(_e.prototype,{int64:function(){return Nd.call(this)[e](!1)},uint64:function(){return Nd.call(this)[e](!0)},sint64:function(){return Nd.call(this).zzDecode()[e](!1)},fixed64:function(){return mS.call(this)[e](!0)},sfixed64:function(){return mS.call(this)[e](!1)}})}});var ES=y((GB,wS)=>{"use strict";wS.exports=Dr;var SS=dl();(Dr.prototype=Object.create(SS.prototype)).constructor=Dr;var TS=nn();function Dr(n){SS.call(this,n)}Dr._configure=function(){TS.Buffer&&(Dr.prototype._slice=TS.Buffer.prototype.slice)};Dr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Dr._configure()});var CS=y((jB,_S)=>{"use strict";_S.exports=io;var xd=nn();(io.prototype=Object.create(xd.EventEmitter.prototype)).constructor=io;function io(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");xd.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}io.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return xd.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};io.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var kd=y(bS=>{"use strict";var OR=bS;OR.Service=CS()});var Md=y((KB,IS)=>{"use strict";IS.exports={}});var DS=y(RS=>{"use strict";var ht=RS;ht.build="minimal";ht.Writer=ul();ht.BufferWriter=fS();ht.Reader=dl();ht.BufferReader=ES();ht.util=nn();ht.rpc=kd();ht.roots=Md();ht.configure=AS;function AS(){ht.util._configure(),ht.Writer._configure(ht.BufferWriter),ht.Reader._configure(ht.BufferReader)}AS()});var OS=y((WB,NS)=>{"use strict";NS.exports=Pd;function Pd(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Pd.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(m,g){var v=d[f++];switch(g){case"d":case"f":return String(Number(v));case"i":return String(Math.floor(v));case"j":return JSON.stringify(v);case"s":return String(v)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Pd.verbose=!1});var kS=y((QB,xS)=>{"use strict";xS.exports=so;var xR=Sd(),kR=wd(),Ld=kR("fs");function so(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Ld&&Ld.readFile?Ld.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?so.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):so.xhr(n,e,t):xR(so,this,n,e)}so.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var LS=y(PS=>{"use strict";var Bd=PS,MS=Bd.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Fd=Bd.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=MS(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Bd.resolve=function(e,t,r){return r||(t=Fd(t)),MS(t)?t:(r||(e=Fd(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Fd(e+"/"+t):t)}});var Nr=y(FS=>{"use strict";var oo=FS,MR=Le(),PR=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function ao(n,e){var t=0,r={};for(e|=0;t<n.length;)r[PR[t+e]]=n[t++];return r}oo.basic=ao([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);oo.defaults=ao([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",MR.emptyArray,null]);oo.long=ao([0,0,0,1,1],7);oo.mapKey=ao([0,0,0,5,5,0,0,0,1,1,0,2],2);oo.packed=ao([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Zn=y((JB,US)=>{"use strict";US.exports=Rt;var fl=Or();((Rt.prototype=Object.create(fl.prototype)).constructor=Rt).className="Field";var BS=Vt(),qS=Nr(),Ae=Le(),qd,LR=/^required|optional|repeated$/;Rt.fromJSON=function(e,t){return new Rt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Rt(n,e,t,r,i,s,o){if(Ae.isObject(r)?(o=i,s=r,r=i=void 0):Ae.isObject(i)&&(o=s,s=i,i=void 0),fl.call(this,n,s),!Ae.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Ae.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!LR.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Ae.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ae.Long?qS.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Rt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Rt.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),fl.prototype.setOption.call(this,e,t,r)};Rt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ae.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Rt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=qS.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof qd?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof BS&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof BS))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ae.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Ae.base64.test(this.typeDefault)?Ae.base64.decode(this.typeDefault,e=Ae.newBuffer(Ae.base64.length(this.typeDefault)),0):Ae.utf8.write(this.typeDefault,e=Ae.newBuffer(Ae.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Ae.emptyObject:this.repeated?this.defaultValue=Ae.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof qd&&(this.parent.ctor.prototype[this.name]=this.defaultValue),fl.prototype.resolve.call(this)};Rt.d=function(e,t,r,i){return typeof t=="function"?t=Ae.decorateType(t).name:t&&typeof t=="object"&&(t=Ae.decorateEnum(t).name),function(o,a){Ae.decorateType(o.constructor).add(new Rt(a,e,t,r,{default:i}))}};Rt._configure=function(e){qd=e}});var Ii=y((ZB,GS)=>{"use strict";GS.exports=Dt;var ml=Or();((Dt.prototype=Object.create(ml.prototype)).constructor=Dt).className="OneOf";var VS=Zn(),pl=Le();function Dt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),ml.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Dt.fromJSON=function(e,t){return new Dt(e,t.oneof,t.options,t.comment)};Dt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return pl.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function zS(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Dt.prototype.add=function(e){if(!(e instanceof VS))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,zS(this),this};Dt.prototype.remove=function(e){if(!(e instanceof VS))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Dt.prototype.onAdd=function(e){ml.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}zS(this)};Dt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);ml.prototype.onRemove.call(this,e)};Dt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){pl.decorateType(i.constructor).add(new Dt(s,e)),Object.defineProperty(i,s,{get:pl.oneOfGetter(e),set:pl.oneOfSetter(e)})}}});var Di=y((eq,HS)=>{"use strict";HS.exports=te;var Ud=Or();((te.prototype=Object.create(Ud.prototype)).constructor=te).className="Namespace";var jS=Zn(),gl=Le(),FR=Ii(),Ai,lo,Ri;te.fromJSON=function(e,t){return new te(e,t.options).addJSON(t.nested)};function $S(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}te.arrayToJSON=$S;te.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};te.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function te(n,e){Ud.call(this,n,e),this.nested=void 0,this._nestedArray=null}function KS(n){return n._nestedArray=null,n}Object.defineProperty(te.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=gl.toArray(this.nested))}});te.prototype.toJSON=function(e){return gl.toObject(["options",this.options,"nested",$S(this.nestedArray,e)])};te.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Ai.fromJSON:s.values!==void 0?Ri.fromJSON:s.methods!==void 0?lo.fromJSON:s.id!==void 0?jS.fromJSON:te.fromJSON)(r[i],s));return this};te.prototype.get=function(e){return this.nested&&this.nested[e]||null};te.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Ri)return this.nested[e].values;throw Error("no such enum: "+e)};te.prototype.add=function(e){if(!(e instanceof jS&&e.extend!==void 0||e instanceof Ai||e instanceof FR||e instanceof Ri||e instanceof lo||e instanceof te))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof te&&e instanceof te&&!(t instanceof Ai||t instanceof lo)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),KS(this)};te.prototype.remove=function(e){if(!(e instanceof Ud))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),KS(this)};te.prototype.define=function(e,t){if(gl.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof te))throw Error("path conflicts with non-namespace objects")}else r.add(r=new te(i))}return t&&r.addJSON(t),r};te.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof te?e[t++].resolveAll():e[t++].resolve();return this.resolve()};te.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),gl.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof te&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof te&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};te.prototype.lookupType=function(e){var t=this.lookup(e,[Ai]);if(!t)throw Error("no such type: "+e);return t};te.prototype.lookupEnum=function(e){var t=this.lookup(e,[Ri]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};te.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Ai,Ri]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};te.prototype.lookupService=function(e){var t=this.lookup(e,[lo]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};te._configure=function(n,e,t){Ai=n,lo=e,Ri=t}});var yl=y((tq,WS)=>{"use strict";WS.exports=Rn;var Vd=Zn();((Rn.prototype=Object.create(Vd.prototype)).constructor=Rn).className="MapField";var BR=Nr(),co=Le();function Rn(n,e,t,r,i,s){if(Vd.call(this,n,e,r,void 0,void 0,i,s),!co.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Rn.fromJSON=function(e,t){return new Rn(e,t.id,t.keyType,t.type,t.options,t.comment)};Rn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return co.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Rn.prototype.resolve=function(){if(this.resolved)return this;if(BR.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Vd.prototype.resolve.call(this)};Rn.d=function(e,t,r){return typeof r=="function"?r=co.decorateType(r).name:r&&typeof r=="object"&&(r=co.decorateEnum(r).name),function(s,o){co.decorateType(s.constructor).add(new Rn(o,e,t,r))}}});var vl=y((nq,QS)=>{"use strict";QS.exports=xr;var zd=Or();((xr.prototype=Object.create(zd.prototype)).constructor=xr).className="Method";var Ni=Le();function xr(n,e,t,r,i,s,o,a,l){if(Ni.isObject(i)?(o=i,i=s=void 0):Ni.isObject(s)&&(o=s,s=void 0),!(e===void 0||Ni.isString(e)))throw TypeError("type must be a string");if(!Ni.isString(t))throw TypeError("requestType must be a string");if(!Ni.isString(r))throw TypeError("responseType must be a string");zd.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}xr.fromJSON=function(e,t){return new xr(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};xr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ni.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};xr.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),zd.prototype.resolve.call(this))}});var Tl=y((rq,XS)=>{"use strict";XS.exports=Nt;var er=Di();((Nt.prototype=Object.create(er.prototype)).constructor=Nt).className="Service";var Gd=vl(),uo=Le(),qR=kd();function Nt(n,e){er.call(this,n,e),this.methods={},this._methodsArray=null}Nt.fromJSON=function(e,t){var r=new Nt(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Gd.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Nt.prototype.toJSON=function(e){var t=er.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return uo.toObject(["options",t&&t.options||void 0,"methods",er.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Nt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=uo.toArray(this.methods))}});function YS(n){return n._methodsArray=null,n}Nt.prototype.get=function(e){return this.methods[e]||er.prototype.get.call(this,e)};Nt.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return er.prototype.resolve.call(this)};Nt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Gd?(this.methods[e.name]=e,e.parent=this,YS(this)):er.prototype.add.call(this,e)};Nt.prototype.remove=function(e){if(e instanceof Gd){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,YS(this)}return er.prototype.remove.call(this,e)};Nt.prototype.create=function(e,t,r){for(var i=new qR.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=uo.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=uo.codegen(["r","c"],uo.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Sl=y((iq,JS)=>{"use strict";JS.exports=sn;var UR=nn();function sn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}sn.create=function(e){return this.$type.create(e)};sn.encode=function(e,t){return this.$type.encode(e,t)};sn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};sn.decode=function(e){return this.$type.decode(e)};sn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};sn.verify=function(e){return this.$type.verify(e)};sn.fromObject=function(e){return this.$type.fromObject(e)};sn.toObject=function(e,t){return this.$type.toObject(e,t)};sn.prototype.toJSON=function(){return this.$type.toObject(this,UR.toJSONOptions)}});var jd=y((sq,e0)=>{"use strict";e0.exports=GR;var VR=Vt(),Dn=Nr(),ZS=Le();function zR(n){return"missing required '"+n.name+"'"}function GR(n){var e=ZS.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof VR?"int32":r.type,s="m"+ZS.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Dn.defaults[r.keyType]!==void 0?e("k=%j",Dn.defaults[r.keyType]):e("k=null"),Dn.defaults[i]!==void 0?e("value=%j",Dn.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),Dn.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Dn.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Dn.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),Dn.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):Dn.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",zR(o))}return e("return m")}});var Hd=y((oq,t0)=>{"use strict";t0.exports=KR;var jR=Vt(),$d=Le();function Ot(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Kd(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof jR){n("switch(%s){",r)("default:")("return%j",Ot(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Ot(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Ot(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Ot(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Ot(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Ot(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Ot(e,"buffer"));break}return n}function $R(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Ot(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Ot(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Ot(e,"boolean key"));break}return n}function KR(n){var e=$d.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+$d.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",Ot(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),$R(e,s,"k[i]"),Kd(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Ot(s,"array"))("for(var i=0;i<%s.length;++i){",o),Kd(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=$d.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}Kd(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Yd=y(r0=>{"use strict";var n0=r0,ho=Vt(),on=Le();function Wd(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof ho){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}n0.fromObject=function(e){var t=e.fieldsArray,r=on.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=on.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Wd(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Wd(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof ho||r("if(d%s!=null){",o),Wd(r,s,i,o),s.resolvedType instanceof ho||r("}"))}return r("return m")};function Qd(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof ho?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}n0.toObject=function(e){var t=e.fieldsArray.slice().sort(on.compareFieldsById);if(!t.length)return on.codegen()("return {}");for(var r=on.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",on.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",on.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=on.safeProp(l.name);if(l.resolvedType instanceof ho)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=on.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Qd(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Qd(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Qd(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",on.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Xd=y(i0=>{"use strict";var HR=i0,WR=Sl();HR[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof WR){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var _l=y((cq,o0)=>{"use strict";o0.exports=le;var zt=Di();((le.prototype=Object.create(zt.prototype)).constructor=le).className="Type";var QR=Vt(),ef=Ii(),wl=Zn(),YR=yl(),XR=Tl(),Jd=Sl(),Zd=dl(),JR=ul(),Ye=Le(),ZR=tf(),e1=jd(),t1=Hd(),s0=Yd(),n1=Xd();function le(n,e){zt.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(le.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ye.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ye.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=le.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Jd||((n.prototype=new Jd).constructor=n,Ye.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Ye.merge(n,Jd,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Ye.oneOfGetter(this._oneofsArray[t].oneof),set:Ye.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});le.generateConstructor=function(e){for(var t=Ye.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Ye.safeProp(i.name)):i.repeated&&t("this%s=[]",Ye.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function El(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}le.fromJSON=function(e,t){var r=new le(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?YR.fromJSON:wl.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(ef.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?wl.fromJSON:o.fields!==void 0?le.fromJSON:o.values!==void 0?QR.fromJSON:o.methods!==void 0?XR.fromJSON:zt.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};le.prototype.toJSON=function(e){var t=zt.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Ye.toObject(["options",t&&t.options||void 0,"oneofs",zt.arrayToJSON(this.oneofsArray,e),"fields",zt.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};le.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return zt.prototype.resolveAll.call(this)};le.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};le.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof wl&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),El(this)}return e instanceof ef?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),El(this)):zt.prototype.add.call(this,e)};le.prototype.remove=function(e){if(e instanceof wl&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),El(this)}if(e instanceof ef){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),El(this)}return zt.prototype.remove.call(this,e)};le.prototype.isReservedId=function(e){return zt.isReservedId(this.reserved,e)};le.prototype.isReservedName=function(e){return zt.isReservedName(this.reserved,e)};le.prototype.create=function(e){return new this.ctor(e)};le.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=ZR(this)({Writer:JR,types:t,util:Ye}),this.decode=e1(this)({Reader:Zd,types:t,util:Ye}),this.verify=t1(this)({types:t,util:Ye}),this.fromObject=s0.fromObject(this)({types:t,util:Ye}),this.toObject=s0.toObject(this)({types:t,util:Ye});var i=n1[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};le.prototype.encode=function(e,t){return this.setup().encode(e,t)};le.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};le.prototype.decode=function(e,t){return this.setup().decode(e,t)};le.prototype.decodeDelimited=function(e){return e instanceof Zd||(e=Zd.create(e)),this.decode(e,e.uint32())};le.prototype.verify=function(e){return this.setup().verify(e)};le.prototype.fromObject=function(e){return this.setup().fromObject(e)};le.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};le.d=function(e){return function(r){Ye.decorateType(r,e)}}});var Il=y((uq,h0)=>{"use strict";h0.exports=yt;var bl=Di();((yt.prototype=Object.create(bl.prototype)).constructor=yt).className="Root";var rf=Zn(),l0=Vt(),r1=Ii(),tr=Le(),c0,nf,fo;function yt(n){bl.call(this,"",n),this.deferred=[],this.files=[]}yt.fromJSON=function(e,t){return t||(t=new yt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};yt.prototype.resolvePath=tr.path.resolve;yt.prototype.fetch=tr.fetch;function u0(){}yt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return tr.asPromise(n,i,e,t);var s=r===u0;function o(p,m){if(r){if(s)throw p;var g=r;r=null,g(p,m)}}function a(p){var m=p.lastIndexOf("google/protobuf/");if(m>-1){var g=p.substring(m);if(g in fo)return g}return null}function l(p,m){try{if(tr.isString(m)&&m.charAt(0)==="{"&&(m=JSON.parse(m)),!tr.isString(m))i.setOptions(m.options).addJSON(m.nested);else{nf.filename=p;var g=nf(m,i,t),v,A=0;if(g.imports)for(;A<g.imports.length;++A)(v=a(g.imports[A])||i.resolvePath(p,g.imports[A]))&&c(v);if(g.weakImports)for(A=0;A<g.weakImports.length;++A)(v=a(g.weakImports[A])||i.resolvePath(p,g.weakImports[A]))&&c(v,!0)}}catch(w){o(w)}!s&&!u&&o(null,i)}function c(p,m){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in fo){s?l(p,fo[p]):(++u,setTimeout(function(){--u,l(p,fo[p])}));return}if(s){var g;try{g=tr.fs.readFileSync(p).toString("utf8")}catch(v){m||o(v);return}l(p,g)}else++u,i.fetch(p,function(v,A){if(--u,!!r){if(v){m?u||o(null,i):o(v);return}l(p,A)}})}}var u=0;tr.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);if(s)return i;u||o(null,i)};yt.prototype.loadSync=function(e,t){if(!tr.isNode)throw Error("not supported");return this.load(e,t,u0)};yt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return bl.prototype.resolveAll.call(this)};var Cl=/^[A-Z]/;function a0(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new rf(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}yt.prototype._handleAdd=function(e){if(e instanceof rf)e.extend!==void 0&&!e.extensionField&&(a0(this,e)||this.deferred.push(e));else if(e instanceof l0)Cl.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof r1)){if(e instanceof c0)for(var t=0;t<this.deferred.length;)a0(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Cl.test(e.name)&&(e.parent[e.name]=e)}};yt.prototype._handleRemove=function(e){if(e instanceof rf){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l0)Cl.test(e.name)&&delete e.parent[e.name];else if(e instanceof bl){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Cl.test(e.name)&&delete e.parent[e.name]}};yt._configure=function(n,e,t){c0=n,nf=e,fo=t}});var Le=y((hq,f0)=>{"use strict";var Ce=f0.exports=nn(),d0=Md(),sf,of;Ce.codegen=OS();Ce.fetch=kS();Ce.path=LS();Ce.fs=Ce.inquire("fs");Ce.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Ce.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var i1=/\\/g,s1=/"/g;Ce.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Ce.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Ce.isReserved(e)?'["'+e.replace(i1,"\\\\").replace(s1,'\\"')+'"]':"."+e};Ce.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var o1=/_([a-z])/g;Ce.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(o1,function(t,r){return r.toUpperCase()})};Ce.compareFieldsById=function(e,t){return e.id-t.id};Ce.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Ce.decorateRoot.remove(e.$type),e.$type.name=t,Ce.decorateRoot.add(e.$type)),e.$type;sf||(sf=_l());var r=new sf(t||e.name);return Ce.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var a1=0;Ce.decorateEnum=function(e){if(e.$type)return e.$type;of||(of=Vt());var t=new of("Enum"+a1++,e);return Ce.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Ce.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Ce,"decorateRoot",{get:function(){return d0.decorated||(d0.decorated=new(Il()))}})});var Or=y((dq,p0)=>{"use strict";p0.exports=vt;vt.className="ReflectionObject";var Al=Le(),Rl;function vt(n,e){if(!Al.isString(n))throw TypeError("name must be a string");if(e&&!Al.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(vt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});vt.prototype.toJSON=function(){throw Error()};vt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Rl&&t._handleAdd(this)};vt.prototype.onRemove=function(e){var t=e.root;t instanceof Rl&&t._handleRemove(this),this.parent=null,this.resolved=!1};vt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Rl&&(this.resolved=!0),this)};vt.prototype.getOption=function(e){if(this.options)return this.options[e]};vt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};vt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Al.setProperty(o,r,t)}else s={},s[e]=Al.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};vt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};vt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};vt._configure=function(n){Rl=n}});var Vt=y((fq,y0)=>{"use strict";y0.exports=an;var m0=Or();((an.prototype=Object.create(m0.prototype)).constructor=an).className="Enum";var g0=Di(),Dl=Le();function an(n,e,t,r,i,s){if(m0.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}an.fromJSON=function(e,t){var r=new an(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};an.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Dl.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};an.prototype.add=function(e,t,r,i){if(!Dl.isString(e))throw TypeError("name must be a string");if(!Dl.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};an.prototype.remove=function(e){if(!Dl.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};an.prototype.isReservedId=function(e){return g0.isReservedId(this.reserved,e)};an.prototype.isReservedName=function(e){return g0.isReservedName(this.reserved,e)}});var tf=y((pq,T0)=>{"use strict";T0.exports=c1;var l1=Vt(),af=Nr(),lf=Le();function v0(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function c1(n){for(var e=lf.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(lf.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof l1?"int32":s.type,l=af.basic[a];r="m"+lf.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|af.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&af.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?v0(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?v0(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var w0=y((mq,S0)=>{"use strict";var X=S0.exports=DS();X.build="light";function u1(n,e,t){return typeof e=="function"?(t=e,e=new X.Root):e||(e=new X.Root),e.load(n,t)}X.load=u1;function h1(n,e){return e||(e=new X.Root),e.loadSync(n)}X.loadSync=h1;X.encoder=tf();X.decoder=jd();X.verifier=Hd();X.converter=Yd();X.ReflectionObject=Or();X.Namespace=Di();X.Root=Il();X.Enum=Vt();X.Type=_l();X.Field=Zn();X.OneOf=Ii();X.MapField=yl();X.Service=Tl();X.Method=vl();X.Message=Sl();X.wrappers=Xd();X.types=Nr();X.util=Le();X.ReflectionObject._configure(X.Root);X.Namespace._configure(X.Type,X.Service,X.Enum);X.Root._configure(X.Type);X.Field._configure(X.Type)});var uf=y((gq,C0)=>{"use strict";C0.exports=_0;var cf=/[\s{}=;:[\],'"()<>]/g,d1=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f1=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,p1=/^ *[*/]+ */,m1=/^\s*\*?\/*/,g1=/\n/g,y1=/\s/,v1=/\\(.?)/g,T1={0:"\0",r:"\r",n:`
`,t:"	"};function E0(n){return n.replace(v1,function(e,t){switch(t){case"\\":case"":return t;default:return T1[t]||""}})}_0.unescape=E0;function _0(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(N){return Error("illegal "+N+" (line "+i+")")}function u(){var N=l==="'"?f1:d1;N.lastIndex=t-1;var V=N.exec(n);if(!V)throw c("string");return t=N.lastIndex,v(l),l=null,E0(V[1])}function d(N){return n.charAt(N)}function f(N,V,G){var Y={type:n.charAt(N++),lineEmpty:!1,leading:G},Ne;e?Ne=2:Ne=3;var je=N-Ne,ae;do if(--je<0||(ae=n.charAt(je))===`
`){Y.lineEmpty=!0;break}while(ae===" "||ae==="	");for(var T=n.substring(N,V).split(g1),ge=0;ge<T.length;++ge)T[ge]=T[ge].replace(e?m1:p1,"").trim();Y.text=T.join(`
`).trim(),o[i]=Y,s=i}function p(N){var V=m(N),G=n.substring(N,V),Y=/^\s*\/\//.test(G);return Y}function m(N){for(var V=N;V<r&&d(V)!==`
`;)V++;return V}function g(){if(a.length>0)return a.shift();if(l)return u();var N,V,G,Y,Ne,je=t===0;do{if(t===r)return null;for(N=!1;y1.test(G=d(t));)if(G===`
`&&(je=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(Y=t,Ne=!1,p(t-1)){Ne=!0;do if(t=m(t),t===r||(t++,!je))break;while(p(t))}else t=Math.min(r,m(t)+1);Ne&&(f(Y,t,je),je=!0),i++,N=!0}else{for(Ne=d(Y=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,Ne&&(f(Y,t-1,je),je=!0),++i,N=!0}else if((G=d(t))==="*"){Y=t+1,Ne=e||d(Y)==="*";do{if(G===`
`&&++i,++t===r)throw c("comment");V=G,G=d(t)}while(V!=="*"||G!=="/");++t,Ne&&(f(Y,t-2,je),je=!0),N=!0}else return"/"}}while(N);var ae=t;cf.lastIndex=0;var T=cf.test(d(ae++));if(!T)for(;ae<r&&!cf.test(d(ae));)++ae;var ge=n.substring(t,t=ae);return(ge==='"'||ge==="'")&&(l=ge),ge}function v(N){a.push(N)}function A(){if(!a.length){var N=g();if(N===null)return null;v(N)}return a[0]}function w(N,V){var G=A(),Y=G===N;if(Y)return g(),!0;if(!V)throw c("token '"+G+"', '"+N+"' expected");return!1}function k(N){var V=null,G;return N===void 0?(G=o[i-1],delete o[i-1],G&&(e||G.type==="*"||G.lineEmpty)&&(V=G.leading?G.text:null)):(s<N&&A(),G=o[N],delete o[N],G&&!G.lineEmpty&&(e||G.type==="/")&&(V=G.leading?null:G.text)),V}return Object.defineProperty({next:g,peek:A,push:v,skip:w,cmnt:k},"line",{get:function(){return i}})}});var N0=y((yq,D0)=>{"use strict";D0.exports=Nn;Nn.filename=null;Nn.defaults={keepCase:!1};var S1=uf(),b0=Il(),I0=_l(),A0=Zn(),w1=yl(),R0=Ii(),E1=Vt(),_1=Tl(),C1=vl(),hf=Nr(),df=Le(),b1=/^[1-9][0-9]*$/,I1=/^-?[1-9][0-9]*$/,A1=/^0[x][0-9a-fA-F]+$/,R1=/^-?0[x][0-9a-fA-F]+$/,D1=/^0[0-7]+$/,N1=/^-?0[0-7]+$/,O1=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ln=/^[a-zA-Z_][a-zA-Z_0-9]*$/,cn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,x1=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Nn(n,e,t){e instanceof b0||(t=e,e=new b0),t||(t=Nn.defaults);var r=t.preferTrailingComment||!1,i=S1(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,p,m,g=!1,v=e,A=t.keepCase?function(E){return E}:df.camelCase;function w(E,_,R){var F=Nn.filename;return R||(Nn.filename=null),Error("illegal "+(_||"token")+" '"+E+"' ("+(F?F+", ":"")+"line "+i.line+")")}function k(){var E=[],_;do{if((_=s())!=='"'&&_!=="'")throw w(_);E.push(s()),l(_),_=a()}while(_==='"'||_==="'");return E.join("")}function N(E){var _=s();switch(_){case"'":case'"':return o(_),k();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return G(_,!0)}catch{if(E&&cn.test(_))return _;throw w(_,"value")}}function V(E,_){var R,F;do _&&((R=a())==='"'||R==="'")?E.push(k()):E.push([F=Y(s()),l("to",!0)?Y(s()):F]);while(l(",",!0));l(";")}function G(E,_){var R=1;switch(E.charAt(0)==="-"&&(R=-1,E=E.substring(1)),E){case"inf":case"INF":case"Inf":return R*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(b1.test(E))return R*parseInt(E,10);if(A1.test(E))return R*parseInt(E,16);if(D1.test(E))return R*parseInt(E,8);if(O1.test(E))return R*parseFloat(E);throw w(E,"number",_)}function Y(E,_){switch(E){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!_&&E.charAt(0)==="-")throw w(E,"id");if(I1.test(E))return parseInt(E,10);if(R1.test(E))return parseInt(E,16);if(N1.test(E))return parseInt(E,8);throw w(E,"id")}function Ne(){if(d!==void 0)throw w("package");if(d=s(),!cn.test(d))throw w(d,"name");v=v.define(d),l(";")}function je(){var E=a(),_;switch(E){case"weak":_=p||(p=[]),s();break;case"public":s();default:_=f||(f=[]);break}E=k(),l(";"),_.push(E)}function ae(){if(l("="),m=k(),g=m==="proto3",!g&&m!=="proto2")throw w(m,"syntax");l(";")}function T(E,_){switch(_){case"option":return he(E,_),l(";"),!0;case"message":return S(E,_),!0;case"enum":return se(E,_),!0;case"service":return Ie(E,_),!0;case"extend":return Xr(E,_),!0}return!1}function ge(E,_,R){var F=i.line;if(E&&(typeof E.comment!="string"&&(E.comment=c()),E.filename=Nn.filename),l("{",!0)){for(var P;(P=s())!=="}";)_(P);l(";",!0)}else R&&R(),l(";"),E&&(typeof E.comment!="string"||r)&&(E.comment=c(F)||E.comment)}function S(E,_){if(!ln.test(_=s()))throw w(_,"type name");var R=new I0(_);ge(R,function(P){if(!T(R,P))switch(P){case"map":J(R,P);break;case"required":case"repeated":h(R,P);break;case"optional":g?h(R,"proto3_optional"):h(R,"optional");break;case"oneof":fe(R,P);break;case"extensions":V(R.extensions||(R.extensions=[]));break;case"reserved":V(R.reserved||(R.reserved=[]),!0);break;default:if(!g||!cn.test(P))throw w(P);o(P),h(R,"optional");break}}),E.add(R)}function h(E,_,R){var F=s();if(F==="group"){O(E,_);return}for(;F.endsWith(".")||a().startsWith(".");)F+=s();if(!cn.test(F))throw w(F,"type");var P=s();if(!ln.test(P))throw w(P,"name");P=A(P),l("=");var W=new A0(P,Y(s()),F,_,R);if(ge(W,function(ft){if(ft==="option")he(W,ft),l(";");else throw w(ft)},function(){$e(W)}),_==="proto3_optional"){var Ue=new R0("_"+P);W.setOption("proto3_optional",!0),Ue.add(W),E.add(Ue)}else E.add(W);!g&&W.repeated&&(hf.packed[F]!==void 0||hf.basic[F]===void 0)&&W.setOption("packed",!1,!0)}function O(E,_){var R=s();if(!ln.test(R))throw w(R,"name");var F=df.lcFirst(R);R===F&&(R=df.ucFirst(R)),l("=");var P=Y(s()),W=new I0(R);W.group=!0;var Ue=new A0(F,P,R,_);Ue.filename=Nn.filename,ge(W,function(ft){switch(ft){case"option":he(W,ft),l(";");break;case"required":case"repeated":h(W,ft);break;case"optional":g?h(W,"proto3_optional"):h(W,"optional");break;case"message":S(W,ft);break;case"enum":se(W,ft);break;default:throw w(ft)}}),E.add(W).add(Ue)}function J(E){l("<");var _=s();if(hf.mapKey[_]===void 0)throw w(_,"type");l(",");var R=s();if(!cn.test(R))throw w(R,"type");l(">");var F=s();if(!ln.test(F))throw w(F,"name");l("=");var P=new w1(A(F),Y(s()),_,R);ge(P,function(Ue){if(Ue==="option")he(P,Ue),l(";");else throw w(Ue)},function(){$e(P)}),E.add(P)}function fe(E,_){if(!ln.test(_=s()))throw w(_,"name");var R=new R0(A(_));ge(R,function(P){P==="option"?(he(R,P),l(";")):(o(P),h(R,"optional"))}),E.add(R)}function se(E,_){if(!ln.test(_=s()))throw w(_,"name");var R=new E1(_);ge(R,function(P){switch(P){case"option":he(R,P),l(";");break;case"reserved":V(R.reserved||(R.reserved=[]),!0);break;default:Ee(R,P)}}),E.add(R)}function Ee(E,_){if(!ln.test(_))throw w(_,"name");l("=");var R=Y(s(),!0),F={options:void 0};F.setOption=function(P,W){this.options===void 0&&(this.options={}),this.options[P]=W},ge(F,function(W){if(W==="option")he(F,W),l(";");else throw w(W)},function(){$e(F)}),E.add(_,R,F.comment,F.options)}function he(E,_){var R=l("(",!0);if(!cn.test(_=s()))throw w(_,"name");var F=_,P=F,W;R&&(l(")"),F="("+F+")",P=F,_=a(),x1.test(_)&&(W=_.slice(1),F+=_,s())),l("=");var Ue=tt(E,F);ye(E,P,Ue,W)}function tt(E,_){if(l("{",!0)){for(var R={};!l("}",!0);){if(!ln.test(Ke=s()))throw w(Ke,"name");if(Ke===null)throw w(Ke,"end of input");var F,P=Ke;if(l(":",!0),a()==="{")F=tt(E,_+"."+Ke);else if(a()==="["){F=[];var W;if(l("[",!0)){do W=N(!0),F.push(W);while(l(",",!0));l("]"),typeof W<"u"&&be(E,_+"."+Ke,W)}}else F=N(!0),be(E,_+"."+Ke,F);var Ue=R[P];Ue&&(F=[].concat(Ue).concat(F)),R[P]=F,l(",",!0),l(";",!0)}return R}var qn=N(!0);return be(E,_,qn),qn}function be(E,_,R){E.setOption&&E.setOption(_,R)}function ye(E,_,R,F){E.setParsedOption&&E.setParsedOption(_,R,F)}function $e(E){if(l("[",!0)){do he(E,"option");while(l(",",!0));l("]")}return E}function Ie(E,_){if(!ln.test(_=s()))throw w(_,"service name");var R=new _1(_);ge(R,function(P){if(!T(R,P))if(P==="rpc")nt(R,P);else throw w(P)}),E.add(R)}function nt(E,_){var R=c(),F=_;if(!ln.test(_=s()))throw w(_,"name");var P=_,W,Ue,qn,ft;if(l("("),l("stream",!0)&&(Ue=!0),!cn.test(_=s())||(W=_,l(")"),l("returns"),l("("),l("stream",!0)&&(ft=!0),!cn.test(_=s())))throw w(_);qn=_,l(")");var ra=new C1(P,F,W,qn,Ue,ft);ra.comment=R,ge(ra,function(Eu){if(Eu==="option")he(ra,Eu),l(";");else throw w(Eu)}),E.add(ra)}function Xr(E,_){if(!cn.test(_=s()))throw w(_,"reference");var R=_;ge(null,function(P){switch(P){case"required":case"repeated":h(E,P,R);break;case"optional":g?h(E,"proto3_optional",R):h(E,"optional",R);break;default:if(!g||!cn.test(P))throw w(P);o(P),h(E,"optional",R);break}})}for(var Ke;(Ke=s())!==null;)switch(Ke){case"package":if(!u)throw w(Ke);Ne();break;case"import":if(!u)throw w(Ke);je();break;case"syntax":if(!u)throw w(Ke);ae();break;case"option":he(v,Ke),l(";");break;default:if(T(v,Ke)){u=!1;continue}throw w(Ke)}return Nn.filename=null,{package:d,imports:f,weakImports:p,syntax:m,root:e}}});var k0=y((vq,x0)=>{"use strict";x0.exports=Gt;var k1=/\/|\./;function Gt(n,e){k1.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Gt[n]=e}Gt("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var O0;Gt("duration",{Duration:O0={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Gt("timestamp",{Timestamp:O0});Gt("empty",{Empty:{fields:{}}});Gt("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Gt("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Gt("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Gt.get=function(e){return Gt[e]||null}});var P0=y((Tq,M0)=>{"use strict";var nr=M0.exports=w0();nr.build="full";nr.tokenize=uf();nr.parse=N0();nr.common=k0();nr.Root._configure(nr.Type,nr.parse,nr.common)});var Nl=y((Sq,L0)=>{"use strict";L0.exports=P0()});var ff=y((wq,M1)=>{M1.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var V0=y((H,U0)=>{"use strict";var at=Nl();U0.exports=H=at.descriptor=at.Root.fromJSON(ff()).lookup(".google.protobuf");var F0=at.Namespace,po=at.Root,On=at.Enum,rr=at.Type,ir=at.Field,P1=at.MapField,Ol=at.OneOf,mo=at.Service,xl=at.Method;po.fromDescriptor=function(e){typeof e.length=="number"&&(e=H.FileDescriptorSet.decode(e));var t=new po;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(rr.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(On.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(ir.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(mo.fromDescriptor(r.service[o]));var a=Oi(r.options,H.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};po.prototype.toDescriptor=function(e){var t=H.FileDescriptorSet.create();return B0(this,t.file,e),t};function B0(n,e,t){var r=H.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof po||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof rr?r.messageType.push(s.toDescriptor(t)):s instanceof On?r.enumType.push(s.toDescriptor()):s instanceof ir?r.extension.push(s.toDescriptor(t)):s instanceof mo?r.service.push(s.toDescriptor()):s instanceof F0&&B0(s,e,t);r.options=xi(n.options,H.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var L1=0;rr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=H.DescriptorProto.decode(e));var r=new rr(e.name.length?e.name:"Type"+L1++,Oi(e.options,H.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Ol.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=ir.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(ir.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(rr.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(On.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};rr.prototype.toDescriptor=function(e){var t=H.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof P1){var s=pf(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=pf(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&q0(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(H.DescriptorProto.create({name:i.typeName,field:[H.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),H.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:H.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof ir?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof rr?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof On&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(H.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(H.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=xi(this.options,H.MessageOptions),t};var F1=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;ir.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=H.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=z1(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new ir(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=Oi(e.options,H.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=F1.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return G1(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};ir.prototype.toDescriptor=function(e){var t=H.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=at.util.ucFirst(this.name),t.label=3;else{switch(t.type=pf(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?q0(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=xi(this.options,H.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=H.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=H.FieldOptions.create())).packed=!0),t};var B1=0;On.fromDescriptor=function(e){typeof e.length=="number"&&(e=H.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new On(e.name&&e.name.length?e.name:"Enum"+B1++,t,Oi(e.options,H.EnumOptions))};On.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(H.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return H.EnumDescriptorProto.create({name:this.name,value:e,options:xi(this.options,H.EnumOptions)})};var q1=0;Ol.fromDescriptor=function(e){return typeof e.length=="number"&&(e=H.OneofDescriptorProto.decode(e)),new Ol(e.name&&e.name.length?e.name:"oneof"+q1++)};Ol.prototype.toDescriptor=function(){return H.OneofDescriptorProto.create({name:this.name})};var U1=0;mo.fromDescriptor=function(e){typeof e.length=="number"&&(e=H.ServiceDescriptorProto.decode(e));var t=new mo(e.name&&e.name.length?e.name:"Service"+U1++,Oi(e.options,H.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(xl.fromDescriptor(e.method[r]));return t};mo.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return H.ServiceDescriptorProto.create({name:this.name,method:e,options:xi(this.options,H.ServiceOptions)})};var V1=0;xl.fromDescriptor=function(e){return typeof e.length=="number"&&(e=H.MethodDescriptorProto.decode(e)),new xl(e.name&&e.name.length?e.name:"Method"+V1++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Oi(e.options,H.MethodOptions))};xl.prototype.toDescriptor=function(){return H.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:xi(this.options,H.MethodOptions)})};function z1(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function G1(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function pf(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof On)return 14;if(e instanceof rr)return e.group?10:11;throw Error("illegal type: "+n)}function Oi(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof On&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(j1(s),o));return t.length?at.util.toObject(t):void 0}}function xi(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=at.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(at.util.toObject(t)):void 0}}function q0(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof po)&&e instanceof F0)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function j1(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var z0=y((Eq,$1)=>{$1.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var G0=y((_q,K1)=>{K1.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var j0=y((Cq,H1)=>{H1.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var W0=y(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.addCommonProtos=sr.loadProtosWithOptionsSync=sr.loadProtosWithOptions=void 0;var $0=re("fs"),K0=re("path"),ki=Nl();function H0(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(K0.isAbsolute(i))return i;for(let s of e){let o=K0.join(s,i);try{return $0.accessSync(o,$0.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function W1(n,e){return C(this,null,function*(){let t=new ki.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));H0(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}sr.loadProtosWithOptions=W1;function Q1(n,e){let t=new ki.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");H0(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}sr.loadProtosWithOptionsSync=Q1;function Y1(){let n=z0(),e=ff(),t=G0(),r=j0();ki.common("api",n.nested.google.nested.protobuf.nested),ki.common("descriptor",e.nested.google.nested.protobuf.nested),ki.common("source_context",t.nested.google.nested.protobuf.nested),ki.common("type",r.nested.google.nested.protobuf.nested)}sr.addCommonProtos=Y1});var X0=y((Y0,mf)=>{"use strict";var Q0=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(S,h,O){this.low=S|0,this.high=h|0,this.unsigned=!!O}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(S){return(S&&S.__isLong__)===!0}function i(S){var h=Math.clz32(S&-S);return S?31-h:h}t.isLong=r;var s={},o={};function a(S,h){var O,J,fe;return h?(S>>>=0,(fe=0<=S&&S<256)&&(J=o[S],J)?J:(O=c(S,0,!0),fe&&(o[S]=O),O)):(S|=0,(fe=-128<=S&&S<128)&&(J=s[S],J)?J:(O=c(S,S<0?-1:0,!1),fe&&(s[S]=O),O))}t.fromInt=a;function l(S,h){if(isNaN(S))return h?N:k;if(h){if(S<0)return N;if(S>=v)return je}else{if(S<=-A)return ae;if(S+1>=A)return Ne}return S<0?l(-S,h).neg():c(S%g|0,S/g|0,h)}t.fromNumber=l;function c(S,h,O){return new t(S,h,O)}t.fromBits=c;var u=Math.pow;function d(S,h,O){if(S.length===0)throw Error("empty string");if(typeof h=="number"?(O=h,h=!1):h=!!h,S==="NaN"||S==="Infinity"||S==="+Infinity"||S==="-Infinity")return h?N:k;if(O=O||10,O<2||36<O)throw RangeError("radix");var J;if((J=S.indexOf("-"))>0)throw Error("interior hyphen");if(J===0)return d(S.substring(1),h,O).neg();for(var fe=l(u(O,8)),se=k,Ee=0;Ee<S.length;Ee+=8){var he=Math.min(8,S.length-Ee),tt=parseInt(S.substring(Ee,Ee+he),O);if(he<8){var be=l(u(O,he));se=se.mul(be).add(l(tt))}else se=se.mul(fe),se=se.add(l(tt))}return se.unsigned=h,se}t.fromString=d;function f(S,h){return typeof S=="number"?l(S,h):typeof S=="string"?d(S,h):c(S.low,S.high,typeof h=="boolean"?h:S.unsigned)}t.fromValue=f;var p=65536,m=1<<24,g=p*p,v=g*g,A=v/2,w=a(m),k=a(0);t.ZERO=k;var N=a(0,!0);t.UZERO=N;var V=a(1);t.ONE=V;var G=a(1,!0);t.UONE=G;var Y=a(-1);t.NEG_ONE=Y;var Ne=c(-1,2147483647,!1);t.MAX_VALUE=Ne;var je=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=je;var ae=c(0,-2147483648,!1);t.MIN_VALUE=ae;var T=t.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},T.toString=function(h){if(h=h||10,h<2||36<h)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ae)){var O=l(h),J=this.div(O),fe=J.mul(O).sub(this);return J.toString(h)+fe.toInt().toString(h)}else return"-"+this.neg().toString(h);for(var se=l(u(h,6),this.unsigned),Ee=this,he="";;){var tt=Ee.div(se),be=Ee.sub(tt.mul(se)).toInt()>>>0,ye=be.toString(h);if(Ee=tt,Ee.isZero())return ye+he;for(;ye.length<6;)ye="0"+ye;he=""+ye+he}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ae)?64:this.neg().getNumBitsAbs();for(var h=this.high!=0?this.high:this.low,O=31;O>0&&!(h&1<<O);O--);return this.high!=0?O+33:O+1},T.isZero=function(){return this.high===0&&this.low===0},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return(this.low&1)===1},T.isEven=function(){return(this.low&1)===0},T.equals=function(h){return r(h)||(h=f(h)),this.unsigned!==h.unsigned&&this.high>>>31===1&&h.high>>>31===1?!1:this.high===h.high&&this.low===h.low},T.eq=T.equals,T.notEquals=function(h){return!this.eq(h)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(h){return this.comp(h)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(h){return this.comp(h)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(h){return this.comp(h)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(h){return this.comp(h)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(h){if(r(h)||(h=f(h)),this.eq(h))return 0;var O=this.isNegative(),J=h.isNegative();return O&&!J?-1:!O&&J?1:this.unsigned?h.high>>>0>this.high>>>0||h.high===this.high&&h.low>>>0>this.low>>>0?-1:1:this.sub(h).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(ae)?ae:this.not().add(V)},T.neg=T.negate,T.add=function(h){r(h)||(h=f(h));var O=this.high>>>16,J=this.high&65535,fe=this.low>>>16,se=this.low&65535,Ee=h.high>>>16,he=h.high&65535,tt=h.low>>>16,be=h.low&65535,ye=0,$e=0,Ie=0,nt=0;return nt+=se+be,Ie+=nt>>>16,nt&=65535,Ie+=fe+tt,$e+=Ie>>>16,Ie&=65535,$e+=J+he,ye+=$e>>>16,$e&=65535,ye+=O+Ee,ye&=65535,c(Ie<<16|nt,ye<<16|$e,this.unsigned)},T.subtract=function(h){return r(h)||(h=f(h)),this.add(h.neg())},T.sub=T.subtract,T.multiply=function(h){if(this.isZero())return this;if(r(h)||(h=f(h)),e){var O=e.mul(this.low,this.high,h.low,h.high);return c(O,e.get_high(),this.unsigned)}if(h.isZero())return this.unsigned?N:k;if(this.eq(ae))return h.isOdd()?ae:k;if(h.eq(ae))return this.isOdd()?ae:k;if(this.isNegative())return h.isNegative()?this.neg().mul(h.neg()):this.neg().mul(h).neg();if(h.isNegative())return this.mul(h.neg()).neg();if(this.lt(w)&&h.lt(w))return l(this.toNumber()*h.toNumber(),this.unsigned);var J=this.high>>>16,fe=this.high&65535,se=this.low>>>16,Ee=this.low&65535,he=h.high>>>16,tt=h.high&65535,be=h.low>>>16,ye=h.low&65535,$e=0,Ie=0,nt=0,Xr=0;return Xr+=Ee*ye,nt+=Xr>>>16,Xr&=65535,nt+=se*ye,Ie+=nt>>>16,nt&=65535,nt+=Ee*be,Ie+=nt>>>16,nt&=65535,Ie+=fe*ye,$e+=Ie>>>16,Ie&=65535,Ie+=se*be,$e+=Ie>>>16,Ie&=65535,Ie+=Ee*tt,$e+=Ie>>>16,Ie&=65535,$e+=J*ye+fe*be+se*tt+Ee*he,$e&=65535,c(nt<<16|Xr,$e<<16|Ie,this.unsigned)},T.mul=T.multiply,T.divide=function(h){if(r(h)||(h=f(h)),h.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&h.low===-1&&h.high===-1)return this;var O=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,h.low,h.high);return c(O,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?N:k;var J,fe,se;if(this.unsigned){if(h.unsigned||(h=h.toUnsigned()),h.gt(this))return N;if(h.gt(this.shru(1)))return G;se=N}else{if(this.eq(ae)){if(h.eq(V)||h.eq(Y))return ae;if(h.eq(ae))return V;var Ee=this.shr(1);return J=Ee.div(h).shl(1),J.eq(k)?h.isNegative()?V:Y:(fe=this.sub(h.mul(J)),se=J.add(fe.div(h)),se)}else if(h.eq(ae))return this.unsigned?N:k;if(this.isNegative())return h.isNegative()?this.neg().div(h.neg()):this.neg().div(h).neg();if(h.isNegative())return this.div(h.neg()).neg();se=k}for(fe=this;fe.gte(h);){J=Math.max(1,Math.floor(fe.toNumber()/h.toNumber()));for(var he=Math.ceil(Math.log(J)/Math.LN2),tt=he<=48?1:u(2,he-48),be=l(J),ye=be.mul(h);ye.isNegative()||ye.gt(fe);)J-=tt,be=l(J,this.unsigned),ye=be.mul(h);be.isZero()&&(be=V),se=se.add(be),fe=fe.sub(ye)}return se},T.div=T.divide,T.modulo=function(h){if(r(h)||(h=f(h)),e){var O=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,h.low,h.high);return c(O,e.get_high(),this.unsigned)}return this.sub(this.div(h).mul(h))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return c(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(h){return r(h)||(h=f(h)),c(this.low&h.low,this.high&h.high,this.unsigned)},T.or=function(h){return r(h)||(h=f(h)),c(this.low|h.low,this.high|h.high,this.unsigned)},T.xor=function(h){return r(h)||(h=f(h)),c(this.low^h.low,this.high^h.high,this.unsigned)},T.shiftLeft=function(h){return r(h)&&(h=h.toInt()),(h&=63)===0?this:h<32?c(this.low<<h,this.high<<h|this.low>>>32-h,this.unsigned):c(0,this.low<<h-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(h){return r(h)&&(h=h.toInt()),(h&=63)===0?this:h<32?c(this.low>>>h|this.high<<32-h,this.high>>h,this.unsigned):c(this.high>>h-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(h){return r(h)&&(h=h.toInt()),(h&=63)===0?this:h<32?c(this.low>>>h|this.high<<32-h,this.high>>>h,this.unsigned):h===32?c(this.high,0,this.unsigned):c(this.high>>>h-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(h){var O;return r(h)&&(h=h.toInt()),(h&=63)===0?this:h===32?c(this.high,this.low,this.unsigned):h<32?(O=32-h,c(this.low<<h|this.high>>>O,this.high<<h|this.low>>>O,this.unsigned)):(h-=32,O=32-h,c(this.high<<h|this.low>>>O,this.low<<h|this.high>>>O,this.unsigned))},T.rotl=T.rotateLeft,T.rotateRight=function(h){var O;return r(h)&&(h=h.toInt()),(h&=63)===0?this:h===32?c(this.high,this.low,this.unsigned):h<32?(O=32-h,c(this.high<<O|this.low>>>h,this.low<<O|this.high>>>h,this.unsigned)):(h-=32,O=32-h,c(this.low<<O|this.high>>>h,this.high<<O|this.low>>>h,this.unsigned))},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},T.toBytes=function(h){return h?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var h=this.high,O=this.low;return[O&255,O>>>8&255,O>>>16&255,O>>>24,h&255,h>>>8&255,h>>>16&255,h>>>24]},T.toBytesBE=function(){var h=this.high,O=this.low;return[h>>>24,h>>>16&255,h>>>8&255,h&255,O>>>24,O>>>16&255,O>>>8&255,O&255]},t.fromBytes=function(h,O,J){return J?t.fromBytesLE(h,O):t.fromBytesBE(h,O)},t.fromBytesLE=function(h,O){return new t(h[0]|h[1]<<8|h[2]<<16|h[3]<<24,h[4]|h[5]<<8|h[6]<<16|h[7]<<24,O)},t.fromBytesBE=function(h,O){return new t(h[4]<<24|h[5]<<16|h[6]<<8|h[7],h[0]<<24|h[1]<<16|h[2]<<8|h[3],O)};var ge=t;return n.default=ge,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return Q0}):typeof mf=="object"&&typeof Y0=="object"&&(mf.exports=Q0)});var Tf=y(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.loadFileDescriptorSetFromObject=Xe.loadFileDescriptorSetFromBuffer=Xe.fromJSON=Xe.loadSync=Xe.load=Xe.isAnyExtension=Xe.Long=void 0;var X1=BT(),un=Nl(),yf=V0(),vf=W0(),J1=X0();Xe.Long=J1;function Z1(n){return"@type"in n&&typeof n["@type"]=="string"}Xe.isAnyExtension=Z1;var ew={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function eD(n,e){return n===""?e:n+"."+e}function tD(n){return n instanceof un.Service||n instanceof un.Type||n instanceof un.Enum}function nD(n){return n instanceof un.Namespace||n instanceof un.Root}function tw(n,e){let t=eD(e,n.name);return tD(n)?[[t,n]]:nD(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>tw(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function J0(n,e){return function(r){return n.toObject(n.decode(r),e)}}function Z0(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function rD(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:Z0(i),requestDeserialize:J0(i,t),responseSerialize:Z0(s),responseDeserialize:J0(s,t),originalName:X1(n.name),requestType:gf(i,r),responseType:gf(s,r)}}function iD(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=rD(s,e,t,r);return i}function gf(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,ew),fileDescriptorProtos:e}}function sD(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,ew),fileDescriptorProtos:e}}function oD(n,e,t,r){if(n instanceof un.Service)return iD(n,e,t,r);if(n instanceof un.Type)return gf(n,r);if(n instanceof un.Enum)return sD(n,r);throw new Error("Type mismatch in reflection object handling")}function kl(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(yf.FileDescriptorProto.encode(s).finish()));for(let[s,o]of tw(n,""))t[s]=oD(o,s,e,i);return t}function nw(n,e){e=e||{};let t=un.Root.fromDescriptor(n);return t.resolveAll(),kl(t,e)}function aD(n,e){return(0,vf.loadProtosWithOptions)(n,e).then(t=>kl(t,e))}Xe.load=aD;function lD(n,e){let t=(0,vf.loadProtosWithOptionsSync)(n,e);return kl(t,e)}Xe.loadSync=lD;function cD(n,e){e=e||{};let t=un.Root.fromJSON(n);return t.resolveAll(),kl(t,e)}Xe.fromJSON=cD;function uD(n,e){let t=yf.FileDescriptorSet.decode(n);return nw(t,e)}Xe.loadFileDescriptorSetFromBuffer=uD;function hD(n,e){let t=yf.FileDescriptorSet.fromObject(n);return nw(t,e)}Xe.loadFileDescriptorSetFromObject=hD;(0,vf.addCommonProtos)()});var kr=y(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.setup=pe.getChannelzServiceDefinition=pe.getChannelzHandlers=pe.unregisterChannelzRef=pe.registerChannelzSocket=pe.registerChannelzServer=pe.registerChannelzSubchannel=pe.registerChannelzChannel=pe.ChannelzCallTracker=pe.ChannelzChildrenTracker=pe.ChannelzTrace=void 0;var rw=re("net"),go=_t(),vo=ee(),dD=en(),fD=el(),pD=md();function Sf(n){return{channel_id:n.id,name:n.name}}function Cf(n){return{subchannel_id:n.id,name:n.name}}function mD(n){return{server_id:n.id}}function Pl(n){return{socket_id:n.id,name:n.name}}var iw=32,wf=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=iw*2&&(this.events=this.events.slice(iw)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:xn(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:xn(e.timestamp),channel_ref:e.childChannel?Sf(e.childChannel):null,subchannel_ref:e.childSubchannel?Cf(e.childSubchannel):null}))}}};pe.ChannelzTrace=wf;var Ef=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};pe.ChannelzChildrenTracker=Ef;var _f=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};pe.ChannelzCallTracker=_f;var gD=1;function Ll(){return gD++}var yo=[],bf=[],or=[],If=[];function yD(n,e,t){let r=Ll(),i={id:r,name:n,kind:"channel"};return t&&(yo[r]={ref:i,getInfo:e}),i}pe.registerChannelzChannel=yD;function vD(n,e,t){let r=Ll(),i={id:r,name:n,kind:"subchannel"};return t&&(bf[r]={ref:i,getInfo:e}),i}pe.registerChannelzSubchannel=vD;function TD(n,e){let t=Ll(),r={id:t,kind:"server"};return e&&(or[t]={ref:r,getInfo:n}),r}pe.registerChannelzServer=TD;function SD(n,e,t){let r=Ll(),i={id:r,name:n,kind:"socket"};return t&&(If[r]={ref:i,getInfo:e}),i}pe.registerChannelzSocket=SD;function wD(n){switch(n.kind){case"channel":delete yo[n.id];return;case"subchannel":delete bf[n.id];return;case"server":delete or[n.id];return;case"socket":delete If[n.id];return}}pe.unregisterChannelzRef=wD;function ED(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function sw(n){if(n==="")return[];let e=n.split(":").map(r=>ED(r));return[].concat(...e)}function _D(n){if((0,rw.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,rw.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(sw(e)),s=Buffer.from(sw(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function aw(n){switch(n){case go.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case go.ConnectivityState.IDLE:return{state:"IDLE"};case go.ConnectivityState.READY:return{state:"READY"};case go.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case go.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function xn(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function lw(n){let e=n.getInfo();return{ref:Sf(n.ref),data:{target:e.target,state:aw(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:xn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Sf(t)),subchannel_ref:e.children.subchannels.map(t=>Cf(t))}}function CD(n,e){let t=Number.parseInt(n.request.channel_id),r=yo[t];if(r===void 0){e({code:vo.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:lw(r)})}function bD(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<yo.length;i++){let s=yo[i];if(s!==void 0&&(r.push(lw(s)),r.length>=t))break}e(null,{channel:r,end:i>=or.length})}function cw(n){let e=n.getInfo();return{ref:mD(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:xn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Pl(t))}}function ID(n,e){let t=Number.parseInt(n.request.server_id),r=or[t];if(r===void 0){e({code:vo.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:cw(r)})}function AD(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<or.length;i++){let s=or[i];if(s!==void 0&&(r.push(cw(s)),r.length>=t))break}e(null,{server:r,end:i>=or.length})}function RD(n,e){let t=Number.parseInt(n.request.subchannel_id),r=bf[t];if(r===void 0){e({code:vo.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Cf(r.ref),data:{target:i.target,state:aw(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:xn(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Pl(o))};e(null,{subchannel:s})}function ow(n){var e;return(0,dD.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=_D(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function DD(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=If[a];if(l===void 0){e({code:vo.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Pl(l.ref),local:c.localAddress?ow(c.localAddress):null,remote:c.remoteAddress?ow(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:xn(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:xn(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:xn(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:xn(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function ND(n,e){let t=Number.parseInt(n.request.server_id),r=or[t];if(r===void 0){e({code:vo.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Pl(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function uw(){return{GetChannel:CD,GetTopChannels:bD,GetServer:ID,GetServers:AD,GetSubchannel:RD,GetSocket:DD,GetServerSockets:ND}}pe.getChannelzHandlers=uw;var Ml=null;function hw(){if(Ml)return Ml;let n=Tf().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Ml=(0,pD.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Ml}pe.getChannelzServiceDefinition=hw;function OD(){(0,fD.registerAdminService)(hw,uw)}pe.setup=OD});var dw=y(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});Bl.Subchannel=void 0;var ce=_t(),xD=Ys(),Af=Te(),Fl=ee(),kD=gt(),MD=en(),Mi=kr(),PD="subchannel",LD=~(1<<31),Rf=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=ce.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new Mi.ChannelzCallTracker,this.childrenTracker=new Mi.ChannelzChildrenTracker,this.streamTracker=new Mi.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new xD.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,MD.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Mi.ChannelzTrace,this.channelzRef=(0,Mi.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Af.trace(Fl.LogVerbosity.DEBUG,PD,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Af.trace(Fl.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([ce.ConnectivityState.TRANSIENT_FAILURE],ce.ConnectivityState.CONNECTING):this.transitionToState([ce.ConnectivityState.TRANSIENT_FAILURE],ce.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,LD);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([ce.ConnectivityState.CONNECTING],ce.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([ce.ConnectivityState.READY],ce.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Af.log(Fl.LogVerbosity.ERROR,`Connection to ${(0,kD.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([ce.ConnectivityState.CONNECTING],ce.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(ce.ConnectivityState[this.connectivityState]+" -> "+ce.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ce.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case ce.ConnectivityState.READY:this.stopBackoff();break;case ce.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case ce.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case ce.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,Mi.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([ce.ConnectivityState.CONNECTING,ce.ConnectivityState.READY],ce.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Fl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([ce.ConnectivityState.IDLE],ce.ConnectivityState.CONNECTING)||this.connectivityState===ce.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([ce.ConnectivityState.TRANSIENT_FAILURE],ce.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Bl.Subchannel=Rf});var xf=y(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.setup=cr.DEFAULT_PORT=void 0;var fw=Jt(),mw=re("dns"),gw=re("util"),FD=zh(),Df=ee(),Nf=ot(),BD=Te(),qD=ee(),ar=gt(),pw=re("net"),UD=Ys(),VD="dns_resolver";function lr(n){BD.trace(qD.LogVerbosity.DEBUG,VD,n)}cr.DEFAULT_PORT=443;var zD=3e4,GD=gw.promisify(mw.resolveTxt),jD=gw.promisify(mw.lookup);function $D(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Of=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,lr("Resolver constructed for target "+(0,ar.uriToString)(e));let a=(0,ar.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,pw.isIPv4)(a.host)||(0,pw.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:cr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:cr.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Df.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ar.uriToString)(this.target)}`,metadata:new Nf.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new UD.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:zD,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(lr("Returning IP address for target "+(0,ar.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)lr("Failed to parse DNS address "+(0,ar.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Df.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ar.uriToString)(this.target)}`,metadata:new Nf.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;lr("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=jD(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=$D(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(lr("Resolved addresses for target "+(0,ar.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(lr("Resolution error for target "+(0,ar.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=GD(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,FD.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Df.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Nf.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?lr('resolution update delayed by "min time between resolutions" rate limit'):lr("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function KD(){(0,fw.registerResolver)("dns",Of),(0,fw.registerDefaultScheme)("dns")}cr.setup=KD});var kf=y(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.getProxiedConnection=Fi.mapProxyName=void 0;var To=Te(),Pi=ee(),HD=Jt(),WD=re("http"),QD=re("tls"),YD=Te(),yw=en(),Li=gt(),XD=re("url"),JD=xf(),ZD="proxy";function ur(n){YD.trace(Pi.LogVerbosity.DEBUG,ZD,n)}function eN(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new XD.URL(n)}catch{return(0,To.log)(Pi.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,To.log)(Pi.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,To.log)(Pi.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),ur("Proxy server "+o.address+" set by environment variable "+e),o}function tN(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(ur("No proxy server list set by environment variable "+e),n.split(",")):[]}function nN(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=eN();if(!i.address)return r;let s=(0,Li.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of tN())if(l===o)return ur("Not using proxy for target in no_proxy list: "+(0,Li.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,Li.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Fi.mapProxyName=nN;function rN(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,Li.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,Li.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:JD.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,yw.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,yw.subchannelAddressToString)(n);return ur("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let p=WD.request(l);p.once("connect",(m,g,v)=>{var A;if(p.removeAllListeners(),g.removeAllListeners(),m.statusCode===200)if(ur("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let w=(0,HD.getDefaultAuthority)(s),k=(0,Li.splitHostPort)(w),N=(A=k?.host)!==null&&A!==void 0?A:w,V=QD.connect(Object.assign({host:N,servername:N,socket:g},t),()=>{ur("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:V,realTarget:s})});V.on("error",G=>{ur("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+G.message),f()})}else ur("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:g,realTarget:s});else(0,To.log)(Pi.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+m.statusCode),f()}),p.once("error",m=>{p.removeAllListeners(),(0,To.log)(Pi.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+m.message),f()}),p.end()})}Fi.getProxiedConnection=rN});var Pf=y(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.StreamDecoder=void 0;var kn=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(kn||{}),Mf=class{constructor(){this.readState=kn.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case kn.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=kn.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case kn.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=kn.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=kn.NO_DATA,i.push(s)}break;case kn.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=kn.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};ql.StreamDecoder=Mf});var vw=y(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});Ul.Http2SubchannelCall=void 0;var Mn=re("http2"),iN=re("os"),oe=ee(),hr=ot(),sN=Pf(),oN=Te(),aN=ee(),lN="subchannel_call";function cN(n){for(let[e,t]of Object.entries(iN.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Lf=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new sN.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=oe.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=oe.Status.INTERNAL;break;case 401:this.mappedStatusCode=oe.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=oe.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=oe.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=oe.Status.UNAVAILABLE;break;default:this.mappedStatusCode=oe.Status.UNKNOWN}if(a&Mn.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=hr.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:oe.Status.UNKNOWN,details:u.message,metadata:new hr.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===oe.Status.OK)return;let a,l="";switch(e.rstCode){case Mn.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=oe.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case Mn.constants.NGHTTP2_REFUSED_STREAM:a=oe.Status.UNAVAILABLE,l="Stream refused by server";break;case Mn.constants.NGHTTP2_CANCEL:a=oe.Status.CANCELLED,l="Call cancelled";break;case Mn.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=oe.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case Mn.constants.NGHTTP2_INADEQUATE_SECURITY:a=oe.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case Mn.constants.NGHTTP2_INTERNAL_ERROR:a=oe.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=oe.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=oe.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new hr.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+cN(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:oe.Status.UNAVAILABLE,details:"Connection dropped",metadata:new hr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){oN.trace(aN.LogVerbosity.DEBUG,lN,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===oe.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==oe.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=hr.Metadata.fromHttp2Headers(e)}catch{r=new hr.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===oe.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in oe.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===oe.Status.OK?t=Mn.constants.NGHTTP2_NO_ERROR:t=Mn.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new hr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==oe.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=oe.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=oe.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:oe.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new hr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Ul.Http2SubchannelCall=Lf});var Ff=y(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});Vl.getNextCallNumber=void 0;var uN=0;function hN(){return uN++}Vl.getNextCallNumber=hN});var ww=y(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});Gl.Http2SubchannelConnector=void 0;var zf=re("http2"),Tw=re("tls"),Bf=kr(),So=ee(),dN=kf(),qi=Te(),Sw=Jt(),zl=en(),Bi=gt(),fN=re("net"),pN=vw(),mN=Ff(),qf="transport",gN="transport_flowctrl",yN=Ch().version,{HTTP2_HEADER_AUTHORITY:vN,HTTP2_HEADER_CONTENT_TYPE:TN,HTTP2_HEADER_METHOD:SN,HTTP2_HEADER_PATH:wN,HTTP2_HEADER_TE:EN,HTTP2_HEADER_USER_AGENT:_N}=zf.constants,CN=2e4,bN=Buffer.from("too_many_pings","ascii"),Uf=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=CN,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Bf.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,zl.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Bf.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${yN}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===zf.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(bN)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),qi.isTracerEnabled(qf)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,zl.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,zl.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){qi.trace(So.LogVerbosity.DEBUG,qf,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){qi.trace(So.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){qi.trace(So.LogVerbosity.DEBUG,gN,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){qi.trace(So.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[vN]=t,o[_N]=this.userAgent,o[TN]="application/grpc",o[SN]="POST",o[wN]=r,o[EN]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new pN.Http2SubchannelCall(a,l,i,this,(0,mN.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,Bf.unregisterChannelzRef)(this.channelzRef)}},Vf=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){qi.trace(So.LogVerbosity.DEBUG,qf,(0,Bi.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Bi.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Bi.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,zl.subchannelAddressToString)(e)));let d=(0,Sw.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in f){if(p="https://",r["grpc.ssl_target_name_override"]){let v=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(A,w)=>(0,Tw.checkServerIdentity)(v,w),f.servername=v}else{let v=(c=(l=(0,Bi.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=v}i.socket&&(f.createConnection=(v,A)=>i.socket)}else f.createConnection=(v,A)=>i.socket?i.socket:fN.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let m=zf.connect(p+d,f);this.session=m;let g="Failed to connect";m.unref(),m.once("connect",()=>{m.removeAllListeners(),s(new Uf(m,e,r,u)),this.session=null}),m.once("close",()=>{this.session=null,setImmediate(()=>{o(`${g} (${new Date().toISOString()})`)})}),m.once("error",v=>{g=v.message,this.trace("connection failed with error "+g)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,Tw.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,Sw.getDefaultAuthority)((i=(0,Bi.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Bi.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,dN.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Gl.Http2SubchannelConnector=Vf});var Ew=y(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.getSubchannelPool=Ui.SubchannelPool=void 0;var IN=oT(),AN=dw(),RN=en(),DN=gt(),NN=ww(),ON=1e4,wo=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},ON),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,DN.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,RN.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,IN.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new AN.Subchannel(e,t,r,i,new NN.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Ui.SubchannelPool=wo;var xN=new wo;function kN(n){return n?xN:new wo}Ui.getSubchannelPool=kN});var jf=y(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.FilterStackFactory=Vi.FilterStack=void 0;var jl=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Vi.FilterStack=jl;var Gf=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new jl(this.factories.map(e=>e.createFilter()))}};Vi.FilterStackFactory=Gf});var $f=y($l=>{"use strict";Object.defineProperty($l,"__esModule",{value:!0});$l.CompressionAlgorithms=void 0;var _w=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(_w||($l.CompressionAlgorithms=_w={}))});var Hl=y(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});Kl.BaseFilter=void 0;var Kf=class{sendMetadata(e){return C(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return C(this,null,function*(){return e})}receiveMessage(e){return C(this,null,function*(){return e})}receiveTrailers(e){return e}};Kl.BaseFilter=Kf});var Iw=y(Gi=>{"use strict";Object.defineProperty(Gi,"__esModule",{value:!0});Gi.CompressionFilterFactory=Gi.CompressionFilter=void 0;var Wl=re("zlib"),bw=$f(),MN=ee(),PN=Hl(),LN=Te(),FN=n=>typeof n=="number"&&typeof bw.CompressionAlgorithms[n]=="string",zi=class{writeMessage(e,t){return C(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return C(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Mr=class extends zi{compressMessage(e){return C(this,null,function*(){return e})}writeMessage(e,t){return C(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Hf=class extends zi{compressMessage(e){return new Promise((t,r)=>{Wl.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Wl.inflate(e,(i,s)=>{i?r(i):t(s)})})}},Wf=class extends zi{compressMessage(e){return new Promise((t,r)=>{Wl.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Wl.unzip(e,(i,s)=>{i?r(i):t(s)})})}},Qf=class extends zi{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function Cw(n){switch(n){case"identity":return new Mr;case"deflate":return new Hf;case"gzip":return new Wf;default:return new Qf(n)}}var Ql=class extends PN.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new Mr,this.receiveCompression=new Mr,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(FN(i)){let s=bw.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=Cw(this.currentCompressionAlgorithm))}else LN.log(MN.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return C(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=Cw(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Mr,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return C(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Mr?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return C(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Gi.CompressionFilter=Ql;var Yf=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Ql(this.options,this.sharedFilterConfig)}};Gi.CompressionFilterFactory=Yf});var Rw=y(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.MaxMessageSizeFilterFactory=ji.MaxMessageSizeFilter=void 0;var BN=Hl(),Yl=ee(),Aw=ot(),Xl=class extends BN.BaseFilter{constructor(e){super(),this.maxSendMessageSize=Yl.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Yl.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return C(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:Yl.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new Aw.Metadata};return t}})}receiveMessage(e){return C(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:Yl.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new Aw.Metadata};return t}})}};ji.MaxMessageSizeFilter=Xl;var Xf=class{constructor(e){this.options=e}createFilter(){return new Xl(this.options)}};ji.MaxMessageSizeFilterFactory=Xf});var Jl=y(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.deadlineToString=hn.getRelativeTimeout=hn.getDeadlineTimeoutString=hn.minDeadline=void 0;function qN(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}hn.minDeadline=qN;var UN=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function VN(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of UN){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}hn.getDeadlineTimeoutString=VN;var zN=2147483647;function GN(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>zN?1/0:r}hn.getRelativeTimeout=GN;function jN(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}hn.deadlineToString=jN});var ec=y(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.restrictControlPlaneStatusCode=void 0;var dn=ee(),$N=[dn.Status.OK,dn.Status.INVALID_ARGUMENT,dn.Status.NOT_FOUND,dn.Status.ALREADY_EXISTS,dn.Status.FAILED_PRECONDITION,dn.Status.ABORTED,dn.Status.OUT_OF_RANGE,dn.Status.DATA_LOSS];function KN(n,e){return $N.includes(n)?{code:dn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${dn.Status[n]} ${e}`}:{code:n,details:e}}Zl.restrictControlPlaneStatusCode=KN});var Nw=y(rc=>{"use strict";Object.defineProperty(rc,"__esModule",{value:!0});rc.LoadBalancingCall=void 0;var Dw=_t(),tc=ee(),HN=Jl(),nc=ot(),Eo=Qn(),WN=gt(),QN=Te(),Jf=ec(),YN=re("http2"),XN="load_balancing_call",Zf=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,WN.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){QN.trace(tc.LogVerbosity.DEBUG,XN,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Eo.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Eo.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:tc.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new nc.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==Dw.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+Dw.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,HN.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===YN.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:tc.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new nc.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Jf.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:tc.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new nc.Metadata},"PROCESSED")});break;case Eo.PickResultType.DROP:let{code:s,details:o}=(0,Jf.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Eo.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Jf.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Eo.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new nc.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};rc.LoadBalancingCall=Zf});var xw=y(sc=>{"use strict";Object.defineProperty(sc,"__esModule",{value:!0});sc.ResolvingCall=void 0;var $i=ee(),ic=Jl(),Ow=ot(),JN=Te(),ZN=ec(),eO="resolving_call",ep=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&$i.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus($i.Status.CANCELLED,"Cancelled by parent call")}),r.flags&$i.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,ic.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){JN.trace($i.LogVerbosity.DEBUG,eO,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,ic.deadlineToString)(this.deadline));let e=(0,ic.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus($i.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==$i.Status.OK){let{code:r,details:i}=(0,ZN.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new Ow.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,ic.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Ow.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};sc.ResolvingCall=ep});var kw=y(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.RetryingCall=dr.MessageBufferTracker=dr.RetryThrottler=void 0;var oc=ee(),tO=ot(),nO=Te(),rO="retrying_call",np=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};dr.RetryThrottler=np;var rp=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};dr.MessageBufferTracker=rp;var tp="grpc-previous-rpc-attempts",ip=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){nO.trace(oc.LogVerbosity.DEBUG,rO,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new tO.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(oc.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===oc.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===oc.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(tp,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(tp,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(tp,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};dr.RetryingCall=ip});var lc=y(ac=>{"use strict";Object.defineProperty(ac,"__esModule",{value:!0});ac.BaseSubchannelWrapper=void 0;var sp=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};ac.BaseSubchannelWrapper=sp});var Lw=y(hc=>{"use strict";Object.defineProperty(hc,"__esModule",{value:!0});hc.InternalChannel=void 0;var iO=$a(),sO=sT(),oO=Ew(),Mw=Qn(),_o=ee(),aO=jf(),lO=Iw(),Pw=Jt(),op=Te(),cO=Rw(),uO=kf(),cc=gt(),fn=_t(),Co=kr(),hO=Nw(),dO=Jl(),fO=xw(),ap=Ff(),pO=ec(),lp=kw(),mO=lc(),gO=2147483647,yO=1e3,vO=30*60*1e3,uc=new Map,TO=1<<24,SO=1<<20,cp=class extends mO.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},up=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=fn.ConnectivityState.IDLE,this.currentPicker=new Mw.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Co.ChannelzCallTracker,this.childrenTracker=new Co.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof iO.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,cc.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,Pw.mapUriDefaultScheme)(f);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},gO),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Co.ChannelzTrace,this.channelzRef=(0,Co.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,Pw.getDefaultAuthority)(p);let m=(0,uO.mapProxyName)(p,r);this.target=m.target,this.options=Object.assign({},this.options,m.extraOptions),this.subchannelPool=(0,oO.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new lp.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:TO,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:SO),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:vO,yO);let g={createSubchannel:(A,w)=>{let k=this.subchannelPool.getOrCreateSubchannel(this.target,A,Object.assign({},this.options,w),this.credentials);k.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",k.getChannelzRef());let N=new cp(k,this);return this.wrappedSubchannels.add(N),N},updateState:(A,w)=>{this.currentPicker=w;let k=this.pickQueue.slice();this.pickQueue=[],k.length>0&&this.callRefTimerUnref();for(let N of k)N.doPick();this.updateState(A)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:A=>{this.channelzEnabled&&this.childrenTracker.refChild(A)},removeChannelzChild:A=>{this.channelzEnabled&&this.childrenTracker.unrefChild(A)}};this.resolvingLoadBalancer=new sO.ResolvingLoadBalancer(this.target,g,r,(A,w)=>{A.retryThrottling?uc.set(this.getTarget(),new lp.RetryThrottler(A.retryThrottling.maxTokens,A.retryThrottling.tokenRatio,uc.get(this.getTarget()))):uc.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=w,this.currentResolutionError=null,process.nextTick(()=>{let k=this.configSelectionQueue;this.configSelectionQueue=[],k.length>0&&this.callRefTimerUnref();for(let N of k)N.getConfig()})},A=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+A.code+' and details "'+A.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,pO.restrictControlPlaneStatusCode)(A.code,A.details)),{metadata:A.metadata}));let w=this.configSelectionQueue;this.configSelectionQueue=[],w.length>0&&this.callRefTimerUnref();for(let k of w)k.reportResolverError(A)}),this.filterStackFactory=new aO.FilterStackFactory([new cO.MaxMessageSizeFilterFactory(this.options),new lO.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let v=new Error;(0,op.trace)(_o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=v.stack)===null||d===void 0?void 0:d.substring(v.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,op.trace)(t??_o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,cc.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,op.trace)(_o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,cc.uriToString)(this.target)+" "+fn.ConnectivityState[this.connectivityState]+" -> "+fn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+fn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==fn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(fn.ConnectivityState.IDLE),this.currentPicker=new Mw.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==fn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===_o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,ap.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new hO.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,ap.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new lp.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,uc.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,ap.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,dO.deadlineToString)(t));let a={deadline:t,flags:s??_o.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new fO.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(fn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Co.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,cc.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===fn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===fn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};hc.InternalChannel=up});var fd=y(dc=>{"use strict";Object.defineProperty(dc,"__esModule",{value:!0});dc.ChannelImplementation=void 0;var wO=$a(),EO=Lw(),hp=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof wO.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new EO.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};dc.ChannelImplementation=hp});var Kw=y(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.Http2ServerCallStream=xt.ServerDuplexStreamImpl=xt.ServerWritableStreamImpl=xt.ServerReadableStreamImpl=xt.ServerUnaryCallImpl=void 0;var Vw=re("events"),Ki=re("http2"),pp=re("stream"),zw=re("zlib"),Gw=re("util"),me=ee(),mp=ot(),_O=Pf(),jw=Te(),Io=qa(),$w="server_call",CO=(0,Gw.promisify)(zw.unzip),bO=(0,Gw.promisify)(zw.inflate);function bo(n){jw.trace(me.LogVerbosity.DEBUG,$w,n)}var IO="grpc-accept-encoding",AO="grpc-encoding",Fw="grpc-message",Bw="grpc-status",qw="grpc-timeout",RO=/(\d{1,8})\s*([HMSmun])/,DO={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},NO={[IO]:"identity,deflate,gzip",[AO]:"identity"},Uw={[Ki.constants.HTTP2_HEADER_STATUS]:Ki.constants.HTTP_STATUS_OK,[Ki.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},OO={waitForTrailers:!0},dp=class extends Vw.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};xt.ServerUnaryCallImpl=dp;var fc=class extends pp.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};xt.ServerReadableStreamImpl=fc;var Ao=class extends pp.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new mp.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Io.getErrorMessage)(i),code:me.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:me.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};xt.ServerWritableStreamImpl=Ao;var Hi=class extends pp.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new mp.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};xt.ServerDuplexStreamImpl=Hi;Hi.prototype._read=fc.prototype._read;Hi.prototype._write=Ao.prototype._write;Hi.prototype._final=Ao.prototype._final;var fp=class extends Vw.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=me.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=me.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;bo("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:me.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?bO(e.subarray(5)):t==="gzip"?CO(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:me.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},Uw),NO),t);this.stream.respond(r,OO)}receiveMetadata(e){let t=mp.Metadata.fromHttp2Headers(e);jw.isTracerEnabled($w)&&bo("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(qw);if(r.length>0){let i=r[0].toString().match(RO);if(i===null){let a=new Error("Invalid deadline");return a.code=me.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*DO[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(xO,s,this),t.remove(qw)}return t.remove(Ki.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Ki.constants.HTTP2_HEADER_TE),t.remove(Ki.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:me.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:me.Status.INTERNAL,details:d.message});return}if(s===0){r({code:me.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),m=f.readUInt8(0)===1?e:"identity",g=o.getDecompressedMessage(f,m);if(Buffer.isBuffer(g)){t(o.deserializeMessageWithInternalError(g));return}g.then(v=>t(o.deserializeMessageWithInternalError(v)),v=>r(v.code?v:{code:me.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return C(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Io.getErrorMessage)(t),code:me.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return C(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:me.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Io.getErrorMessage)(s),code:me.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===me.Status.OK),!this.checkCancelled())if(bo("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+me.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[Bw]:e.code,[Fw]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[Bw]:e.code,[Fw]:encodeURI(e.details)},Uw),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:me.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:me.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new _O.StreamDecoder,i=!1,s=!1,o=!1,a=()=>C(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>C(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:me.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",p=yield this.getDecompressedMessage(u,f);if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>C(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return C(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return C(this,null,function*(){if(t===null){bo("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}bo("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Io.getErrorCode)(r);(i===null||i<me.Status.OK||i>me.Status.UNAUTHENTICATED)&&(i=me.Status.INTERNAL),e.emit("error",{details:(0,Io.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};xt.Http2ServerCallStream=fp;function xO(n){let e=new Error("Deadline exceeded");e.code=me.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var vp=y(pc=>{"use strict";Object.defineProperty(pc,"__esModule",{value:!0});pc.ServerCredentials=void 0;var Hw=Fh(),Ro=class{static createInsecure(){return new gp}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new yp({ca:e||(0,Hw.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:Hw.CIPHER_SUITES})}};pc.ServerCredentials=Ro;var gp=class extends Ro{_isSecure(){return!1}_getSettings(){return null}},yp=class extends Ro{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var Yw=y(yc=>{"use strict";Object.defineProperty(yc,"__esModule",{value:!0});yc.Server=void 0;var fr=re("http2"),Pn=ee(),Pr=Kw(),kO=vp(),Ww=Jt(),mc=Te(),jt=en(),MO=gt(),dt=kr(),gc=~(1<<31),PO=~(1<<31),LO=2e4,{HTTP2_HEADER_PATH:Qw}=fr.constants,FO="server";function BO(){}function Tp(n){return{code:Pn.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function qO(n,e){let t=Tp(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Sp=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new dt.ChannelzTrace,this.callTracker=new dt.ChannelzCallTracker,this.listenerChildrenTracker=new dt.ChannelzChildrenTracker,this.sessionChildrenTracker=new dt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,dt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:gc,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:gc,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:PO,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:LO,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,jt.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,jt.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,f=d.getCipher(),p=d.getCertificate(),m=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:m&&"raw"in m?m.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){mc.trace(Pn.LogVerbosity.DEBUG,FO,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=qO(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof kO.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,MO.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,Ww.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,m)=>{process.nextTick(()=>r(p,m))},l=()=>{let p;if(t._isSecure()){let m=Object.assign(o,t._getSettings());m.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=fr.createSecureServer(m),p.on("secureConnection",g=>{g.on("error",v=>{this.trace("An incoming TLS connection closed with error: "+v.message)})})}else p=fr.createServer(o);return p.setTimeout(0,BO),this._setupHandlers(p),p},c=(p,m,g)=>p.length===0?Promise.resolve({port:m,count:g}):Promise.all(p.map(v=>{this.trace("Attempting to bind "+(0,jt.subchannelAddressToString)(v));let A;(0,jt.isTcpSubchannelAddress)(v)?A={host:v.host,port:m}:A=v;let w=l();return new Promise((k,N)=>{let V=G=>{this.trace("Failed to bind "+(0,jt.subchannelAddressToString)(v)+" with error "+G.message),k(G)};w.once("error",V),w.listen(A,()=>{if(this.shutdown){w.close(),k(new Error("bindAsync failed because server is shutdown"));return}let G=w.address(),Y;typeof G=="string"?Y={path:G}:Y={host:G.address,port:G.port};let Ne=(0,dt.registerChannelzSocket)((0,jt.subchannelAddressToString)(Y),()=>({localAddress:Y,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(Ne),this.http2ServerList.push({server:w,channelzRef:Ne}),this.trace("Successfully bound "+(0,jt.subchannelAddressToString)(Y)),k("port"in Y?Y.port:m),w.removeListener("error",V)})})})).then(v=>{let A=0;for(let w of v)if(typeof w=="number"&&(A+=1,w!==m))throw new Error("Invalid state: multiple port numbers added from single address");return{port:m,count:A+g}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let m=p[0],g=l();return new Promise((v,A)=>{let w=k=>{this.trace("Failed to bind "+(0,jt.subchannelAddressToString)(m)+" with error "+k.message),v(u(p.slice(1)))};g.once("error",w),g.listen(m,()=>{if(this.shutdown){g.close(),v({port:0,count:0});return}let k=g.address(),N={host:k.address,port:k.port},V=(0,dt.registerChannelzSocket)((0,jt.subchannelAddressToString)(N),()=>({localAddress:N,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(V),this.http2ServerList.push({server:g,channelzRef:V}),this.trace("Successfully bound "+(0,jt.subchannelAddressToString)(N)),v(c(p.slice(1),k.port,1)),g.removeListener("error",w)})})},d={onSuccessfulResolution:(p,m,g)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let v;(0,jt.isTcpSubchannelAddress)(p[0])?p[0].port===0?v=u(p):v=c(p,p[0].port,0):v=c(p,1,0),v.then(A=>{if(A.count===0){let w=`No address added out of total ${p.length} resolved`;mc.log(Pn.LogVerbosity.ERROR,w),a(new Error(w),0)}else A.count<p.length&&mc.log(Pn.LogVerbosity.INFO,`WARNING Only ${A.count} addresses added out of total ${p.length} resolved`),a(null,A.port)},A=>{let w=`No address added out of total ${p.length} resolved`;mc.log(Pn.LogVerbosity.ERROR,w),a(new Error(w),0)})},onError:p=>{a(new Error(p.details),0)}};(0,Ww.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,dt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(fr.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,dt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,dt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,dt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[fr.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[fr.constants.HTTP2_HEADER_STATUS]:fr.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Pr.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Pn.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[Qw],s=this._retrieveHandler(i);if(!s){this._respondWithError(Tp(i),e,r);return}let o=new Pr.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Pn.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Pn.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[Qw],i=this._retrieveHandler(r);if(!i){this._respondWithError(Tp(r),e,null);return}let s=new Pr.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Pn.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")UO(e,t,s,o);else if(a==="clientStream")VO(e,t,s,o);else if(a==="serverStream")zO(e,t,s,o);else if(a==="bidi")GO(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,dt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new dt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(d));let m=null,g=null,v=!1;if(this.maxConnectionAgeMs!==gc){let w=this.maxConnectionAgeMs/10,k=Math.random()*w*2-w;m=(l=(a=setTimeout(()=>{var N,V;v=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(fr.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==gc&&(g=(V=(N=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||V===void 0?void 0:V.call(N))},this.maxConnectionAgeMs+k)).unref)===null||l===void 0?void 0:l.call(a)}let A=(u=(c=setInterval(()=>{var w,k;let N=(k=(w=setTimeout(()=>{v=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||k===void 0?void 0:k.call(w);try{s.ping((V,G,Y)=>{clearTimeout(N)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(v||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(d),(0,dt.unregisterChannelzRef)(d)),m&&clearTimeout(m),g&&clearTimeout(g),A&&clearTimeout(A),this.sessions.delete(s)})})}};yc.Server=Sp;function UO(n,e,t,r){return C(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Pr.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function VO(n,e,t,r){let i=new Pr.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function zO(n,e,t,r){return C(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Pr.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function GO(n,e,t,r){let i=new Pr.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var Xw=y(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});vc.StatusBuilder=void 0;var wp=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};vc.StatusBuilder=wp});var Ep=y(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.isDuration=pr.durationToMs=pr.msToDuration=void 0;function jO(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}pr.msToDuration=jO;function $O(n){return n.seconds*1e3+n.nanos/1e6|0}pr.durationToMs=$O;function KO(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}pr.isDuration=KO});var Np=y(mr=>{"use strict";var _p;Object.defineProperty(mr,"__esModule",{value:!0});mr.setup=mr.OutlierDetectionLoadBalancer=mr.OutlierDetectionLoadBalancingConfig=void 0;var Sc=_t(),Zw=ee(),Lr=Ep(),eE=Op(),tE=$n(),HO=Ja(),WO=Qn(),Jw=en(),QO=lc(),YO=Te(),XO="outlier_detection";function Fe(n){YO.trace(Zw.LogVerbosity.DEBUG,XO,n)}var Dp="outlier_detection",JO=((_p=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&_p!==void 0?_p:"true")==="true",ZO={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},ex={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Wi(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Cp(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Lr.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Tc(n,e,t){let r=t?`${t}.${e}`:e;if(Wi(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var Do=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},ZO),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},ex),o):null}getLoadBalancerName(){return Dp}toJsonObject(){return{interval:(0,Lr.msToDuration)(this.intervalMs),base_ejection_time:(0,Lr.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Lr.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Cp(e,"interval"),Cp(e,"base_ejection_time"),Cp(e,"max_ejection_time"),Tc(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Wi(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Tc(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Wi(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Wi(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Tc(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Tc(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Wi(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Wi(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Lr.durationToMs)(e.interval):null,e.base_ejection_time?(0,Lr.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Lr.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(tE.validateLoadBalancingConfig))}};mr.OutlierDetectionLoadBalancingConfig=Do;var Ip=class extends QO.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Sc.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Sc.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Sc.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function bp(){return{success:0,failure:0}}var Ap=class{constructor(){this.activeBucket=bp(),this.inactiveBucket=bp()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=bp()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Rp=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===WO.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===Zw.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},wc=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new HO.ChildLoadBalancerHandler((0,eE.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,Jw.subchannelAddressToString)(t)),o=new Ip(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Sc.ConnectivityState.READY?e.updateState(t,new Rp(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Fe("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let p=f.counter.getLastSuccesses(),m=f.counter.getLastFailures();Fe("Stats for "+d+": successes="+p+" failures="+m+" targetRequestVolume="+r),p+m>=r&&(i+=1,s.push(p/(p+m)))}if(Fe("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,f)=>d+f)/s.length,a=0;for(let d of s){let f=d-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);Fe("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=f.counter.getLastSuccesses(),m=f.counter.getLastFailures();if(p+m<r)continue;let g=p/(p+m);if(Fe("Checking candidate "+d+" successRate="+g),g<u){let v=Math.random()*100;Fe("Candidate "+d+" randomNumber="+v+" enforcement_percentage="+t.enforcement_percentage),v<t.enforcement_percentage&&(Fe("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Fe("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(Fe("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;Fe("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Fe("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Fe("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(Fe("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof Do))return;let i=new Set;for(let o of e)i.add((0,Jw.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(Fe("Adding map entry for "+o),this.addressMap.set(o,{counter:new Ap,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(Fe("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,tE.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Fe("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else Fe("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Fe("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Dp}};mr.OutlierDetectionLoadBalancer=wc;function tx(){JO&&(0,eE.registerLoadBalancerType)(Dp,wc,Do)}mr.setup=tx});var Op=y(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.OutlierDetectionLoadBalancingConfig=j.BaseSubchannelWrapper=j.registerAdminService=j.FilterStackFactory=j.BaseFilter=j.PickResultType=j.QueuePicker=j.UnavailablePicker=j.ChildLoadBalancerHandler=j.subchannelAddressToString=j.validateLoadBalancingConfig=j.getFirstUsableConfig=j.registerLoadBalancerType=j.createChildChannelControlHelper=j.BackoffTimeout=j.durationToMs=j.uriToString=j.createResolver=j.registerResolver=j.log=j.trace=void 0;var nE=Te();Object.defineProperty(j,"trace",{enumerable:!0,get:function(){return nE.trace}});Object.defineProperty(j,"log",{enumerable:!0,get:function(){return nE.log}});var rE=Jt();Object.defineProperty(j,"registerResolver",{enumerable:!0,get:function(){return rE.registerResolver}});Object.defineProperty(j,"createResolver",{enumerable:!0,get:function(){return rE.createResolver}});var nx=gt();Object.defineProperty(j,"uriToString",{enumerable:!0,get:function(){return nx.uriToString}});var rx=Ep();Object.defineProperty(j,"durationToMs",{enumerable:!0,get:function(){return rx.durationToMs}});var ix=Ys();Object.defineProperty(j,"BackoffTimeout",{enumerable:!0,get:function(){return ix.BackoffTimeout}});var Ec=$n();Object.defineProperty(j,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Ec.createChildChannelControlHelper}});Object.defineProperty(j,"registerLoadBalancerType",{enumerable:!0,get:function(){return Ec.registerLoadBalancerType}});Object.defineProperty(j,"getFirstUsableConfig",{enumerable:!0,get:function(){return Ec.getFirstUsableConfig}});Object.defineProperty(j,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Ec.validateLoadBalancingConfig}});var sx=en();Object.defineProperty(j,"subchannelAddressToString",{enumerable:!0,get:function(){return sx.subchannelAddressToString}});var ox=Ja();Object.defineProperty(j,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return ox.ChildLoadBalancerHandler}});var xp=Qn();Object.defineProperty(j,"UnavailablePicker",{enumerable:!0,get:function(){return xp.UnavailablePicker}});Object.defineProperty(j,"QueuePicker",{enumerable:!0,get:function(){return xp.QueuePicker}});Object.defineProperty(j,"PickResultType",{enumerable:!0,get:function(){return xp.PickResultType}});var ax=Hl();Object.defineProperty(j,"BaseFilter",{enumerable:!0,get:function(){return ax.BaseFilter}});var lx=jf();Object.defineProperty(j,"FilterStackFactory",{enumerable:!0,get:function(){return lx.FilterStackFactory}});var cx=el();Object.defineProperty(j,"registerAdminService",{enumerable:!0,get:function(){return cx.registerAdminService}});var ux=lc();Object.defineProperty(j,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return ux.BaseSubchannelWrapper}});var hx=Np();Object.defineProperty(j,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return hx.OutlierDetectionLoadBalancingConfig}})});var iE=y(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.setup=void 0;var dx=Jt(),kp=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function fx(){(0,dx.registerResolver)("unix",kp)}_c.setup=fx});var cE=y(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.setup=void 0;var sE=re("net"),Cc=ee(),Mp=ot(),oE=Jt(),aE=gt(),px=Te(),mx="ip_resolver";function lE(n){px.trace(Cc.LogVerbosity.DEBUG,mx,n)}var Pp="ipv4",Lp="ipv6",gx=443,bc=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,lE("Resolver constructed for target "+(0,aE.uriToString)(e));let s=[];if(!(e.scheme===Pp||e.scheme===Lp)){this.error={code:Cc.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Mp.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,aE.splitHostPort)(a);if(l===null){this.error={code:Cc.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Mp.Metadata};return}if(e.scheme===Pp&&!(0,sE.isIPv4)(l.host)||e.scheme===Lp&&!(0,sE.isIPv6)(l.host)){this.error={code:Cc.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Mp.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:gx})}this.addresses=s,lE("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function yx(){(0,oE.registerResolver)(Pp,bc),(0,oE.registerResolver)(Lp,bc)}Ic.setup=yx});var dE=y(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.setup=pn.PickFirstLoadBalancer=pn.shuffled=pn.PickFirstLoadBalancingConfig=void 0;var uE=$n(),Je=_t(),Ac=Qn(),vx=Te(),Tx=ee(),Sx="pick_first";function Fp(n){vx.trace(Tx.LogVerbosity.DEBUG,Sx,n)}var No="pick_first",wx=250,Oo=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return No}toJsonObject(){return{[No]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};pn.PickFirstLoadBalancingConfig=Oo;var Bp=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Ac.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function hE(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}pn.shuffled=hE;var Rc=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Je.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Je.ConnectivityState.READY,new Bp(this.currentPick)):this.children.length===0?this.updateState(Je.ConnectivityState.IDLE,new Ac.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Je.ConnectivityState.TRANSIENT_FAILURE,new Ac.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Je.ConnectivityState.CONNECTING,new Ac.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Je.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Je.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Je.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Je.ConnectivityState.IDLE||i===Je.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Je.ConnectivityState.IDLE&&(Fp("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},wx)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Fp("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Fp(Je.ConnectivityState[this.currentState]+" -> "+Je.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Je.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Je.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Oo&&(t.getShuffleAddressList()&&(e=hE(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Je.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return No}};pn.PickFirstLoadBalancer=Rc;function Ex(){(0,uE.registerLoadBalancerType)(No,Rc,Oo),(0,uE.registerDefaultLoadBalancerType)(No)}pn.setup=Ex});var pE=y(Qi=>{"use strict";Object.defineProperty(Qi,"__esModule",{value:!0});Qi.setup=Qi.RoundRobinLoadBalancer=void 0;var _x=$n(),Ze=_t(),Dc=Qn(),Cx=en(),bx=Te(),Ix=ee(),Ax="round_robin";function fE(n){bx.trace(Ix.LogVerbosity.DEBUG,Ax,n)}var Nc="round_robin",qp=class n{getLoadBalancerName(){return Nc}constructor(){}toJsonObject(){return{[Nc]:{}}}static createFromJson(e){return new n}},Up=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Dc.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Oc=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Ze.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===Ze.ConnectivityState.TRANSIENT_FAILURE||i===Ze.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Ze.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===Ze.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Ze.ConnectivityState.READY,new Up(e,t))}else this.countSubchannelsWithState(Ze.ConnectivityState.CONNECTING)>0?this.updateState(Ze.ConnectivityState.CONNECTING,new Dc.QueuePicker(this)):this.countSubchannelsWithState(Ze.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Ze.ConnectivityState.TRANSIENT_FAILURE,new Dc.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Ze.ConnectivityState.IDLE,new Dc.QueuePicker(this))}updateState(e,t){fE(Ze.ConnectivityState[this.currentState]+" -> "+Ze.ConnectivityState[e]),e===Ze.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),fE("Connect to address list "+e.map(r=>(0,Cx.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===Ze.ConnectivityState.IDLE||i===Ze.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Nc}};Qi.RoundRobinLoadBalancer=Oc;function Rx(){(0,_x.registerLoadBalancerType)(Nc,Oc,qp)}Qi.setup=Rx});var vE=y(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.experimental=x.addAdminServicesToServer=x.getChannelzHandlers=x.getChannelzServiceDefinition=x.InterceptorConfigurationError=x.InterceptingCall=x.RequesterBuilder=x.ListenerBuilder=x.StatusBuilder=x.getClientChannel=x.ServerCredentials=x.Server=x.setLogVerbosity=x.setLogger=x.load=x.loadObject=x.CallCredentials=x.ChannelCredentials=x.waitForClientReady=x.closeClient=x.Channel=x.makeGenericClientConstructor=x.makeClientConstructor=x.loadPackageDefinition=x.Client=x.compressionAlgorithms=x.propagate=x.connectivityState=x.status=x.logVerbosity=x.Metadata=x.credentials=void 0;var xc=Ph();Object.defineProperty(x,"CallCredentials",{enumerable:!0,get:function(){return xc.CallCredentials}});var Dx=fd();Object.defineProperty(x,"Channel",{enumerable:!0,get:function(){return Dx.ChannelImplementation}});var Nx=$f();Object.defineProperty(x,"compressionAlgorithms",{enumerable:!0,get:function(){return Nx.CompressionAlgorithms}});var Ox=_t();Object.defineProperty(x,"connectivityState",{enumerable:!0,get:function(){return Ox.ConnectivityState}});var kc=$a();Object.defineProperty(x,"ChannelCredentials",{enumerable:!0,get:function(){return kc.ChannelCredentials}});var mE=dd();Object.defineProperty(x,"Client",{enumerable:!0,get:function(){return mE.Client}});var Vp=ee();Object.defineProperty(x,"logVerbosity",{enumerable:!0,get:function(){return Vp.LogVerbosity}});Object.defineProperty(x,"status",{enumerable:!0,get:function(){return Vp.Status}});Object.defineProperty(x,"propagate",{enumerable:!0,get:function(){return Vp.Propagate}});var gE=Te(),zp=md();Object.defineProperty(x,"loadPackageDefinition",{enumerable:!0,get:function(){return zp.loadPackageDefinition}});Object.defineProperty(x,"makeClientConstructor",{enumerable:!0,get:function(){return zp.makeClientConstructor}});Object.defineProperty(x,"makeGenericClientConstructor",{enumerable:!0,get:function(){return zp.makeClientConstructor}});var xx=ot();Object.defineProperty(x,"Metadata",{enumerable:!0,get:function(){return xx.Metadata}});var kx=Yw();Object.defineProperty(x,"Server",{enumerable:!0,get:function(){return kx.Server}});var Mx=vp();Object.defineProperty(x,"ServerCredentials",{enumerable:!0,get:function(){return Mx.ServerCredentials}});var Px=Xw();Object.defineProperty(x,"StatusBuilder",{enumerable:!0,get:function(){return Px.StatusBuilder}});x.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:kc.ChannelCredentials.createInsecure,createSsl:kc.ChannelCredentials.createSsl,createFromSecureContext:kc.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:xc.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:xc.CallCredentials.createFromGoogleCredential,createEmpty:xc.CallCredentials.createEmpty};var Lx=n=>n.close();x.closeClient=Lx;var Fx=(n,e,t)=>n.waitForReady(e,t);x.waitForClientReady=Fx;var Bx=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};x.loadObject=Bx;var qx=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};x.load=qx;var Ux=n=>{gE.setLogger(n)};x.setLogger=Ux;var Vx=n=>{gE.setLoggerVerbosity(n)};x.setLogVerbosity=Vx;var zx=n=>mE.Client.prototype.getChannel.call(n);x.getClientChannel=zx;var Mc=cd();Object.defineProperty(x,"ListenerBuilder",{enumerable:!0,get:function(){return Mc.ListenerBuilder}});Object.defineProperty(x,"RequesterBuilder",{enumerable:!0,get:function(){return Mc.RequesterBuilder}});Object.defineProperty(x,"InterceptingCall",{enumerable:!0,get:function(){return Mc.InterceptingCall}});Object.defineProperty(x,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Mc.InterceptorConfigurationError}});var yE=kr();Object.defineProperty(x,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return yE.getChannelzServiceDefinition}});Object.defineProperty(x,"getChannelzHandlers",{enumerable:!0,get:function(){return yE.getChannelzHandlers}});var Gx=el();Object.defineProperty(x,"addAdminServicesToServer",{enumerable:!0,get:function(){return Gx.addAdminServicesToServer}});var jx=Op();x.experimental=jx;var $x=xf(),Kx=iE(),Hx=cE(),Wx=dE(),Qx=pE(),Yx=Np(),Xx=kr();$x.setup(),Kx.setup(),Hx.setup(),Wx.setup(),Qx.setup(),Yx.setup(),Xx.setup()});var VC=function(n){return n.USER="USER",n.ADMIN="ADMIN",n}(VC||{});import{inspect as Jx,TextEncoder as Zx,TextDecoder as wU}from"util";import{randomBytes as ek}from"crypto";var zC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Lt={},D,nh=nh||{},z=zC||self;function Ca(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Vs(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function GC(n){return Object.prototype.hasOwnProperty.call(n,Pu)&&n[Pu]||(n[Pu]=++jC)}var Pu="closure_uid_"+(1e9*Math.random()>>>0),jC=0;function $C(n,e,t){return n.call.apply(n.bind,arguments)}function KC(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function He(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?He=$C:He=KC,He.apply(null,arguments)}function ha(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Me(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Vn(){this.s=this.s,this.o=this.o}var HC=0;Vn.prototype.s=!1;Vn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),HC!=0)&&GC(this)};Vn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Vy=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function rh(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Dy(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Ca(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function We(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}We.prototype.h=function(){this.defaultPrevented=!0};var WC=function(){if(!z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};z.addEventListener("test",t,e),z.removeEventListener("test",t,e)}catch{}return n}();function ks(n){return/^[\s\xa0]*$/.test(n)}function ba(){var n=z.navigator;return n&&(n=n.userAgent)?n:""}function Qt(n){return ba().indexOf(n)!=-1}function ih(n){return ih[" "](n),n}ih[" "]=function(){};function QC(n,e){var t=Fb;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var YC=Qt("Opera"),oi=Qt("Trident")||Qt("MSIE"),zy=Qt("Edge"),Uu=zy||oi,Gy=Qt("Gecko")&&!(ba().toLowerCase().indexOf("webkit")!=-1&&!Qt("Edge"))&&!(Qt("Trident")||Qt("MSIE"))&&!Qt("Edge"),XC=ba().toLowerCase().indexOf("webkit")!=-1&&!Qt("Edge");function jy(){var n=z.document;return n?n.documentMode:void 0}var Vu;e:{if(da="",fa=function(){var n=ba();if(Gy)return/rv:([^\);]+)(\)|;)/.exec(n);if(zy)return/Edge\/([\d\.]+)/.exec(n);if(oi)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(XC)return/WebKit\/(\S+)/.exec(n);if(YC)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),fa&&(da=fa?fa[1]:""),oi&&(pa=jy(),pa!=null&&pa>parseFloat(da))){Vu=String(pa);break e}Vu=da}var da,fa,pa,zu;z.document&&oi?(Lu=jy(),zu=Lu||parseInt(Vu,10)||void 0):zu=void 0;var Lu,JC=zu;function Ms(n,e){if(We.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Gy){e:{try{ih(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:ZC[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Ms.$.h.call(this)}}Me(Ms,We);var ZC={2:"touch",3:"pen",4:"mouse"};Ms.prototype.h=function(){Ms.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var zs="closure_listenable_"+(1e6*Math.random()|0),eb=0;function tb(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++eb,this.fa=this.ia=!1}function Ia(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function sh(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function nb(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function $y(n){let e={};for(let t in n)e[t]=n[t];return e}var Ny="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ky(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<Ny.length;s++)t=Ny[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Aa(n){this.src=n,this.g={},this.h=0}Aa.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=ju(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new tb(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function Gu(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Vy(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Ia(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function ju(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var oh="closure_lm_"+(1e6*Math.random()|0),Fu={};function Hy(n,e,t,r,i){if(r&&r.once)return Qy(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Hy(n,e[s],t,r,i);return null}return t=ch(t),n&&n[zs]?n.O(e,t,Vs(r)?!!r.capture:!!r,i):Wy(n,e,t,!1,r,i)}function Wy(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Vs(i)?!!i.capture:!!i,a=lh(n);if(a||(n[oh]=a=new Aa(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=rb(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)WC||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Xy(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function rb(){function n(t){return e.call(n.src,n.listener,t)}let e=ib;return n}function Qy(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Qy(n,e[s],t,r,i);return null}return t=ch(t),n&&n[zs]?n.P(e,t,Vs(r)?!!r.capture:!!r,i):Wy(n,e,t,!0,r,i)}function Yy(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Yy(n,e[s],t,r,i);else r=Vs(r)?!!r.capture:!!r,t=ch(t),n&&n[zs]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=ju(s,t,r,i),-1<t&&(Ia(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=lh(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ju(e,t,r,i)),(t=-1<n?e[n]:null)&&ah(t))}function ah(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[zs])Gu(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Xy(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=lh(e))?(Gu(t,n),t.h==0&&(t.src=null,e[oh]=null)):Ia(n)}}}function Xy(n){return n in Fu?Fu[n]:Fu[n]="on"+n}function ib(n,e){if(n.fa)n=!0;else{e=new Ms(e,this);var t=n.listener,r=n.la||n.src;n.ia&&ah(n),n=t.call(r,e)}return n}function lh(n){return n=n[oh],n instanceof Aa?n:null}var Bu="__closure_events_fn_"+(1e9*Math.random()>>>0);function ch(n){return typeof n=="function"?n:(n[Bu]||(n[Bu]=function(e){return n.handleEvent(e)}),n[Bu])}function ke(){Vn.call(this),this.i=new Aa(this),this.S=this,this.J=null}Me(ke,Vn);ke.prototype[zs]=!0;ke.prototype.removeEventListener=function(n,e,t,r){Yy(this,n,e,t,r)};function ze(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new We(e,n);else if(e instanceof We)e.target=e.target||n;else{var i=e;e=new We(r,n),Ky(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=ma(o,r,!0,e)&&i}if(o=e.g=n,i=ma(o,r,!0,e)&&i,i=ma(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=ma(o,r,!1,e)&&i}ke.prototype.N=function(){if(ke.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ia(t[r]);delete n.g[e],n.h--}}this.J=null};ke.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};ke.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function ma(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&Gu(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var uh=z.JSON.stringify,$u=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function sb(){var n=hh;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Ku=class{constructor(){this.h=this.g=null}add(e,t){let r=Jy.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Jy=new $u(()=>new Hu,n=>n.reset()),Hu=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function ob(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ab(n){z.setTimeout(()=>{throw n},0)}var Ps,Ls=!1,hh=new Ku,Zy=()=>{let n=z.Promise.resolve(void 0);Ps=()=>{n.then(lb)}},lb=()=>{for(var n;n=sb();){try{n.h.call(n.g)}catch(t){ab(t)}var e=Jy;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ls=!1};function Ra(n,e){ke.call(this),this.h=n||1,this.g=e||z,this.j=He(this.qb,this),this.l=Date.now()}Me(Ra,ke);D=Ra.prototype;D.ga=!1;D.T=null;D.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ze(this,"tick"),this.ga&&(dh(this),this.start()))}};D.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function dh(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}D.N=function(){Ra.$.N.call(this),dh(this),delete this.g};function fh(n,e,t){if(typeof n=="function")t&&(n=He(n,t));else if(n&&typeof n.handleEvent=="function")n=He(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:z.setTimeout(n,e||0)}function ev(n){n.g=fh(()=>{n.g=null,n.i&&(n.i=!1,ev(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Wu=class extends Vn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:ev(this)}N(){super.N(),this.g&&(z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Fs(n){Vn.call(this),this.h=n,this.g={}}Me(Fs,Vn);var Oy=[];function tv(n,e,t,r){Array.isArray(t)||(t&&(Oy[0]=t.toString()),t=Oy);for(var i=0;i<t.length;i++){var s=Hy(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function nv(n){sh(n.g,function(e,t){this.g.hasOwnProperty(t)&&ah(e)},n),n.g={}}Fs.prototype.N=function(){Fs.$.N.call(this),nv(this)};Fs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Da(){this.g=!0}Da.prototype.Ea=function(){this.g=!1};function cb(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function ub(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function ii(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+db(n,t)+(r?" "+r:"")})}function hb(n,e){n.info(function(){return"TIMEOUT: "+e})}Da.prototype.info=function(){};function db(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return uh(t)}catch{return e}}var br={},xy=null;function Na(){return xy=xy||new ke}br.Ta="serverreachability";function rv(n){We.call(this,br.Ta,n)}Me(rv,We);function Bs(n){let e=Na();ze(e,new rv(e))}br.STAT_EVENT="statevent";function iv(n,e){We.call(this,br.STAT_EVENT,n),this.stat=e}Me(iv,We);function it(n){let e=Na();ze(e,new iv(e,n))}br.Ua="timingevent";function sv(n,e){We.call(this,br.Ua,n),this.size=e}Me(sv,We);function Gs(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return z.setTimeout(function(){n()},e)}var Oa={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ov={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ph(){}ph.prototype.h=null;function ky(n){return n.h||(n.h=n.i())}function av(){}var js={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function mh(){We.call(this,"d")}Me(mh,We);function gh(){We.call(this,"c")}Me(gh,We);var Qu;function xa(){}Me(xa,ph);xa.prototype.g=function(){return new XMLHttpRequest};xa.prototype.i=function(){return{}};Qu=new xa;function $s(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Fs(this),this.P=fb,n=Uu?125:void 0,this.V=new Ra(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new lv}function lv(){this.i=null,this.g="",this.h=!1}var fb=45e3,cv={},Yu={};D=$s.prototype;D.setTimeout=function(n){this.P=n};function Xu(n,e,t){n.L=1,n.A=Ma(In(e)),n.u=t,n.S=!0,uv(n,null)}function uv(n,e){n.G=Date.now(),Ks(n),n.B=In(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),vv(t.i,"t",r),n.o=0,t=n.l.J,n.h=new lv,n.g=qv(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Wu(He(n.Pa,n,n.g),n.O)),tv(n.U,n.g,"readystatechange",n.nb),e=n.I?$y(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Bs(),cb(n.j,n.v,n.B,n.m,n.W,n.u)}D.nb=function(n){n=n.target;let e=this.M;e&&Yt(n)==3?e.l():this.Pa(n)};D.Pa=function(n){try{if(n==this.g)e:{let u=Yt(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>u)&&(u!=3||Uu||this.g&&(this.h.h||this.g.ja()||Fy(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?Bs(3):Bs(2)),ka(this);var t=this.g.da();this.ca=t;t:if(hv(this)){var r=Fy(this.g);n="";var i=r.length,s=Yt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Er(this),xs(this);var o="";break t}this.h.i=new z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,ub(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ks(a)){var c=a;break t}}c=null}if(t=c)ii(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ju(this,t);else{this.i=!1,this.s=3,it(12),Er(this),xs(this);break e}}this.S?(dv(this,u,o),Uu&&this.i&&u==3&&(tv(this.U,this.V,"tick",this.mb),this.V.start())):(ii(this.j,this.m,o,null),Ju(this,o)),u==4&&Er(this),this.i&&!this.J&&(u==4?Pv(this.l,this):(this.i=!1,Ks(this)))}else Mb(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,it(12)):(this.s=0,it(13)),Er(this),xs(this)}}}catch{}finally{}};function hv(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function dv(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=pb(n,t),i==Yu){e==4&&(n.s=4,it(14),r=!1),ii(n.j,n.m,null,"[Incomplete Response]");break}else if(i==cv){n.s=4,it(15),ii(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else ii(n.j,n.m,i,null),Ju(n,i);hv(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,it(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Eh(e),e.M=!0,it(11))):(ii(n.j,n.m,t,"[Invalid Chunked Response]"),Er(n),xs(n))}D.mb=function(){if(this.g){var n=Yt(this.g),e=this.g.ja();this.o<e.length&&(ka(this),dv(this,n,e),this.i&&n!=4&&Ks(this))}};function pb(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Yu:(t=Number(e.substring(t,r)),isNaN(t)?cv:(r+=1,r+t>e.length?Yu:(e=e.slice(r,r+t),n.o=r+t,e)))}D.cancel=function(){this.J=!0,Er(this)};function Ks(n){n.Y=Date.now()+n.P,fv(n,n.P)}function fv(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Gs(He(n.lb,n),e)}function ka(n){n.C&&(z.clearTimeout(n.C),n.C=null)}D.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(hb(this.j,this.B),this.L!=2&&(Bs(),it(17)),Er(this),this.s=2,xs(this)):fv(this,this.Y-n)};function xs(n){n.l.H==0||n.J||Pv(n.l,n)}function Er(n){ka(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,dh(n.V),nv(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ju(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Zu(t.i,n))){if(!n.K&&Zu(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Sa(t),Fa(t);else break e;wh(t),it(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=Gs(He(t.ib,t),6e3));if(1>=wv(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else _r(t,11)}else if((n.K||t.g==n)&&Sa(t),!ks(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let d=c[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));let f=c[5];f!=null&&typeof f=="number"&&0<f&&(r=1.5*f,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let p=n.g;if(p){let m=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(m){var s=r.i;s.g||m.indexOf("spdy")==-1&&m.indexOf("quic")==-1&&m.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(yh(s,s.h),s.h=null))}if(r.F){let g=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;g&&(r.Da=g,de(r.I,r.F,g))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=Bv(r,r.J?r.pa:null,r.Y),o.K){Ev(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(ka(a),Ks(a)),r.g=o}else kv(r);0<t.j.length&&Ba(t)}else c[0]!="stop"&&c[0]!="close"||_r(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?_r(t,7):Sh(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Bs(4)}catch{}}function mb(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Ca(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function gb(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Ca(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function pv(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Ca(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=gb(n),r=mb(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var mv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yb(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Cr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Cr){this.h=n.h,va(this,n.j),this.s=n.s,this.g=n.g,Ta(this,n.m),this.l=n.l;var e=n.i,t=new qs;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),My(this,t),this.o=n.o}else n&&(e=String(n).match(mv))?(this.h=!1,va(this,e[1]||"",!0),this.s=Ns(e[2]||""),this.g=Ns(e[3]||"",!0),Ta(this,e[4]),this.l=Ns(e[5]||"",!0),My(this,e[6]||"",!0),this.o=Ns(e[7]||"")):(this.h=!1,this.i=new qs(null,this.h))}Cr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Os(e,Py,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Os(e,Py,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Os(t,t.charAt(0)=="/"?Sb:Tb,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Os(t,Eb)),n.join("")};function In(n){return new Cr(n)}function va(n,e,t){n.j=t?Ns(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ta(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function My(n,e,t){e instanceof qs?(n.i=e,_b(n.i,n.h)):(t||(e=Os(e,wb)),n.i=new qs(e,n.h))}function de(n,e,t){n.i.set(e,t)}function Ma(n){return de(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ns(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Os(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,vb),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function vb(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Py=/[#\/\?@]/g,Tb=/[#\?:]/g,Sb=/[#\?]/g,wb=/[#\?@]/g,Eb=/#/g;function qs(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function zn(n){n.g||(n.g=new Map,n.h=0,n.i&&yb(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}D=qs.prototype;D.add=function(n,e){zn(this),this.i=null,n=ai(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function gv(n,e){zn(n),e=ai(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function yv(n,e){return zn(n),e=ai(n,e),n.g.has(e)}D.forEach=function(n,e){zn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};D.ta=function(){zn(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};D.Z=function(n){zn(this);let e=[];if(typeof n=="string")yv(this,n)&&(e=e.concat(this.g.get(ai(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};D.set=function(n,e){return zn(this),this.i=null,n=ai(this,n),yv(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};D.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function vv(n,e,t){gv(n,e),0<t.length&&(n.i=null,n.g.set(ai(n,e),rh(t)),n.h+=t.length)}D.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function ai(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function _b(n,e){e&&!n.j&&(zn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(gv(this,r),vv(this,i,t))},n)),n.j=e}var Cb=class{constructor(n,e){this.g=n,this.map=e}};function Tv(n){this.l=n||bb,z.PerformanceNavigationTiming?(n=z.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(z.g&&z.g.Ka&&z.g.Ka()&&z.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var bb=10;function Sv(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function wv(n){return n.h?1:n.g?n.g.size:0}function Zu(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function yh(n,e){n.g?n.g.add(e):n.h=e}function Ev(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}Tv.prototype.cancel=function(){if(this.i=_v(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function _v(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return rh(n.i)}var Ib=class{stringify(n){return z.JSON.stringify(n,void 0)}parse(n){return z.JSON.parse(n,void 0)}};function Ab(){this.g=new Ib}function Rb(n,e,t){let r=t||"";try{pv(n,function(i,s){let o=i;Vs(i)&&(o=uh(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Db(n,e){let t=new Da;if(z.Image){let r=new Image;r.onload=ha(ga,t,r,"TestLoadImage: loaded",!0,e),r.onerror=ha(ga,t,r,"TestLoadImage: error",!1,e),r.onabort=ha(ga,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=ha(ga,t,r,"TestLoadImage: timeout",!1,e),z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function ga(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Hs(n){this.l=n.ec||null,this.j=n.ob||!1}Me(Hs,ph);Hs.prototype.g=function(){return new Pa(this.l,this.j)};Hs.prototype.i=function(n){return function(){return n}}({});function Pa(n,e){ke.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=vh,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Me(Pa,ke);var vh=0;D=Pa.prototype;D.open=function(n,e){if(this.readyState!=vh)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Us(this)};D.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||z).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};D.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ws(this)),this.readyState=vh};D.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Us(this)),this.g&&(this.readyState=3,Us(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof z.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Cv(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function Cv(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}D.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ws(this):Us(this),this.readyState==3&&Cv(this)}};D.Za=function(n){this.g&&(this.response=this.responseText=n,Ws(this))};D.Ya=function(n){this.g&&(this.response=n,Ws(this))};D.ka=function(){this.g&&Ws(this)};function Ws(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Us(n)}D.setRequestHeader=function(n,e){this.v.append(n,e)};D.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};D.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Us(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Pa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Nb=z.JSON.parse;function ve(n){ke.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=bv,this.L=this.M=!1}Me(ve,ke);var bv="",Ob=/^https?$/i,xb=["POST","PUT"];D=ve.prototype;D.Oa=function(n){this.M=n};D.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Qu.g(),this.C=this.u?ky(this.u):ky(Qu),this.g.onreadystatechange=He(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){Ly(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=z.FormData&&n instanceof z.FormData,!(0<=Vy(xb,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Rv(this),0<this.B&&((this.L=kb(this.g))?(this.g.timeout=this.B,this.g.ontimeout=He(this.ua,this)):this.A=fh(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Ly(this,s)}};function kb(n){return oi&&typeof n.timeout=="number"&&n.ontimeout!==void 0}D.ua=function(){typeof nh<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ze(this,"timeout"),this.abort(8))};function Ly(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Iv(n),La(n)}function Iv(n){n.F||(n.F=!0,ze(n,"complete"),ze(n,"error"))}D.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ze(this,"complete"),ze(this,"abort"),La(this))};D.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),La(this,!0)),ve.$.N.call(this)};D.La=function(){this.s||(this.G||this.v||this.l?Av(this):this.kb())};D.kb=function(){Av(this)};function Av(n){if(n.h&&typeof nh<"u"&&(!n.C[1]||Yt(n)!=4||n.da()!=2)){if(n.v&&Yt(n)==4)fh(n.La,0,n);else if(ze(n,"readystatechange"),Yt(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(mv)[1]||null;!i&&z.self&&z.self.location&&(i=z.self.location.protocol.slice(0,-1)),r=!Ob.test(i?i.toLowerCase():"")}t=r}if(t)ze(n,"complete"),ze(n,"success");else{n.m=6;try{var s=2<Yt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Iv(n)}}finally{La(n)}}}}function La(n,e){if(n.g){Rv(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ze(n,"ready");try{t.onreadystatechange=r}catch{}}}function Rv(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(z.clearTimeout(n.A),n.A=null)}D.isActive=function(){return!!this.g};function Yt(n){return n.g?n.g.readyState:0}D.da=function(){try{return 2<Yt(this)?this.g.status:-1}catch{return-1}};D.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};D.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),Nb(e)}};function Fy(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case bv:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Mb(n){let e={};n=(n.g&&2<=Yt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(ks(n[r]))continue;var t=ob(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}nb(e,function(r){return r.join(", ")})}D.Ia=function(){return this.m};D.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Dv(n){let e="";return sh(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Th(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Dv(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):de(n,e,t))}function Rs(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Nv(n){this.Ga=0,this.j=[],this.l=new Da,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Rs("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Rs("baseRetryDelayMs",5e3,n),this.hb=Rs("retryDelaySeedMs",1e4,n),this.eb=Rs("forwardChannelMaxRetries",2,n),this.xa=Rs("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Tv(n&&n.concurrentRequestLimit),this.Ja=new Ab,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}D=Nv.prototype;D.ra=8;D.H=1;function Sh(n){if(Ov(n),n.H==3){var e=n.W++,t=In(n.I);if(de(t,"SID",n.K),de(t,"RID",e),de(t,"TYPE","terminate"),Qs(n,t),e=new $s(n,n.l,e),e.L=2,e.A=Ma(In(t)),t=!1,z.navigator&&z.navigator.sendBeacon)try{t=z.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&z.Image&&(new Image().src=e.A,t=!0),t||(e.g=qv(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ks(e)}Fv(n)}function Fa(n){n.g&&(Eh(n),n.g.cancel(),n.g=null)}function Ov(n){Fa(n),n.u&&(z.clearTimeout(n.u),n.u=null),Sa(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&z.clearTimeout(n.m),n.m=null)}function Ba(n){if(!Sv(n.i)&&!n.m){n.m=!0;var e=n.Na;Ps||Zy(),Ls||(Ps(),Ls=!0),hh.add(e,n),n.C=0}}function Pb(n,e){return wv(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Gs(He(n.Na,n,e),Lv(n,n.C)),n.C++,!0)}D.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new $s(this,this.l,n),s=this.s;if(this.U&&(s?(s=$y(s),Ky(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=xv(this,i,e),t=In(this.I),de(t,"RID",n),de(t,"CVER",22),this.F&&de(t,"X-HTTP-Session-Id",this.F),Qs(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Dv(s)))+"&"+e:this.o&&Th(t,this.o,s)),yh(this.i,i),this.bb&&de(t,"TYPE","init"),this.P?(de(t,"$req",e),de(t,"SID","null"),i.aa=!0,Xu(i,t,null)):Xu(i,t,e),this.H=2}}else this.H==3&&(n?By(this,n):this.j.length==0||Sv(this.i)||By(this))};function By(n,e){var t;e?t=e.m:t=n.W++;let r=In(n.I);de(r,"SID",n.K),de(r,"RID",t),de(r,"AID",n.V),Qs(n,r),n.o&&n.s&&Th(r,n.o,n.s),t=new $s(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=xv(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),yh(n.i,t),Xu(t,r,e)}function Qs(n,e){n.na&&sh(n.na,function(t,r){de(e,r,t)}),n.h&&pv({},function(t,r){de(e,r,t)})}function xv(n,e,t){t=Math.min(n.j.length,t);var r=n.h?He(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{Rb(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function kv(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Ps||Zy(),Ls||(Ps(),Ls=!0),hh.add(e,n),n.A=0}}function wh(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Gs(He(n.Ma,n),Lv(n,n.A)),n.A++,!0)}D.Ma=function(){if(this.u=null,Mv(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Gs(He(this.jb,this),n)}};D.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,it(10),Fa(this),Mv(this))};function Eh(n){n.B!=null&&(z.clearTimeout(n.B),n.B=null)}function Mv(n){n.g=new $s(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=In(n.wa);de(e,"RID","rpc"),de(e,"SID",n.K),de(e,"AID",n.V),de(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&de(e,"TO",n.qa),de(e,"TYPE","xmlhttp"),Qs(n,e),n.o&&n.s&&Th(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Ma(In(e)),t.u=null,t.S=!0,uv(t,n)}D.ib=function(){this.v!=null&&(this.v=null,Fa(this),wh(this),it(19))};function Sa(n){n.v!=null&&(z.clearTimeout(n.v),n.v=null)}function Pv(n,e){var t=null;if(n.g==e){Sa(n),Eh(n),n.g=null;var r=2}else if(Zu(n.i,e))t=e.F,Ev(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Na(),ze(r,new sv(r,t)),Ba(n)}else kv(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&Pb(n,e)||r==2&&wh(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:_r(n,5);break;case 4:_r(n,10);break;case 3:_r(n,6);break;default:_r(n,2)}}}function Lv(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function _r(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=He(n.pb,n);t||(t=new Cr("//www.google.com/images/cleardot.gif"),z.location&&z.location.protocol=="http"||va(t,"https"),Ma(t)),Db(t.toString(),r)}else it(2);n.H=0,n.h&&n.h.za(e),Fv(n),Ov(n)}D.pb=function(n){n?(this.l.info("Successfully pinged google.com"),it(2)):(this.l.info("Failed to ping google.com"),it(1))};function Fv(n){if(n.H=0,n.ma=[],n.h){let e=_v(n.i);(e.length!=0||n.j.length!=0)&&(Dy(n.ma,e),Dy(n.ma,n.j),n.i.i.length=0,rh(n.j),n.j.length=0),n.h.ya()}}function Bv(n,e,t){var r=t instanceof Cr?In(t):new Cr(t);if(r.g!="")e&&(r.g=e+"."+r.g),Ta(r,r.m);else{var i=z.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Cr(null);r&&va(s,r),e&&(s.g=e),i&&Ta(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&de(r,t,e),de(r,"VER",n.ra),Qs(n,r),r}function qv(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new ve(new Hs({ob:t})):new ve(n.va),e.Oa(n.J),e}D.isActive=function(){return!!this.h&&this.h.isActive(this)};function Uv(){}D=Uv.prototype;D.Ba=function(){};D.Aa=function(){};D.za=function(){};D.ya=function(){};D.isActive=function(){return!0};D.Va=function(){};function wa(){if(oi&&!(10<=Number(JC)))throw Error("Environmental error: no available transport.")}wa.prototype.g=function(n,e){return new mt(n,e)};function mt(n,e){ke.call(this),this.g=new Nv(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!ks(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ks(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new li(this)}Me(mt,ke);mt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;it(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Bv(n,null,n.Y),Ba(n)};mt.prototype.close=function(){Sh(this.g)};mt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=uh(n),n=t);e.j.push(new Cb(e.fb++,n)),e.H==3&&Ba(e)};mt.prototype.N=function(){this.g.h=null,delete this.j,Sh(this.g),delete this.g,mt.$.N.call(this)};function Vv(n){mh.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Me(Vv,mh);function zv(){gh.call(this),this.status=1}Me(zv,gh);function li(n){this.g=n}Me(li,Uv);li.prototype.Ba=function(){ze(this.g,"a")};li.prototype.Aa=function(n){ze(this.g,new Vv(n))};li.prototype.za=function(n){ze(this.g,new zv)};li.prototype.ya=function(){ze(this.g,"b")};function Lb(){this.blockSize=-1}function Pt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Me(Pt,Lb);Pt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function qu(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Pt.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)qu(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){qu(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){qu(this,r),i=0;break}}this.h=i,this.i+=e};Pt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function ie(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var Fb={};function _h(n){return-128<=n&&128>n?QC(n,function(e){return new ie([e|0],0>e?-1:0)}):new ie([n|0],0>n?-1:0)}function Xt(n){if(isNaN(n)||!isFinite(n))return si;if(0>n)return Ve(Xt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=eh;return new ie(e,0)}function Gv(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Ve(Gv(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Xt(Math.pow(e,8)),r=si,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Xt(Math.pow(e,s)),r=r.R(s).add(Xt(o))):(r=r.R(t),r=r.add(Xt(o)))}return r}var eh=4294967296,si=_h(0),th=_h(1),qy=_h(16777216);D=ie.prototype;D.ea=function(){if(wt(this))return-Ve(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:eh+r)*e,e*=eh}return n};D.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(bn(this))return"0";if(wt(this))return"-"+Ve(this).toString(n);for(var e=Xt(Math.pow(n,6)),t=this,r="";;){var i=_a(t,e).g;t=Ea(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,bn(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};D.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function bn(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function wt(n){return n.h==-1}D.X=function(n){return n=Ea(this,n),wt(n)?-1:bn(n)?0:1};function Ve(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new ie(t,~n.h).add(th)}D.abs=function(){return wt(this)?Ve(this):this};D.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new ie(t,t[t.length-1]&-2147483648?-1:0)};function Ea(n,e){return n.add(Ve(e))}D.R=function(n){if(bn(this)||bn(n))return si;if(wt(this))return wt(n)?Ve(this).R(Ve(n)):Ve(Ve(this).R(n));if(wt(n))return Ve(this.R(Ve(n)));if(0>this.X(qy)&&0>n.X(qy))return Xt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,ya(t,2*r+2*i),t[2*r+2*i+1]+=s*l,ya(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,ya(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,ya(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new ie(t,0)};function ya(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ds(n,e){this.g=n,this.h=e}function _a(n,e){if(bn(e))throw Error("division by zero");if(bn(n))return new Ds(si,si);if(wt(n))return e=_a(Ve(n),e),new Ds(Ve(e.g),Ve(e.h));if(wt(e))return e=_a(n,Ve(e)),new Ds(Ve(e.g),e.h);if(30<n.g.length){if(wt(n)||wt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=th,r=e;0>=r.X(n);)t=Uy(t),r=Uy(r);var i=ri(t,1),s=ri(r,1);for(r=ri(r,2),t=ri(t,2);!bn(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=ri(r,1),t=ri(t,1)}return e=Ea(n,i.R(e)),new Ds(i,e)}for(i=si;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Xt(t),o=s.R(e);wt(o)||0<o.X(n);)t-=r,s=Xt(t),o=s.R(e);bn(s)&&(s=th),i=i.add(s),n=Ea(n,o)}return new Ds(i,n)}D.gb=function(n){return _a(this,n).h};D.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new ie(t,this.h&n.h)};D.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new ie(t,this.h|n.h)};D.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new ie(t,this.h^n.h)};function Uy(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new ie(t,n.h)}function ri(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new ie(i,n.h)}wa.prototype.createWebChannel=wa.prototype.g;mt.prototype.send=mt.prototype.u;mt.prototype.open=mt.prototype.m;mt.prototype.close=mt.prototype.close;Oa.NO_ERROR=0;Oa.TIMEOUT=8;Oa.HTTP_ERROR=6;ov.COMPLETE="complete";av.EventType=js;js.OPEN="a";js.CLOSE="b";js.ERROR="c";js.MESSAGE="d";ke.prototype.listen=ke.prototype.O;ve.prototype.listenOnce=ve.prototype.P;ve.prototype.getLastError=ve.prototype.Sa;ve.prototype.getLastErrorCode=ve.prototype.Ia;ve.prototype.getStatus=ve.prototype.da;ve.prototype.getResponseJson=ve.prototype.Wa;ve.prototype.getResponseText=ve.prototype.ja;ve.prototype.send=ve.prototype.ha;ve.prototype.setWithCredentials=ve.prototype.Oa;Pt.prototype.digest=Pt.prototype.l;Pt.prototype.reset=Pt.prototype.reset;Pt.prototype.update=Pt.prototype.j;ie.prototype.add=ie.prototype.add;ie.prototype.multiply=ie.prototype.R;ie.prototype.modulo=ie.prototype.gb;ie.prototype.compare=ie.prototype.X;ie.prototype.toNumber=ie.prototype.ea;ie.prototype.toString=ie.prototype.toString;ie.prototype.getBits=ie.prototype.D;ie.fromNumber=Xt;ie.fromString=Gv;var K2=Lt.createWebChannelTransport=function(){return new wa},H2=Lt.getStatEventTarget=function(){return Na()},W2=Lt.ErrorCode=Oa,Q2=Lt.EventType=ov,Y2=Lt.Event=br,X2=Lt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},J2=Lt.FetchXmlHttpFactory=Hs,Z2=Lt.WebChannel=av,eB=Lt.XhrIo=ve,jv=Lt.Md5=Pt,Ir=Lt.Integer=ie;var Ur=ty(vE(),1),ZE=ty(Tf(),1);var TE="@firebase/firestore",SE="4.6.1";var qe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};qe.UNAUTHENTICATED=new qe(null);qe.GOOGLE_CREDENTIALS=new qe("google-credentials-uid");qe.FIRST_PARTY=new qe("first-party-uid");qe.MOCK_USER=new qe("mock-user");var tk="10.11.1";var ms=tk;function nk(n){ms=n}function rk(n){return Jx(n,{depth:100})}var Vr=new gy("@firebase/firestore");function xo(){return Vr.logLevel}function L(n,...e){if(Vr.logLevel<=Cn.DEBUG){let t=e.map(Ag);Vr.debug(`Firestore (${ms}): ${n}`,...t)}}function Ht(n,...e){if(Vr.logLevel<=Cn.ERROR){let t=e.map(Ag);Vr.error(`Firestore (${ms}): ${n}`,...t)}}function es(n,...e){if(Vr.logLevel<=Cn.WARN){let t=e.map(Ag);Vr.warn(`Firestore (${ms}): ${n}`,...t)}}function Ag(n){if(typeof n=="string")return n;try{return rk(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${ms}) INTERNAL ASSERTION FAILED: `+n;throw Ht(e),new Error(e)}function ue(n,e){n||B()}function $(n,e){return n}var b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},q=class extends py{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var yn=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var qc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Qp=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(qe.UNAUTHENTICATED))}shutdown(){}},Yp=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Xp=class{constructor(e){this.authProvider=e,this.currentUser=qe.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new yn;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new yn,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>C(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yn)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ue(typeof r.accessToken=="string"),new qc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return ue(e===null||typeof e=="string"),new qe(e)}},Jp=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=qe.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Zp=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Jp(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(qe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},em=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},tm=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ue(typeof t.token=="string"),this.latestAppCheckToken=t.token,new em(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function ik(n){if(!n)return new Qp;switch(n.type){case"firstParty":return new Zp(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new q(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function sk(n){return ek(n)}var Uc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=sk(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ne(n,e){return n<e?-1:n>e?1:0}function zr(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}var wE=-62135596800,EE=1e6,Ge=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<wE)throw new q(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*EE);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/EE}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-wE,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var K=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ge(0,0))}static max(){return new n(new Ge(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var _E="__name__",Vc=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(),r===void 0?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},De=class n extends Vc{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new q(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},ok=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Tt=class n extends Vc{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return ok.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_E}static keyField(){return new n([_E])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new q(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new q(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new q(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new q(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(De.fromString(e))}static fromName(e){return new n(De.fromString(e).popFirst(5))}static empty(){return new n(De.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&De.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return De.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new De(e.slice()))}};var Fo=-1;function ak(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(r===1e9?new Ge(t+1,0):new Ge(t,r));return new Gr(i,U.empty(),e)}function lk(n){return new Gr(n.readTime,n.key,Fo)}var Gr=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(K.min(),U.empty(),Fo)}static max(){return new n(K.max(),U.empty(),Fo)}};function ck(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=U.comparator(n.documentKey,e.documentKey),t!==0)?t:ne(n.largestBatchId,e.largestBatchId)}var uk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nm=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Jo(n){return C(this,null,function*(){if(n.code===b.FAILED_PRECONDITION&&n.message===uk)L("LocalStore","Unexpectedly lost primary lease");else throw n})}var I=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function hk(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Zo(n){return n.name==="IndexedDbTransactionError"}var bU=15*1e3,IU=60*1e3;var e_=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})();var dk="remoteDocuments";var t_="owner";var n_="mutationQueues";var r_="mutations";var i_="documentMutations",fk="remoteDocumentsV14";var s_="remoteDocumentGlobal";var o_="targets";var a_="targetDocuments";var l_="targetGlobal",c_="collectionParents";var u_="clientMetadata";var h_="bundles";var d_="namedQueries";var pk="indexConfiguration";var mk="indexState";var gk="indexEntries";var f_="documentOverlays";var yk=[n_,r_,i_,dk,o_,t_,l_,a_],vk=yk,Tk=[...vk,u_],Sk=[...Tk,s_],wk=[...Sk,c_],Ek=[...wk,h_,d_],AU=[...Ek,f_],_k=[n_,r_,i_,fk,o_,t_,l_,a_,u_,s_,c_,h_,d_,f_],Ck=_k,RU=[...Ck,pk,mk,gk];function CE(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function gs(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function p_(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var we=class n{constructor(e,t){this.comparator=e,this.root=t||Mo.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Mo.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Mo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ji(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ji(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ji(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ji(this.root,e,this.comparator,!0)}},Ji=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Mo=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let t=this.left.check();if(t!==this.right.check())throw B();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),rm=class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Mo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Mo.EMPTY=new rm;var et=class n{constructor(e){this.comparator=e,this.data=new we(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zc(this.data.getIterator())}getIteratorFrom(e){return new zc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},zc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var mn=class n{constructor(e){this.fields=e,e.sort(Tt.comparator)}static empty(){return new n([])}unionWith(e){let t=new et(Tt.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function bk(n){return Buffer.from(n,"base64").toString("binary")}function Ik(n){return Buffer.from(n,"binary").toString("base64")}var ct=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=bk(e);return new n(t)}static fromUint8Array(e){let t=Ak(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return Ik(this.binaryString)}toUint8Array(){return Rk(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ct.EMPTY_BYTE_STRING=new ct("");function Ak(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function Rk(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var Dk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ln(n){if(ue(!!n),typeof n=="string"){let e=0,t=Dk.exec(n);if(ue(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Se(n.seconds),t=Se(n.nanos);return{seconds:e,nanos:t}}}function Se(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function gr(n){return typeof n=="string"?ct.fromBase64String(n):ct.fromUint8Array(n)}var m_="server_timestamp",g_="__type__",y_="__previous_value__",v_="__local_write_time__";function Rg(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[g_])===null||t===void 0?void 0:t.stringValue)===m_}function Nk(n,e){let t={fields:{[g_]:{stringValue:m_},[v_]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Rg(e)&&(e=Dg(e)),e&&(t.fields[y_]=e),{mapValue:t}}function Dg(n){let e=n.mapValue.fields[y_];return Rg(e)?Dg(e):e}function Bo(n){let e=Ln(n.mapValue.fields[v_].timestampValue);return new Ge(e.seconds,e.nanos)}var im=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},sm="(default)",Gc=class n{constructor(e,t){this.projectId=e,this.database=t||sm}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===sm}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function Ok(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new q(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gc(n.options.projectId,e)}var Ng=-1;function pu(n){return n==null}function qo(n){return n===0&&1/n===-1/0}function xk(n){return typeof n=="number"&&Number.isInteger(n)&&!qo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var T_="__max__",Pc={mapValue:{fields:{__type__:{stringValue:T_}}}};function jr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Rg(n)?4:S_(n)?9007199254740991:10:B()}function Kt(n,e){if(n===e)return!0;let t=jr(n),r=jr(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bo(n).isEqual(Bo(e));case 3:return kk(n,e);case 5:return n.stringValue===e.stringValue;case 6:return Pk(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return Mk(n,e);case 2:return Lk(n,e);case 9:return zr(n.arrayValue.values||[],e.arrayValue.values||[],Kt);case 10:return Fk(n,e);case 9007199254740991:return!0;default:return B()}}function kk(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Ln(n.timestampValue),r=Ln(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function Mk(n,e){return Se(n.geoPointValue.latitude)===Se(e.geoPointValue.latitude)&&Se(n.geoPointValue.longitude)===Se(e.geoPointValue.longitude)}function Pk(n,e){return gr(n.bytesValue).isEqual(gr(e.bytesValue))}function Lk(n,e){if("integerValue"in n&&"integerValue"in e)return Se(n.integerValue)===Se(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Se(n.doubleValue),r=Se(e.doubleValue);return t===r?qo(t)===qo(r):isNaN(t)&&isNaN(r)}return!1}function Fk(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(CE(t)!==CE(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Kt(t[i],r[i])))return!1;return!0}function Uo(n,e){return(n.values||[]).find(t=>Kt(t,e))!==void 0}function rs(n,e){if(n===e)return 0;let t=jr(n),r=jr(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return Bk(n,e);case 3:return bE(n.timestampValue,e.timestampValue);case 4:return bE(Bo(n),Bo(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return Vk(n.bytesValue,e.bytesValue);case 7:return qk(n.referenceValue,e.referenceValue);case 8:return Uk(n.geoPointValue,e.geoPointValue);case 9:return zk(n.arrayValue,e.arrayValue);case 10:return Gk(n.mapValue,e.mapValue);default:throw B()}}function Bk(n,e){let t=Se(n.integerValue||n.doubleValue),r=Se(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function bE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);let t=Ln(n),r=Ln(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function qk(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ne(t[i],r[i]);if(s!==0)return s}return ne(t.length,r.length)}function Uk(n,e){let t=ne(Se(n.latitude),Se(e.latitude));return t!==0?t:ne(Se(n.longitude),Se(e.longitude))}function Vk(n,e){let t=gr(n),r=gr(e);return t.compareTo(r)}function zk(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=rs(t[i],r[i]);if(s)return s}return ne(t.length,r.length)}function Gk(n,e){if(n===Pc.mapValue&&e===Pc.mapValue)return 0;if(n===Pc.mapValue)return 1;if(e===Pc.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ne(r[o],s[o]);if(a!==0)return a;let l=rs(t[r[o]],i[s[o]]);if(l!==0)return l}return ne(r.length,s.length)}function is(n){return Og(n)}function Og(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?$k(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?jk(n.bytesValue):"referenceValue"in n?Hk(n.referenceValue):"geoPointValue"in n?Kk(n.geoPointValue):"arrayValue"in n?Qk(n.arrayValue):"mapValue"in n?Wk(n.mapValue):B()}function jk(n){return gr(n).toBase64()}function $k(n){let e=Ln(n);return`time(${e.seconds},${e.nanos})`}function Kk(n){return`geo(${n.latitude},${n.longitude})`}function Hk(n){return U.fromName(n).toString()}function Wk(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Og(n.fields[i])}`;return t+"}"}function Qk(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Og(r);return e+"]"}function om(n){return!!n&&"integerValue"in n}function Yk(n){return!!n&&"doubleValue"in n}function Xk(n){return om(n)||Yk(n)}function xg(n){return!!n&&"arrayValue"in n}function IE(n){return!!n&&"nullValue"in n}function AE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Fc(n){return!!n&&"mapValue"in n}function Po(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return gs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Po(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Po(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function S_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===T_}var $t=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Fc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Po(t)}setAll(e){let t=Tt.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Po(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Fc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Fc(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){gs(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Po(this.value))}};function w_(n){let e=[];return gs(n.fields,(t,r)=>{let i=new Tt([t]);if(Fc(r)){let o=w_(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new mn(e)}var Wt=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,K.min(),K.min(),K.min(),$t.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,K.min(),K.min(),$t.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,K.min(),K.min(),$t.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(K.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function Jk(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?rs(r,i):B()}var ss=class{constructor(e,t){this.position=e,this.inclusive=t}};function E_(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=U.comparator(U.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=rs(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function Zk(n,e,t){let r=E_(n,e,t);return n.inclusive?r>=0:r>0}function eM(n,e,t){let r=E_(n,e,t);return n.inclusive?r<=0:r<0}function RE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Kt(r,i))return!1}return!0}var os=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function tM(n){return n.field.canonicalString()+n.dir}function nM(n){return`${n.field.canonicalString()} (${n.dir})`}function rM(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var jc=class{},xe=class n extends jc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new lm(e,t,r):t==="array-contains"?new hm(e,r):t==="in"?new dm(e,r):t==="not-in"?new fm(e,r):t==="array-contains-any"?new pm(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new cm(e,r):new um(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(rs(t,this.value)):t!==null&&jr(this.value)===jr(t)&&this.matchesComparison(rs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Sn=class n extends jc{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return __(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function __(n){return n.op==="and"}function C_(n){return iM(n)&&__(n)}function iM(n){for(let e of n.filters)if(e instanceof Sn)return!1;return!0}function am(n){if(n instanceof xe)return n.field.canonicalString()+n.op.toString()+is(n.value);if(C_(n))return n.filters.map(e=>am(e)).join(",");{let e=n.filters.map(t=>am(t)).join(",");return`${n.op}(${e})`}}function b_(n,e){if(n instanceof xe)return sM(n,e);if(n instanceof Sn)return oM(n,e);B()}function sM(n,e){return e instanceof xe&&n.op===e.op&&n.field.isEqual(e.field)&&Kt(n.value,e.value)}function oM(n,e){return e instanceof Sn&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&b_(i,e.filters[s]),!0):!1}function I_(n){return n instanceof xe?lM(n):n instanceof Sn?aM(n):"Filter"}function aM(n){return n.op.toString()+" {"+n.getFilters().map(I_).join(" ,")+"}"}function lM(n){return`${n.field.canonicalString()} ${n.op} ${is(n.value)}`}var lm=class extends xe{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},cm=class extends xe{constructor(e,t){super(e,"in",t),this.keys=A_("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},um=class extends xe{constructor(e,t){super(e,"not-in",t),this.keys=A_("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function A_(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var hm=class extends xe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return xg(t)&&Uo(t.arrayValue,this.value)}},dm=class extends xe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Uo(this.value.arrayValue,t)}},fm=class extends xe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Uo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Uo(this.value.arrayValue,t)}},pm=class extends xe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!xg(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Uo(this.value.arrayValue,r))}};var mm=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function DE(n,e=null,t=[],r=[],i=null,s=null,o=null){return new mm(n,e,t,r,i,s,o)}function kg(n){let e=$(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>am(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>tM(r)).join(","),pu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>is(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>is(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function cM(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>I_(t)).join(", ")}]`),pu(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>nM(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>is(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>is(t)).join(",")),`Target(${e})`}function Mg(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!rM(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!b_(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!RE(n.startAt,e.startAt)?!1:RE(n.endAt,e.endAt)}function gm(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var as=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function uM(n,e,t,r,i,s,o,a){return new as(n,e,t,r,i,s,o,a)}function Pg(n){return new as(n)}function hM(n,e){return new as(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function NE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function dM(n){let e=new et(Tt.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function fM(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function pM(n){return n.collectionGroup!==null}function Vo(n){let e=$(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";dM(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new os(s,r))}),t.has(Tt.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new os(Tt.keyField(),r))}return e.memoizedNormalizedOrderBy}function vn(n){let e=$(n);return e.memoizedTarget||(e.memoizedTarget=mM(e,Vo(n))),e.memoizedTarget}function mM(n,e){if(n.limitType==="F")return DE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new os(i.field,s)});let t=n.endAt?new ss(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ss(n.startAt.position,n.startAt.inclusive):null;return DE(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ym(n,e,t){return new as(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function mu(n,e){return Mg(vn(n),vn(e))&&n.limitType===e.limitType}function R_(n){return`${kg(vn(n))}|lt:${n.limitType}`}function Yi(n){return`Query(target=${cM(vn(n))}; limitType=${n.limitType})`}function gu(n,e){return e.isFoundDocument()&&gM(n,e)&&yM(n,e)&&vM(n,e)&&TM(n,e)}function gM(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):U.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function yM(n,e){for(let t of Vo(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function vM(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function TM(n,e){return!(n.startAt&&!eM(n.startAt,Vo(n),e)||n.endAt&&!Zk(n.endAt,Vo(n),e))}function SM(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function D_(n){return(e,t)=>{let r=!1;for(let i of Vo(n)){let s=wM(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function wM(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):Jk(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}var yr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){gs(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return p_(this.inner)}size(){return this.innerSize}};var EM=new we(U.comparator);function Fn(){return EM}var N_=new we(U.comparator);function ko(...n){let e=N_;for(let t of n)e=e.insert(t.key,t);return e}function _M(){return zo()}function O_(n){let e=N_;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Fr(){return zo()}function x_(){return zo()}function zo(){return new yr(n=>n.toString(),(n,e)=>n.isEqual(e))}var CM=new we(U.comparator);function bM(){return CM}var IM=new et(U.comparator);function Q(...n){let e=IM;for(let t of n)e=e.add(t);return e}var AM=new et(ne);function RM(){return AM}function k_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qo(e)?"-0":e}}function M_(n){return{integerValue:""+n}}function DM(n,e){return xk(e)?M_(e):k_(n,e)}var ls=class{constructor(){this._=void 0}};function NM(n,e,t){return n instanceof cs?Nk(t,e):n instanceof $r?L_(n,e):n instanceof Kr?F_(n,e):kM(n,e)}function OM(n,e,t){return n instanceof $r?L_(n,e):n instanceof Kr?F_(n,e):t}function P_(n,e){return n instanceof us?Xk(e)?e:{integerValue:0}:null}function xM(n,e){return n instanceof $r&&e instanceof $r||n instanceof Kr&&e instanceof Kr?zr(n.elements,e.elements,Kt):n instanceof us&&e instanceof us?Kt(n.operand,e.operand):n instanceof cs&&e instanceof cs}var cs=class extends ls{},$r=class extends ls{constructor(e){super(),this.elements=e}};function L_(n,e){let t=B_(e);for(let r of n.elements)t.some(i=>Kt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Kr=class extends ls{constructor(e){super(),this.elements=e}};function F_(n,e){let t=B_(e);for(let r of n.elements)t=t.filter(i=>!Kt(i,r));return{arrayValue:{values:t}}}var us=class extends ls{constructor(e,t){super(),this.serializer=e,this.operand=t}};function kM(n,e){let t=P_(n,e),r=OE(t)+OE(n.operand);return om(t)&&om(n.operand)?M_(r):k_(n.serializer,r)}function OE(n){return Se(n.integerValue||n.doubleValue)}function B_(n){return xg(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function MM(n,e){return n.field.isEqual(e.field)&&xM(n.transform,e.transform)}function PM(n,e){return n===void 0&&e===void 0?!0:n&&e?zr(n,e,(t,r)=>MM(t,r)):!1}var vm=class{constructor(e,t){this.version=e,this.transformResults=t}},qr=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function yu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var hs=class{};function q_(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new $c(n.key,qr.none()):new Hr(n.key,n.data,qr.none());{let t=n.data,r=$t.empty(),i=new et(Tt.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Bn(n.key,r,new mn(i.toArray()),qr.none())}}function LM(n,e,t){n instanceof Hr?BM(n,e,t):n instanceof Bn?UM(n,e,t):zM(n,e,t)}function Lo(n,e,t,r){return n instanceof Hr?qM(n,e,t,r):n instanceof Bn?VM(n,e,t,r):GM(n,e,t)}function FM(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=P_(r.transform,i||null);s!=null&&(t===null&&(t=$t.empty()),t.set(r.field,s))}return t||null}function xE(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!PM(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Hr=class extends hs{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function BM(n,e,t){let r=n.value.clone(),i=V_(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function qM(n,e,t,r){if(!yu(n.precondition,e))return t;let i=n.value.clone(),s=z_(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Bn=class extends hs{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function UM(n,e,t){if(!yu(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=V_(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(U_(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function VM(n,e,t,r){if(!yu(n.precondition,e))return t;let i=z_(n.fieldTransforms,r,e),s=e.data;return s.setAll(U_(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function U_(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function V_(n,e,t){let r=new Map;ue(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,OM(o,a,t[i]))}return r}function z_(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,NM(s,o,e))}return r}var $c=class extends hs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function zM(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function GM(n,e,t){return yu(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Tm=class extends hs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Sm=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];LM(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Lo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Lo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=x_();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=q_(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&zr(this.mutations,e.mutations,(t,r)=>xE(t,r))&&zr(this.baseMutations,e.baseMutations,(t,r)=>xE(t,r))}},wm=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){ue(e.mutations.length===r.length);let i=bM(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Em=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var _m=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Be=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Be||{});function jM(n){switch(n){case b.OK:return B();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0;default:return B()}}function $M(n){return jM(n)&&n!==b.ABORTED}function Bc(n){if(n===void 0)return Ht("GRPC error has no .code"),b.UNKNOWN;switch(n){case Be.OK:return b.OK;case Be.CANCELLED:return b.CANCELLED;case Be.UNKNOWN:return b.UNKNOWN;case Be.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case Be.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case Be.INTERNAL:return b.INTERNAL;case Be.UNAVAILABLE:return b.UNAVAILABLE;case Be.UNAUTHENTICATED:return b.UNAUTHENTICATED;case Be.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case Be.NOT_FOUND:return b.NOT_FOUND;case Be.ALREADY_EXISTS:return b.ALREADY_EXISTS;case Be.PERMISSION_DENIED:return b.PERMISSION_DENIED;case Be.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case Be.ABORTED:return b.ABORTED;case Be.OUT_OF_RANGE:return b.OUT_OF_RANGE;case Be.UNIMPLEMENTED:return b.UNIMPLEMENTED;case Be.DATA_LOSS:return b.DATA_LOSS;default:return B()}}var Cm=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Gp=null;function KM(){return new Zx}var HM=new Ir([4294967295,4294967295],0);function kE(n){let e=KM().encode(n),t=new jv;return t.update(e),new Uint8Array(t.digest())}function ME(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Ir([t,r],0),a=new Ir([i,s],0);return[o,a]}var bm=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Br(`Invalid padding: ${t}`);if(r<0)throw new Br(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Br(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Br(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Ir.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Ir.fromNumber(r)));return i.compare(HM)===1&&(i=new Ir([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=kE(e),[r,i]=ME(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=kE(e),[r,i]=ME(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Br=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Kc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Go.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(K.min(),i,new we(ne),Fn(),Q())}},Go=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Q(),Q(),Q())}};var ts=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Hc=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Wc=class{constructor(e,t,r=ct.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Qc=class{constructor(){this.pendingResponses=0,this.documentChanges=LE(),this._resumeToken=ct.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Q(),t=Q(),r=Q();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new Go(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=LE()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,ue(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},WM="WatchChangeAggregator",Im=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Fn(),this.pendingDocumentTargetMapping=PE(),this.pendingTargetResets=new we(ne)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(gm(s))if(r===0){let o=new U(s.path);this.removeDocumentFromTarget(t,o,Wt.newNoDocument(o,K.min()))}else ue(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Gp?.notifyOnExistenceFilterMismatch(QM(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=gr(r).toUint8Array()}catch(l){if(l instanceof Cm)return es("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new bm(o,i,s)}catch(l){return l instanceof Br?es("BloomFilter error: ",l):es("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&gm(a.target)){let l=new U(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Wt.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Q();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new Kc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Fn(),this.pendingDocumentTargetMapping=PE(),this.pendingTargetResets=new we(ne),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Qc,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new et(ne),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||L(WM,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Qc),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function PE(){return new we(U.comparator)}function LE(){return new we(U.comparator)}function QM(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var m;return(m=r?.mightContain(p))!==null&&m!==void 0?m:!1}}),d}var YM=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),XM=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),JM=(()=>{let n={};return n.and="AND",n.or="OR",n})();var Am=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function ZM(n){let e=n.code===void 0?b.UNKNOWN:Bc(n.code);return new q(e,n.message||"")}function Rm(n,e){return n.useProto3Json||pu(e)?e:{value:e}}function eP(n){let e;return typeof n=="object"?e=n.value:e=n,pu(e)?null:e}function Yc(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function tP(n){let e=Ln(n);return new Ge(e.seconds,e.nanos)}function G_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function nP(n,e){return n.useProto3Json?(ue(e===void 0||typeof e=="string"),ct.fromBase64String(e||"")):(ue(e===void 0||e instanceof Buffer||e instanceof Uint8Array),ct.fromUint8Array(e||new Uint8Array))}function rP(n,e){return Yc(n,e.toTimestamp())}function Tn(n){return ue(!!n),K.fromTimestamp(tP(n))}function Lg(n,e){return Dm(n,e).canonicalString()}function Dm(n,e){let t=sP(n).child("documents");return e===void 0?t:t.child(e)}function j_(n){let e=De.fromString(n);return ue(Q_(e)),e}function Nm(n,e){return Lg(n.databaseId,e.path)}function jp(n,e){let t=j_(e);if(t.get(1)!==n.databaseId.projectId)throw new q(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(K_(t))}function $_(n,e){return Lg(n.databaseId,e)}function iP(n){let e=j_(n);return e.length===4?De.emptyPath():K_(e)}function Om(n){return new De(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function sP(n){return new De(["projects",n.projectId,"databases",n.database])}function K_(n){return ue(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function FE(n,e,t){return{name:Nm(n,e),fields:t.value.mapValue.fields}}function oP(n,e){let t;if("targetChange"in e){e.targetChange;let r=aP(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=nP(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&ZM(o);t=new Wc(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=jp(n,r.document.name),s=Tn(r.document.updateTime),o=r.document.createTime?Tn(r.document.createTime):K.min(),a=new $t({mapValue:{fields:r.document.fields}}),l=Wt.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new ts(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=jp(n,r.document),s=r.readTime?Tn(r.readTime):K.min(),o=Wt.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ts([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=jp(n,r.document),s=r.removedTargetIds||[];t=new ts([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new _m(i,s),a=r.targetId;t=new Hc(a,o)}else return B();return t}function aP(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:B()}function lP(n){if(!("targetChange"in n))return K.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?K.min():Tn(e.readTime)}function cP(n,e){let t;if(e instanceof Hr)t={update:FE(n,e.key,e.value)};else if(e instanceof $c)t={delete:Nm(n,e.key)};else if(e instanceof Bn)t={update:FE(n,e.key,e.data),updateMask:VP(e.fieldMask)};else if(e instanceof Tm)t={verify:Nm(n,e.key)};else return B();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>fP(n,r))),e.precondition.isNone||(t.currentDocument=uP(n,e.precondition)),t}function uP(n,e){return e.updateTime!==void 0?{updateTime:rP(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:B()}function hP(n,e){let t=n.updateTime?Tn(n.updateTime):Tn(e);return t.isEqual(K.min())&&(t=Tn(e)),new vm(t,n.transformResults||[])}function dP(n,e){return n&&n.length>0?(ue(e!==void 0),n.map(t=>hP(t,e))):[]}function fP(n,e){let t=e.transform;if(t instanceof cs)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof $r)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Kr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof us)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw B()}function pP(n,e){return{documents:[$_(n,e.path)]}}function mP(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=$_(n,i);let s=SP(e.filters);s&&(t.structuredQuery.where=s);let o=EP(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Rm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=CP(e.startAt)),e.endAt&&(t.structuredQuery.endAt=bP(e.endAt)),{queryTarget:t,parent:i}}function gP(n){let e=iP(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){ue(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=wP(t.where));let o=[];t.orderBy&&(o=_P(t.orderBy));let a=null;t.limit&&(a=eP(t.limit));let l=null;t.startAt&&(l=IP(t.startAt));let c=null;return t.endAt&&(c=AP(t.endAt)),uM(e,i,o,s,a,"F",l,c)}function yP(n,e){let t=vP(e.purpose);return t==null?null:{"goog-listen-tags":t}}function vP(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}function TP(n,e){let t,r=e.target;if(gm(r)?t={documents:pP(n,r)}:t={query:mP(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=G_(n,e.resumeToken);let i=Rm(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(K.min())>0){t.readTime=Yc(n,e.snapshotVersion.toTimestamp());let i=Rm(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function SP(n){if(n.length!==0)return W_(Sn.create(n,"and"))}function wP(n){let e=H_(n);return e instanceof Sn&&C_(e)?e.getFilters():[e]}function H_(n){return n.unaryFilter!==void 0?BP(n):n.fieldFilter!==void 0?qP(n):n.compositeFilter!==void 0?UP(n):B()}function EP(n){if(n.length!==0)return n.map(e=>MP(e))}function _P(n){return n.map(e=>PP(e))}function CP(n){return{before:n.inclusive,values:n.position}}function bP(n){return{before:!n.inclusive,values:n.position}}function IP(n){let e=!!n.before,t=n.values||[];return new ss(t,e)}function AP(n){let e=!n.before,t=n.values||[];return new ss(t,e)}function RP(n){return YM[n]}function DP(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function NP(n){return XM[n]}function OP(n){return JM[n]}function xP(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B();default:return B()}}function kP(n){switch(n){case"AND":return"and";case"OR":return"or";default:return B()}}function Xi(n){return{fieldPath:n.canonicalString()}}function Zi(n){return Tt.fromServerFormat(n.fieldPath)}function MP(n){return{field:Xi(n.field),direction:RP(n.dir)}}function PP(n){return new os(Zi(n.field),DP(n.direction))}function W_(n){return n instanceof xe?FP(n):n instanceof Sn?LP(n):B()}function LP(n){let e=n.getFilters().map(t=>W_(t));return e.length===1?e[0]:{compositeFilter:{op:OP(n.op),filters:e}}}function FP(n){if(n.op==="=="){if(AE(n.value))return{unaryFilter:{field:Xi(n.field),op:"IS_NAN"}};if(IE(n.value))return{unaryFilter:{field:Xi(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(AE(n.value))return{unaryFilter:{field:Xi(n.field),op:"IS_NOT_NAN"}};if(IE(n.value))return{unaryFilter:{field:Xi(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xi(n.field),op:NP(n.op),value:n.value}}}function BP(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Zi(n.unaryFilter.field);return xe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Zi(n.unaryFilter.field);return xe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Zi(n.unaryFilter.field);return xe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Zi(n.unaryFilter.field);return xe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B();default:return B()}}function qP(n){return xe.create(Zi(n.fieldFilter.field),xP(n.fieldFilter.op),n.fieldFilter.value)}function UP(n){return Sn.create(n.compositeFilter.filters.map(e=>H_(e)),kP(n.compositeFilter.op))}function VP(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Q_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var jo=class n{constructor(e,t,r,i,s=K.min(),o=K.min(),a=ct.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var xm=class{constructor(e){this.remoteSerializer=e}};function zP(n){let e=gP({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ym(e,e.limit,"L"):e}function GP(n){return{name:n.name,query:zP(n.bundledQuery),readTime:Tn(n.readTime)}}function jP(n){return{id:n.id,version:n.version,createTime:Tn(n.createTime)}}var $P=5,KP=10,HP=13,BE=15,WP=20,QP=25,YP=30,XP=37,JP=45,ZP=50,eL=55,tL=60,nL=2,Xc=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,$P);else if("booleanValue"in e)this.writeValueTypeLabel(t,KP),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,BE),t.writeNumber(Se(e.integerValue));else if("doubleValue"in e){let r=Se(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,HP):(this.writeValueTypeLabel(t,BE),qo(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,WP),typeof r=="string"&&(r=Ln(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,YP),t.writeBytes(gr(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,JP),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?S_(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):B()}writeIndexString(e,t){this.writeValueTypeLabel(t,QP),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,eL);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,ZP);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,XP),U.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,tL),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(nL)}};Xc.INSTANCE=new Xc;var km=class{constructor(){this.collectionParentIndex=new Mm}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),I.resolve()}getCollectionParents(e,t){return I.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return I.resolve()}deleteFieldIndex(e,t){return I.resolve()}deleteAllFieldIndexes(e){return I.resolve()}createTargetIndexes(e,t){return I.resolve()}getDocumentsMatchingTarget(e,t){return I.resolve(null)}getIndexType(e,t){return I.resolve(0)}getFieldIndexes(e,t){return I.resolve([])}getNextCollectionGroupToUpdate(e){return I.resolve(null)}getMinOffset(e,t){return I.resolve(Gr.min())}getMinOffsetFromCollectionGroup(e,t){return I.resolve(Gr.min())}updateCollectionGroup(e,t,r){return I.resolve()}updateIndexEntries(e,t){return I.resolve()}},Mm=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new et(De.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new et(De.comparator)).toArray()}};var DU=new Uint8Array(0);var $p=2,$o=class n{constructor(e){this.lastId=e}next(){return this.lastId+=$p,this.lastId}static forTargetCache(){return new n(2-$p)}static forSyncEngine(){return new n(1-$p)}};var Y_=-1,X_=40*1024*1024,gn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};gn.DEFAULT_COLLECTION_PERCENTILE=10;gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;gn.DEFAULT=new gn(X_,gn.DEFAULT_COLLECTION_PERCENTILE,gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);gn.DISABLED=new gn(Y_,0,0);var qE=1*1024*1024,NU=1*60*1e3,OU=5*60*1e3;var Pm=class{constructor(){this.changes=new yr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Wt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?I.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Lm=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Fm=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Lo(r.mutation,i,mn.empty(),Ge.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Q()){let i=Fr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ko();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Fr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Q()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Fn(),o=zo(),a=_M();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Bn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Lo(u.mutation,c,u.mutation.getFieldMask(),Ge.now())):o.set(c.key,mn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new Lm(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=zo(),i=new we((o,a)=>o-a),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||mn.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||Q()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=x_();u.forEach(f=>{if(!s.has(f)){let p=q_(t.get(f),r.get(f));p!==null&&d.set(f,p),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return I.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return fM(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):pM(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):I.resolve(Fr()),a=Fo,l=s;return o.next(c=>I.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?I.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Q())).next(u=>({batchId:a,changes:O_(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=ko();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=ko();return this.indexManager.getCollectionParents(e,s).next(a=>I.forEach(a,l=>{let c=hM(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Wt.newInvalidDocument(u)))});let a=ko();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Lo(u.mutation,c,mn.empty(),Ge.now()),gu(t,c)&&(a=a.insert(l,c))}),a})}};var Bm=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return I.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,jP(t)),I.resolve()}getNamedQuery(e,t){return I.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,GP(t)),I.resolve()}};var qm=class{constructor(){this.overlays=new we(U.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return I.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Fr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),I.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),I.resolve()}getOverlaysForCollection(e,t,r){let i=Fr(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return I.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new we((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=Fr(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=Fr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>a.set(d,f)),!(a.size()>=i)););return I.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Em(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Q(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Ko=class{constructor(){this.refsByKey=new et(Re.compareByKey),this.refsByTarget=new et(Re.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Re(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Re(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new U(new De([])),r=new Re(t,e),i=new Re(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new U(new De([])),r=new Re(t,e),i=new Re(t,e+1),s=Q();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Re(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Re=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return U.comparator(e.key,t.key)||ne(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ne(e.targetOrBatchId,t.targetOrBatchId)||U.comparator(e.key,t.key)}};var Um=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new et(Re.compareByKey)}checkEmpty(e){return I.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Sm(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Re(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return I.resolve(o)}lookupMutationBatch(e,t){return I.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return I.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return I.resolve(this.mutationQueue.length===0?Ng:this.nextBatchId-1)}getAllMutationBatches(e){return I.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Re(t,0),i=new Re(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),I.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new et(ne);return t.forEach(i=>{let s=new Re(i,0),o=new Re(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),I.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new Re(new U(s),0),a=new et(ne);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),I.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");ue(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return I.forEach(t.mutations,s=>{let o=new Re(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Re(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return I.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,I.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function rL(){return new we(U.comparator)}var Vm=class{constructor(e){this.sizer=e,this.docs=rL(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return I.resolve(r?r.document.mutableCopy():Wt.newInvalidDocument(t))}getEntries(e,t){let r=Fn();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Wt.newInvalidDocument(i))}),I.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Fn(),o=t.path,a=new U(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ck(lk(u),r)<=0||!i.has(u.key)&&!gu(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return I.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}forEachDocumentKey(e,t){return I.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new zm(this)}getSize(e){return I.resolve(this.size)}};function iL(n){return new Vm(n)}var zm=class extends Pm{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Gm=class{constructor(e){this.persistence=e,this.targets=new yr(t=>kg(t),Mg),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Ko,this.targetCount=0,this.targetIdGenerator=$o.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),I.resolve()}getLastRemoteSnapshotVersion(e){return I.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return I.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),I.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),I.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new $o(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,I.resolve()}updateTargetData(e,t){return this.saveTargetData(t),I.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,I.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),I.waitFor(s).next(()=>i)}getTargetCount(e){return I.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return I.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),I.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),I.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),I.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return I.resolve(r)}containsKey(e,t){return I.resolve(this.references.containsKey(t))}};var sL="MemoryPersistence",jm=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new e_(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new Gm(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new km,this.remoteDocumentCache=iL(r),this.serializer=new xm(t),this.bundleCache=new Bm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Um(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){L(sL,"Starting transaction:",e);let i=new $m(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return I.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},$m=class extends nm{constructor(e){super(),this.currentSequenceNumber=e}},Km=class n{constructor(e){this.persistence=e,this.localViewReferences=new Ko,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw B()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),I.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),I.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),I.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return I.forEach(this.orphanedDocuments,i=>{let s=U.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,K.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return I.or([()=>I.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var xU=30*60*1e3;var Fg="LocalStore",oL=5*60*1e6,Hm=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new we(ne),this.targetIdByTarget=new yr(s=>kg(s),Mg),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Fm(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function aL(n,e,t,r){return new Hm(n,e,t,r)}function J_(n,e){return C(this,null,function*(){let t=$(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Q();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function lL(n,e){let t=$(n),r=Ge.now(),i=e.reduce((a,l)=>a.add(l.key),Q()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Fn(),c=Q();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let f of e){let p=FM(f,s.get(f.key).overlayedDocument);p!=null&&d.push(new Bn(f.key,p,w_(p.value.mapValue),qr.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:O_(s)}))}function cL(n,e){let t=$(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return TL(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,uL(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function uL(n){let e=Q();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function hL(n,e){let t=$(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(ue(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function Z_(n){let e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function dL(n,e){let t=$(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let p=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(ct.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),pL(f,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=Fn(),c=Q();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(fL(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(K.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return I.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function fL(n,e,t){let r=Q(),i=Q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Fn();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(K.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):L(Fg,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function pL(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=oL?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function mL(n,e){return C(this,null,function*(){let t=$(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>I.forEach(e,i=>I.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>I.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Zo(r))L(Fg,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function gL(n,e){let t=$(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ng),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function yL(n,e){let t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,I.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new jo(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function vL(n,e,t){let r=$(n),i=r.targetIdByTarget.get(t);return i!==void 0?I.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Wm(n,e,t){return C(this,null,function*(){let r=$(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Zo(o))L(Fg,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function eC(n,e,t){let r=$(n),i=K.min(),s=Q();return r.persistence.runTransaction("Execute query","readwrite",o=>vL(r,o,vn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:K.min(),t?s:Q())).next(a=>(SL(r,SM(e),a),{documents:a,remoteKeys:s})))}function TL(n,e,t,r){let i=t.batch,s=i.keys(),o=I.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);ue(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function SL(n,e,t){let r=n.collectionGroupReadTime.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}var Qm=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var wL=100;function EL(){return fy()?8:hk(dy())>0?6:4}var Ym=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=wL,this.relativeIndexReadCostPerDocument=EL()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Qm;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(xo()<=Cn.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",Yi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),I.resolve()):(xo()<=Cn.DEBUG&&L("QueryEngine","Query:",Yi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(xo()<=Cn.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",Yi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vn(t))):I.resolve())}performQueryUsingIndex(e,t){if(NE(t))return I.resolve(null);let r=vn(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ym(t,null,"F"),r=vn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Q(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,ym(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return NE(t)||i.isEqual(K.min())?I.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?I.resolve(null):(xo()<=Cn.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Yi(t)),this.appendRemainingResults(e,o,t,ak(i,Fo)).next(a=>a))})}applyQuery(e,t){let r=new et(D_(e));return t.forEach((i,s)=>{gu(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return xo()<=Cn.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",Yi(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Gr.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Jc=class{constructor(){this.activeTargetIds=RM()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Xm=class{constructor(){this.localState=new Jc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Jc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Jm=class{addCallback(e){}shutdown(){}};var Zm=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Lc=null;function _L(){return 268435456+Math.round(2147483648*Math.random())}function Kp(){return Lc===null?Lc=_L():Lc++,"0x"+Lc.toString(16)}function CL(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var bL="1.9.1",lt="GrpcConnection",IL=`gl-node/${process.versions.node} fire/${ms} grpc/${bL}`;function Hp(n,e,t,r){ue(e===null||e.type==="OAuth");let i=new Ur.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",IL),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var eg=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){L(lt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Ur.credentials.createSsl():Ur.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Kp(),a=this.ensureActiveStub(),l=Hp(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return CL(u=>(L(lt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,f)=>{d?(L(lt,`RPC '${e}' ${o} failed with error:`,d),u(new q(Bc(d.code),d.message))):(L(lt,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Kp(),l=[],c=new yn;L(lt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=Hp(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](f,d),m=!1;return p.on("data",g=>{L(lt,`RPC ${e} ${a} received result:`,g),l.push(g),o!==void 0&&l.length===o&&(m=!0,c.resolve(l))}),p.on("end",()=>{L(lt,`RPC '${e}' ${a} completed.`),m||(m=!0,c.resolve(l))}),p.on("error",g=>{L(lt,`RPC '${e}' ${a} failed with error:`,g);let v=Bc(g.code);c.reject(new q(v,g.message))}),c.promise}openStream(e,t,r){let i=Kp(),s=this.ensureActiveStub(),o=Hp(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new Zm({sendFn:f=>{if(l)L(lt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{L(lt,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(p){throw Ht("Failure sending:",f),Ht("Error:",p),p}}},closeFn:()=>{L(lt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",f=>{l||(L(lt,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),a.on("end",()=>{L(lt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){es(lt,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let p=Bc(f.code);c(new q(p,f.message))}}),L(lt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},tC={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},AL={nested:tC},RL=Object.freeze({__proto__:null,nested:tC,default:AL});var DL={longs:String,enums:String,defaults:!0,oneofs:!1};function NL(){let n=ZE.fromJSON(RL,DL);return Ur.loadPackageDefinition(n)}function OL(n){let e=NL();return new eg(e,n)}function xL(){return new Jm}function vu(n){return new Am(n,!1)}var kL="ExponentialBackoff",ML=1e3,PL=1.5,LL=60*1e3,Zc=class{constructor(e,t,r=ML,i=PL,s=LL){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&L(kL,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var UE="PersistentStream",FL=60*1e3,BL=10*1e3,eu=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Zc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return C(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,FL,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return C(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return C(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(Ht(t.toString()),Ht("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new q(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,BL,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>C(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return L(UE,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(L(UE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},tg=class extends eu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=oP(this.serializer,e),r=lP(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Om(this.serializer),t.addTarget=TP(this.serializer,e);let r=yP(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Om(this.serializer),t.removeTarget=e,this.sendRequest(t)}},ng=class extends eu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(ue(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=dP(e.writeResults,e.commitTime),r=Tn(e.commitTime);return this.listener.onMutationResult(r,t)}else return ue(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=Om(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>cP(this.serializer,r))};this.sendRequest(t)}};var rg=class{},ig=class extends rg{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new q(b.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Dm(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new q(b.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Dm(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(b.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function qL(n,e,t,r){return new ig(n,e,t,r)}function UL(n,e,t){let r=$(n);return r.verifyInitialized(),new ng(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function VL(n,e,t){let r=$(n);return r.verifyInitialized(),new tg(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var zL="OnlineStateTracker",VE=1,zE=10*1e3,sg=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",zE,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${zE/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=VE&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${VE} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ht(t),this.shouldWarnClientIsOffline=!1):L(zL,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Wr="RemoteStore",GL=10,og=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>C(this,null,function*(){Yr(this)&&(L(Wr,"Restarting streams for network reachability change."),yield sF(this))}))}),this.onlineStateTracker=new sg(r,i)}};function jL(n,e,t,r,i){return new og(n,e,t,r,i)}function Tu(n){return C(this,null,function*(){if(Yr(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function ea(n){return C(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function $L(n){return C(this,null,function*(){let e=$(n);L(Wr,"RemoteStore shutting down."),e.offlineCauses.add(5),yield ea(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function nC(n,e){let t=$(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Vg(t)?Ug(t):ys(t).isOpen()&&qg(t,e))}function Bg(n,e){let t=$(n),r=ys(t);t.listenTargets.delete(e),r.isOpen()&&rC(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Yr(t)&&t.onlineStateTracker.set("Unknown"))}function qg(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ys(n).watch(e)}function rC(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ys(n).unwatch(e)}function Ug(n){n.watchChangeAggregator=new Im({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ys(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Vg(n){return Yr(n)&&!ys(n).isStarted()&&n.listenTargets.size>0}function Yr(n){return $(n).offlineCauses.size===0}function iC(n){n.watchChangeAggregator=void 0}function KL(n){return C(this,null,function*(){n.onlineStateTracker.set("Online")})}function HL(n){return C(this,null,function*(){n.listenTargets.forEach((e,t)=>{qg(n,e)})})}function WL(n,e){return C(this,null,function*(){iC(n),Vg(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),Ug(n)):n.onlineStateTracker.set("Unknown")})}function QL(n,e,t){return C(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Wc&&e.state===2&&e.cause){try{yield XL(n,e)}catch(r){L(Wr,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield tu(n,r)}return}if(e instanceof ts?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Hc?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(K.min()))try{let r=yield Z_(n.localStore);t.compareTo(r)>=0&&(yield YL(n,t))}catch(r){L(Wr,"Failed to raise snapshot:",r),yield tu(n,r)}})}function tu(n,e,t){return C(this,null,function*(){if(Zo(e))n.offlineCauses.add(1),yield ea(n),n.onlineStateTracker.set("Offline"),t||(t=()=>Z_(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){L(Wr,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Tu(n)}));else throw e})}function sC(n,e){return e().catch(t=>tu(n,t,e))}function YL(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(ct.EMPTY_BYTE_STRING,s.snapshotVersion)),rC(n,r);let o=new jo(s.target,r,i,s.sequenceNumber);qg(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function XL(n,e){return C(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function Su(n){return C(this,null,function*(){let e=$(n),t=Tr(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Ng;for(;JL(e);)try{let i=yield gL(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,ZL(e,i)}catch(i){yield tu(e,i)}oC(e)&&aC(e)})}function JL(n){return Yr(n)&&n.writePipeline.length<GL}function ZL(n,e){n.writePipeline.push(e);let t=Tr(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function oC(n){return Yr(n)&&!Tr(n).isStarted()&&n.writePipeline.length>0}function aC(n){Tr(n).start()}function eF(n){return C(this,null,function*(){Tr(n).writeHandshake()})}function tF(n){return C(this,null,function*(){let e=Tr(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function nF(n,e,t){return C(this,null,function*(){let r=n.writePipeline.shift(),i=wm.from(r,e,t);yield sC(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Su(n)})}function rF(n,e){return C(this,null,function*(){e&&Tr(n).handshakeComplete&&(yield iF(n,e)),oC(n)&&aC(n)})}function iF(n,e){return C(this,null,function*(){if($M(e.code)){let t=n.writePipeline.shift();Tr(n).inhibitBackoff(),yield sC(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Su(n)}})}function sF(n){return C(this,null,function*(){let e=$(n);e.offlineCauses.add(4),yield ea(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Tu(e)})}function GE(n,e){return C(this,null,function*(){let t=$(n);t.asyncQueue.verifyOperationInProgress(),L(Wr,"RemoteStore received new credentials");let r=Yr(t);t.offlineCauses.add(3),yield ea(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Tu(t)})}function oF(n,e){return C(this,null,function*(){let t=$(n);e?(t.offlineCauses.delete(2),yield Tu(t)):e||(t.offlineCauses.add(2),yield ea(t),t.onlineStateTracker.set("Unknown"))})}function ys(n){return n.watchStream||(n.watchStream=VL(n.datastore,n.asyncQueue,{onConnected:KL.bind(null,n),onOpen:HL.bind(null,n),onClose:WL.bind(null,n),onWatchChange:QL.bind(null,n)}),n.onNetworkStatusChange.push(e=>C(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Vg(n)?Ug(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),iC(n))}))),n.watchStream}function Tr(n){return n.writeStream||(n.writeStream=UL(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:eF.bind(null,n),onClose:rF.bind(null,n),onHandshakeComplete:tF.bind(null,n),onMutationResult:nF.bind(null,n)}),n.onNetworkStatusChange.push(e=>C(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Su(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(L(Wr,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var aF="AsyncQueue",ag=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function zg(n,e){if(Ht(aF,`${e}: ${n}`),Zo(n))return new q(b.UNAVAILABLE,`${e}: ${n}`);throw n}var nu=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||U.comparator(t.key,r.key):this.comparator=(t,r)=>U.comparator(t.key,r.key),this.keyedMap=ko(),this.sortedSet=new we(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var ru=class{constructor(){this.changeMap=new we(U.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):B()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},ds=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,nu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!mu(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var lg=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function lF(){return new cg}var cg=class{constructor(){this.queries=new yr(e=>R_(e),mu),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function cF(n,e){return C(this,null,function*(){let t=$(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new lg,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=zg(o,`Initialization of query '${Yi(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Gg(t)})}function uF(n,e){return C(this,null,function*(){let t=$(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function hF(n,e){let t=$(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&Gg(t)}function dF(n,e,t){let r=$(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function fF(n,e){let t=$(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&Gg(t)}function Gg(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var lC=function(n){return n.Default="default",n.Cache="cache",n}(lC||{}),ug=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ds(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=ds.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==lC.Cache}};var hg=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Q(),i=Q();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var iu=class{constructor(e){this.key=e}},su=class{constructor(e){this.key=e}},dg=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Q(),this.mutatedKeys=Q(),this.docComparator=D_(e),this.documentSet=new nu(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new ru,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),p=gu(this.query,d)?d:null,m=f?this.mutatedKeys.has(f.key):!1,g=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,v=!1;f&&p?f.data.isEqual(p.data)?m!==g&&(r.track({type:3,doc:p}),v=!0):this.shouldWaitForSyncedDocument(f,p)||(r.track({type:2,doc:p}),v=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!f&&p?(r.track({type:0,doc:p}),v=!0):f&&!p&&(r.track({type:1,doc:f}),v=!0,(l||c)&&(a=!0)),v&&(p?(o=o.add(p),g?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,f)=>pF(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new ds(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new ru,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Q(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new su(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new iu(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Q();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ds.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function pF(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return B()}};return t(n)-t(e)}var jg="SyncEngine",fg=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},pg=class{constructor(e){this.key=e,this.receivedDocument=!1}},mg=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new yr(a=>R_(a),mu),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new we(U.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Ko,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=$o.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function mF(n,e,t,r,i,s,o){let a=new mg(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function gF(n,e,t=!0){return C(this,null,function*(){let r=mC(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield cC(r,e,t,!0),i})}function yF(n,e){return C(this,null,function*(){let t=mC(n);yield cC(t,e,!0,!1)})}function cC(n,e,t,r){return C(this,null,function*(){let i=yield yL(n.localStore,vn(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield vF(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&nC(n.remoteStore,i),a})}function vF(n,e,t,r,i){return C(this,null,function*(){n.applyDocChanges=(d,f,p)=>RF(n,d,f,p);let s=yield eC(n.localStore,e,!0),o=new dg(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Go.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);pC(n,t,c.limboChanges);let u=new fg(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function TF(n,e,t){return C(this,null,function*(){let r=$(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!mu(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Wm(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Bg(r.remoteStore,i.targetId),gg(r,i.targetId)}).catch(Jo))):(gg(r,i.targetId),yield Wm(r.localStore,i.targetId,!0))})}function SF(n,e){return C(this,null,function*(){let t=$(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Bg(t.remoteStore,r.targetId))})}function wF(n,e,t){return C(this,null,function*(){let r=OF(n);try{let i=yield lL(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),IF(r,i.batchId,t),yield ta(r,i.changes),yield Su(r.remoteStore)}catch(i){let s=zg(i,"Failed to persist write");t.reject(s)}})}function uC(n,e){return C(this,null,function*(){let t=$(n);try{let r=yield dL(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(ue(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?ue(o.receivedDocument):i.removedDocuments.size>0&&(ue(o.receivedDocument),o.receivedDocument=!1))}),yield ta(t,r,e)}catch(r){yield Jo(r)}})}function jE(n,e,t){let r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),fF(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function EF(n,e,t){return C(this,null,function*(){let r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new we(U.comparator);o=o.insert(s,Wt.newNoDocument(s,K.min()));let a=Q().add(s),l=new Kc(K.min(),new Map,new we(ne),o,a);yield uC(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),$g(r)}else yield Wm(r.localStore,e,!1).then(()=>gg(r,e,t)).catch(Jo)})}function _F(n,e){return C(this,null,function*(){let t=$(n),r=e.batch.batchId;try{let i=yield cL(t.localStore,e);dC(t,r,null),hC(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ta(t,i)}catch(i){yield Jo(i)}})}function CF(n,e,t){return C(this,null,function*(){let r=$(n);try{let i=yield hL(r.localStore,e);dC(r,e,t),hC(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ta(r,i)}catch(i){yield Jo(i)}})}function hC(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function bF(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new q(b.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function IF(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new we(ne)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function dC(n,e,t){let r=$(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function gg(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||fC(n,i)})}function fC(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Bg(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),$g(n))}function pC(n,e,t){for(let r of t)r instanceof iu?(n.limboDocumentRefs.addReference(r.key,e),AF(n,r)):r instanceof su?(L(jg,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||fC(n,r.key)):B()}function AF(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(L(jg,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),$g(n))}function $g(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new U(De.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new pg(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),nC(n.remoteStore,new jo(vn(Pg(t.path)),r,"TargetPurposeLimboResolution",e_.INVALID))}}function ta(n,e,t){return C(this,null,function*(){let r=$(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=hg.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield mL(r.localStore,s))})}function RF(n,e,t,r){return C(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield eC(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return pC(n,e.targetId,a.limboChanges),a.snapshot})}function DF(n,e){return C(this,null,function*(){let t=$(n);if(!t.currentUser.isEqual(e)){L(jg,"User change. New user:",e.toKey());let i=yield J_(t.localStore,e);t.currentUser=e,bF(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield ta(t,i.affectedDocuments)}})}function NF(n,e){let t=$(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Q().add(r.key);{let i=Q(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function mC(n){let e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=uC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=NF.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=EF.bind(null,e),e.syncEngineListener.onWatchChange=hF.bind(null,e.eventManager),e.syncEngineListener.onWatchError=dF.bind(null,e.eventManager),e}function OF(n){let e=$(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_F.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=CF.bind(null,e),e}var ou=class{constructor(){this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=vu(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return aL(this.persistence,new Ym,e.initialUser,this.serializer)}createPersistence(e){return new jm(Km.factory,this.serializer)}createSharedClientState(e){return new Xm}terminate(){return C(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var yg=class{initialize(e,t){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>jE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=DF.bind(null,this.syncEngine),yield oF(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return lF()}createDatastore(e){let t=vu(e.databaseInfo.databaseId),r=OL(e.databaseInfo);return qL(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return jL(this.localStore,this.datastore,e.asyncQueue,t=>jE(this.syncEngine,t,0),xL())}createSyncEngine(e,t){return mF(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return C(this,null,function*(){var e;yield $L(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function xF(n,e,t){if(!t)throw new q(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function kF(n,e,t,r){if(e===!0&&r===!0)throw new q(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function $E(n){if(!U.isDocumentKey(n))throw new q(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function MF(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Kg(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=PF(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":B()}function PF(n){return n.constructor?n.constructor.name:null}function ns(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Kg(n);throw new q(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var vg=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ht("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var vr="FirestoreClient",LF=100,FF=11,BF=20,qF=22,Tg=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=qe.UNAUTHENTICATED,this.clientId=Uc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>C(this,null,function*(){L(vr,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(L(vr,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:LF}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new q(b.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=zg(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Wp(n,e){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),L(vr,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>C(this,null,function*(){r.isEqual(i)||(yield J_(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function KE(n,e){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield VF(n);L(vr,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>GE(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>GE(e.remoteStore,i)),n._onlineComponents=e})}function UF(n){return n.name==="FirebaseError"?n.code===b.FAILED_PRECONDITION||n.code===b.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===qF||n.code===BF||n.code===FF:!0}function VF(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(vr,"Using user provided OfflineComponentProvider");try{yield Wp(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!UF(t))throw t;es("Error using user provided cache. Falling back to memory cache: "+t),yield Wp(n,new ou)}}else L(vr,"Using default OfflineComponentProvider"),yield Wp(n,new ou);return n._offlineComponents})}function gC(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(vr,"Using user provided OnlineComponentProvider"),yield KE(n,n._uninitializedComponentsProvider._online)):(L(vr,"Using default OnlineComponentProvider"),yield KE(n,new yg))),n._onlineComponents})}function zF(n){return gC(n).then(e=>e.syncEngine)}function HE(n){return C(this,null,function*(){let e=yield gC(n),t=e.eventManager;return t.onListen=gF.bind(null,e.syncEngine),t.onUnlisten=TF.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yF.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=SF.bind(null,e.syncEngine),t})}function GF(n,e,t,r){let i=new vg(r),s=new ug(e,i,t);return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let o=yield HE(n);return cF(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let o=yield HE(n);return uF(o,s)}))}}function jF(n,e){let t=new yn;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield zF(n);return wF(r,e,t)})),t.promise}function $F(n,e){return n.timeoutSeconds===e.timeoutSeconds}function yC(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var KF="ComponentProvider",WE=new Map;function HF(n){let e=WE.get(n);e&&(L(KF,"Removing Datastore"),WE.delete(n),e.terminate())}function WF(n,e,t,r){return new im(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yC(r.experimentalLongPollingOptions),r.useFetchStreams)}var vC="firestore.googleapis.com",QE=!0,YE=5,XE=30,QF=!0,au=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new q(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vC,this.ssl=QE}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:QE;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=X_;else{if(e.cacheSizeBytes!==Y_&&e.cacheSizeBytes<qE)throw new q(b.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${qE}`);this.cacheSizeBytes=e.cacheSizeBytes}kF("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=QF:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yC((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),YF(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&$F(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function YF(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new q(b.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<YE)throw new q(b.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${YE})`);if(n.timeoutSeconds>XE)throw new q(b.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${XE})`)}}var Ho=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new au({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new q(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new q(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new au(e),e.credentials!==void 0&&(this._authCredentials=ik(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return HF(this),Promise.resolve()}};function TC(n,e,t,r={}){var i;n=ns(n,Ho);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==vC&&s.host!==o&&es("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=qe.MOCK_USER;else{a=hy(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new q(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new qe(c)}n._authCredentials=new Yp(new qc(a,l))}}var lu=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},kt=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Wo=class n extends lu{constructor(e,t,r){super(e,t,Pg(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new kt(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function SC(n,e,...t){if(n=ni(n),arguments.length===1&&(e=Uc.newId()),xF("doc","path",e),n instanceof Ho){let r=De.fromString(e,...t);return $E(r),new kt(n,null,new U(r))}else{if(!(n instanceof kt)&&!(n instanceof Wo))throw new q(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(De.fromString(e,...t));return $E(r),new kt(n.firestore,n instanceof Wo?n.converter:null,new U(r))}}var XF="AsyncQueue",Sg=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Zc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new yn;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return C(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Zo(e))L(XF,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=ZF(r);throw Ht("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=ag.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&B()}verifyOperationInProgress(){}drain(){return C(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function JF(){return new Sg}function ZF(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var fs=class extends Ho{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=JF(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||_C(this),this._firestoreClient.terminate()}};function wC(n,e){let t=typeof n=="object"?n:Sy(),r=typeof n=="string"?n:e||sm,i=vy(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=uy("firestore");s&&TC(i,...s)}return i}function EC(n){return n._firestoreClient||_C(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function _C(n){var e,t,r;let i=n._freezeSettings(),s=WF(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Tg(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function e2(n,e=!0){nk(Ty),yy(new my("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new fs(new Xp(t.getProvider("auth-internal")),new tm(t.getProvider("app-check-internal")),Ok(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Is(TE,SE,n),Is(TE,SE,"esm2017")}var Qo=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ct.fromBase64String(e))}catch(t){throw new q(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ct.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Yo=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var cu=class{constructor(e){this._methodName=e}};var Xo=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}};var t2=/^__.*__$/,wg=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Bn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Hr(e,this.data,t,this.fieldTransforms)}};function CC(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var Eg=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return uu(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(CC(this.dataSource)&&t2.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},_g=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||vu(e)}createContext(e,t,r,i=!1){return new Eg({dataSource:e,methodName:t,targetDoc:r,path:Tt.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function n2(n){let e=n._freezeSettings(),t=vu(n._databaseId);return new _g(n._databaseId,!!e.ignoreUndefinedProperties,t)}function r2(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);RC("Data must be an object, but it was:",o,r);let a=IC(r,o),l,c;if(s.merge)l=new mn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=a2(e,d,t);if(!o.contains(f))throw new q(b.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);c2(u,f)||u.push(f)}l=new mn(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new wg(new $t(a),l,c)}function bC(n,e){if(n=ni(n),AC(n))return RC("Unsupported field value:",e,n),IC(n,e);if(n instanceof cu)return s2(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return i2(n,e)}else return o2(n,e)}function IC(n,e){let t={};return p_(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gs(n,(r,i)=>{let s=bC(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function i2(n,e){let t=[],r=0;for(let i of n){let s=bC(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function s2(n,e){if(!CC(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function o2(n,e){if(n=ni(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return DM(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ge.fromDate(n);return{timestampValue:Yc(e.serializer,t)}}else if(n instanceof Ge){let t=new Ge(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Yc(e.serializer,t)}}else{if(n instanceof Xo)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Qo)return{bytesValue:G_(e.serializer,n._byteString)};if(n instanceof kt){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:Lg(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${Kg(n)}`)}}function AC(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ge)&&!(n instanceof Xo)&&!(n instanceof Qo)&&!(n instanceof kt)&&!(n instanceof cu)}function RC(n,e,t){if(!AC(t)||!MF(t)){let r=Kg(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function a2(n,e,t){if(e=ni(e),e instanceof Yo)return e._internalPath;if(typeof e=="string")return DC(n,e);throw uu("Field path arguments must be of type string or ",n,!1,void 0,t)}var l2=new RegExp("[~\\*/\\[\\]]");function DC(n,e,t){if(e.search(l2)>=0)throw uu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Yo(...e.split("."))._internalPath}catch{throw uu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function uu(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new q(b.INVALID_ARGUMENT,a+n+l)}function c2(n,e){return n.some(t=>t.isEqual(e))}var hu=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new kt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new Cg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(NC("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Cg=class extends hu{data(){return super.data()}};function NC(n,e){return typeof e=="string"?DC(n,e):e instanceof Yo?e._internalPath:e._delegate._internalPath}function u2(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bg=class{convertValue(e,t="none"){switch(jr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Se(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return gs(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Xo(Se(e.latitude),Se(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Dg(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bo(e));default:return null}}convertTimestamp(e){let t=Ln(e);return new Ge(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=De.fromString(e);ue(Q_(r));let i=new Gc(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Ht(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function h2(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}function JE(n){return d2(n,["next","error","complete"])}function d2(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Qr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},du=class extends hu{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new ps(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(NC("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},ps=class extends du{data(e={}){return super.data(e)}},Ig=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Qr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ps(this._firestore,this._userDataWriter,r.key,r,new Qr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=f2(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function f2(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new ps(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Qr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new ps(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Qr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:p2(r.type),doc:i,oldIndex:s,newIndex:o}})}}function p2(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}var fu=class extends bg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qo(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new kt(this.firestore,null,t)}};function OC(n,e,t){n=ns(n,kt);let r=ns(n.firestore,fs),i=h2(n.converter,e,t),s=n2(r),a=r2(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,qr.none());return m2(r,[a])}function Hg(n,...e){var t,r,i;n=ni(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!JE(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(JE(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof kt)c=ns(n.firestore,fs),u=Pg(n._key.path),l={next:f=>{e[o]&&e[o](g2(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=ns(n,lu);c=ns(f.firestore,fs),u=f._query;let p=new fu(c);l={next:m=>{e[o]&&e[o](new Ig(c,p,f,m))},error:e[o+1],complete:e[o+2]},u2(n._query)}let d=EC(c);return GF(d,u,a,l)}function m2(n,e){let t=EC(n);return jF(t,e)}function g2(n,e,t){let r=t.docs.get(e._key),i=new fu(n);return new du(n,i,e._key,r,new Qr(t.hasPendingWrites,t.fromCache),e.converter)}e2("node");var wu=function(){return wu=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},wu.apply(this,arguments)};var T2={includeMetadataChanges:!1};function xC(n,e){return e===void 0&&(e=T2),new ny(function(t){var r=Hg(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function kC(n){return xC(n,{includeMetadataChanges:!0})}function MC(n,e){return e===void 0&&(e={}),kC(n).pipe(ry(function(t){return PC(t,e)}))}function PC(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:wu(wu({},r),(t={},t[e.idField]=n.id,t))}var na=class{constructor(e){return e}},LC="firestore",Wg=class{constructor(){return _y(LC)}};var Qg=new oa("angularfire2.firestore-instances");function w2(n,e){let t=Ey(LC,n,e);return t&&new na(t)}function E2(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new na(r)}}var _2={provide:Wg,deps:[[new Ts,Qg]]},C2={provide:na,useFactory:w2,deps:[[new Ts,Qg],Iy]},b2=(()=>{class n{constructor(){Is("angularfire",wy.full,"fst")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=aa({type:n});static \u0275inj=sa({providers:[C2,_2]})}return n})();function g3(n,...e){return{ngModule:b2,providers:[{provide:Qg,useFactory:E2(n),multi:!0,deps:[Ss,ti,by,Ay,[new Ts,Ry],[new Ts,Cy],...e]}]}}var y3=As(MC,!0);var v3=As(SC,!0);var T3=As(wC,!0);var S3=As(OC,!0);var FC=["toast-component",""];function I2(n,e){if(n&1){let t=Du();Mt(0,"button",5),bs("click",function(){Cu(t);let i=pt();return bu(i.remove())}),Mt(1,"span",6),_n(2,"\xD7"),En()()}}function A2(n,e){if(n&1&&(Au(0),_n(1),Ru()),n&2){let t=pt(2);Oe(),wr("[",t.duplicatesCount+1,"]")}}function R2(n,e){if(n&1&&(Mt(0,"div"),_n(1),ws(2,A2,2,1,"ng-container",4),En()),n&2){let t=pt();wn(t.options.titleClass),Es("aria-label",t.title),Oe(),wr(" ",t.title," "),Oe(),rt("ngIf",t.duplicatesCount)}}function D2(n,e){if(n&1&&Cs(0,"div",7),n&2){let t=pt();wn(t.options.messageClass),rt("innerHTML",t.message,Iu)}}function N2(n,e){if(n&1&&(Mt(0,"div",8),_n(1),En()),n&2){let t=pt();wn(t.options.messageClass),Es("aria-label",t.message),Oe(),wr(" ",t.message," ")}}function O2(n,e){if(n&1&&(Mt(0,"div"),Cs(1,"div",9),En()),n&2){let t=pt();Oe(),_s("width",t.width+"%")}}function x2(n,e){if(n&1){let t=Du();Mt(0,"button",5),bs("click",function(){Cu(t);let i=pt();return bu(i.remove())}),Mt(1,"span",6),_n(2,"\xD7"),En()()}}function k2(n,e){if(n&1&&(Au(0),_n(1),Ru()),n&2){let t=pt(2);Oe(),wr("[",t.duplicatesCount+1,"]")}}function M2(n,e){if(n&1&&(Mt(0,"div"),_n(1),ws(2,k2,2,1,"ng-container",4),En()),n&2){let t=pt();wn(t.options.titleClass),Es("aria-label",t.title),Oe(),wr(" ",t.title," "),Oe(),rt("ngIf",t.duplicatesCount)}}function P2(n,e){if(n&1&&Cs(0,"div",7),n&2){let t=pt();wn(t.options.messageClass),rt("innerHTML",t.message,Iu)}}function L2(n,e){if(n&1&&(Mt(0,"div",8),_n(1),En()),n&2){let t=pt();wn(t.options.messageClass),Es("aria-label",t.message),Oe(),wr(" ",t.message," ")}}function F2(n,e){if(n&1&&(Mt(0,"div"),Cs(1,"div",9),En()),n&2){let t=pt();Oe(),_s("width",t.width+"%")}}var Yg=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},Xg=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},Jg=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new Un;_activate=new Un;_manualClose=new Un;_resetTimeout=new Un;_countDuplicate=new Un;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},vs=class{toastId;config;message;title;toastType;toastRef;_onTap=new Un;_onAction=new Un;constructor(e,t,r,i,s,o){this.toastId=e,this.config=t,this.message=r,this.title=i,this.toastType=s,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},BC={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},qC=new oa("ToastConfig"),Zg=class extends Xg{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,r){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=r}attachComponentPortal(e,t){let r=this._componentFactoryResolver.resolveComponentFactory(e.component),i;return i=r.create(e.injector),this._appRef.attachView(i.hostView),this.setDisposeFn(()=>{this._appRef.detachView(i.hostView),i.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(i),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(i)),i}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},B2=(()=>{class n{_document=ei(Ou);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ia({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ey=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},q2=(()=>{class n{_overlayContainer=ei(B2);_componentFactoryResolver=ei(oy);_appRef=ei(la);_document=ei(Ou);_paneElements=new Map;create(t,r){return this._createOverlayRef(this.getPaneElement(t,r))}getPaneElement(t="",r){return this._paneElements.get(r)||this._paneElements.set(r,{}),this._paneElements.get(r)[t]||(this._paneElements.get(r)[t]=this._createPaneElement(t,r)),this._paneElements.get(r)[t]}_createPaneElement(t,r){let i=this._document.createElement("div");return i.id="toast-container",i.classList.add(t),i.classList.add("toast-container"),r?r.getContainerElement().appendChild(i):this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalHost(t){return new Zg(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new ey(this._createPortalHost(t))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ia({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),UC=(()=>{class n{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,r,i,s,o){this.overlay=r,this._injector=i,this.sanitizer=s,this.ngZone=o,this.toastrConfig=St(St({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=St(St({},t.default.iconClasses),t.config.iconClasses))}show(t,r,i={},s=""){return this._preBuildNotification(s,t,r,this.applyConfig(i))}success(t,r,i={}){let s=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(s,t,r,this.applyConfig(i))}error(t,r,i={}){let s=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(s,t,r,this.applyConfig(i))}info(t,r,i={}){let s=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(s,t,r,this.applyConfig(i))}warning(t,r,i={}){let s=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(s,t,r,this.applyConfig(i))}clear(t){for(let r of this.toasts)if(t!==void 0){if(r.toastId===t){r.toastRef.manualClose();return}}else r.toastRef.manualClose()}remove(t){let r=this._findToast(t);if(!r||(r.activeToast.toastRef.close(),this.toasts.splice(r.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let i=this.toasts[this.currentlyActive].toastRef;i.isInactive()||(this.currentlyActive=this.currentlyActive+1,i.activate())}return!0}findDuplicate(t="",r="",i,s){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let l=o&&a.title===t;if((!o||l)&&a.message===r)return a.toastRef.onDuplicate(i,s),a}return null}applyConfig(t={}){return St(St({},this.toastrConfig),t)}_findToast(t){for(let r=0;r<this.toasts.length;r++)if(this.toasts[r].toastId===t)return{index:r,activeToast:this.toasts[r]};return null}_preBuildNotification(t,r,i,s){return s.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,r,i,s)):this._buildNotification(t,r,i,s)}_buildNotification(t,r,i,s){if(!s.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(i,r,this.toastrConfig.resetTimeoutOnDuplicate&&s.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&i||r)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=r;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let l=this.overlay.create(s.positionClass,this.overlayContainer);this.index=this.index+1;let c=r;r&&s.enableHtml&&(c=this.sanitizer.sanitize(sy.HTML,r));let u=new Jg(l),d=new vs(this.index,s,c,i,t,u),f=[{provide:vs,useValue:d}],p=ti.create({providers:f,parent:this._injector}),m=new Yg(s.toastComponent,p),g=l.attach(m,s.newestOnTop);u.componentInstance=g.instance;let v={toastId:this.index,title:i||"",message:r||"",toastRef:u,onShown:u.afterActivate(),onHidden:u.afterClosed(),onTap:d.onTap(),onAction:d.onAction(),portal:g};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{v.toastRef.activate()})),this.toasts.push(v),v}static \u0275fac=function(r){return new(r||n)(Zr(qC),Zr(q2),Zr(ti),Zr(ly),Zr(Ss))};static \u0275prov=ia({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),U2=(()=>{class n{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=-1;toastClasses="";state;get displayStyle(){if(this.state.value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,r,i){this.toastrService=t,this.toastPackage=r,this.ngZone=i,this.message=r.message,this.title=r.title,this.options=r.config,this.originalTimeout=r.config.timeOut,this.toastClasses=`${r.toastType} ${r.config.toastClass}`,this.sub=r.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=r.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=r.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=r.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s}),this.state={value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}}}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state=Jr(St({},this.state),{value:"active"}),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width===0||this.width===100||!this.options.timeOut)return;let t=new Date().getTime(),r=this.hideTime-t;this.width=r/this.options.timeOut*100,this.options.progressAnimation==="increasing"&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state=Jr(St({},this.state),{value:"active"}),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state.value!=="removed"&&(clearTimeout(this.timeout),this.state=Jr(St({},this.state),{value:"removed"}),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state.value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state.value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state.value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,r){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),r)):this.timeout=setTimeout(()=>t(),r)}outsideInterval(t,r){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),r)):this.intervalId=setInterval(()=>t(),r)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(r){return new(r||n)(Sr(UC),Sr(vs),Sr(Ss))};static \u0275cmp=_u({type:n,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(r,i){r&1&&bs("click",function(){return i.tapToast()})("mouseenter",function(){return i.stickAround()})("mouseleave",function(){return i.delayedHideToast()}),r&2&&(ay("@flyInOut",i.state),wn(i.toastClasses),_s("display",i.displayStyle))},standalone:!0,features:[Nu],attrs:FC,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(r,i){r&1&&ws(0,I2,3,0,"button",0)(1,R2,3,5,"div",1)(2,D2,1,3,"div",2)(3,N2,2,4,"div",3)(4,O2,2,2,"div",4),r&2&&(rt("ngIf",i.options.closeButton),Oe(),rt("ngIf",i.title),Oe(),rt("ngIf",i.message&&i.options.enableHtml),Oe(),rt("ngIf",i.message&&!i.options.enableHtml),Oe(),rt("ngIf",i.options.progressBar))},dependencies:[xu],encapsulation:2,data:{animation:[cy("flyInOut",[ua("inactive",ca({opacity:0})),ua("active",ca({opacity:1})),ua("removed",ca({opacity:0})),Mu("inactive => active",ku("{{ easeTime }}ms {{ easing }}")),Mu("active => removed",ku("{{ easeTime }}ms {{ easing }}"))])]}})}return n})(),V2=Jr(St({},BC),{toastComponent:U2}),z2=(n={})=>iy([{provide:qC,useValue:{default:V2,config:n}}]),F3=(()=>{class n{static forRoot(t={}){return{ngModule:n,providers:[z2(t)]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=aa({type:n});static \u0275inj=sa({})}return n})();var G2=(()=>{class n{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=-1;toastClasses="";get displayStyle(){return this.state==="inactive"?"none":null}state="inactive";timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,r,i){this.toastrService=t,this.toastPackage=r,this.appRef=i,this.message=r.message,this.title=r.title,this.options=r.config,this.originalTimeout=r.config.timeOut,this.toastClasses=`${r.toastType} ${r.config.toastClass}`,this.sub=r.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=r.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=r.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=r.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state="active",!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width===0||this.width===100||!this.options.timeOut)return;let t=new Date().getTime(),r=this.hideTime-t;this.width=r/this.options.timeOut*100,this.options.progressAnimation==="increasing"&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state="active",this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width=-1,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state!=="removed"&&(clearTimeout(this.timeout),this.state="removed",this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(r){return new(r||n)(Sr(UC),Sr(vs),Sr(la))};static \u0275cmp=_u({type:n,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(r,i){r&1&&bs("click",function(){return i.tapToast()})("mouseenter",function(){return i.stickAround()})("mouseleave",function(){return i.delayedHideToast()}),r&2&&(wn(i.toastClasses),_s("display",i.displayStyle))},standalone:!0,features:[Nu],attrs:FC,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(r,i){r&1&&ws(0,x2,3,0,"button",0)(1,M2,3,5,"div",1)(2,P2,1,3,"div",2)(3,L2,2,4,"div",3)(4,F2,2,2,"div",4),r&2&&(rt("ngIf",i.options.closeButton),Oe(),rt("ngIf",i.title),Oe(),rt("ngIf",i.message&&i.options.enableHtml),Oe(),rt("ngIf",i.message&&!i.options.enableHtml),Oe(),rt("ngIf",i.options.progressBar))},dependencies:[xu],encapsulation:2})}return n})(),B3=Jr(St({},BC),{toastComponent:G2});export{VC as a,na as b,g3 as c,y3 as d,v3 as e,T3 as f,S3 as g,UC as h,F3 as i};
